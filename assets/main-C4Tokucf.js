import"./modulepreload-polyfill-B5Qt9EMX.js";import{getVariantByUrl as ec}from"./index-PkGK7-LP.js";import{API_BASE as nc,API as At,SYSTEM as ss,DISPLAY_PRICES as rc,PAYMENT_PRICES as sc}from"./config-LR8BJJ1r.js";class ic{constructor(){this.storageKey="destinyUser",this.data=this.load()}load(){try{const t=sessionStorage.getItem(this.storageKey);return t?JSON.parse(t):{}}catch{return console.warn("SessionStorage disabled or inaccessible"),{}}}save(){try{sessionStorage.setItem(this.storageKey,JSON.stringify(this.data))}catch{console.warn("Failed to save to SessionStorage")}}get(t){return this.data[t]}set(t,e){this.data[t]=e,this.save()}clear(){this.data={},sessionStorage.removeItem(this.storageKey)}}const C=new ic;class xe{constructor(){document.getElementById("starry-background")||(this.container=document.createElement("div"),this.container.id="starry-background",this.container.style.cssText=`
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
            background: linear-gradient(to bottom, #050508 0%, #0a0a10 100%);
            pointer-events: none;
        `,this.canvas=document.createElement("canvas"),this.canvas.style.cssText=`
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 1; 
        `,this.ctx=this.canvas.getContext("2d",{alpha:!1}),this.container.appendChild(this.canvas),document.body.prepend(this.container),this.stars=[],this.dustNodes=[],this.shootingStars=[],this.isMobile=window.innerWidth<768,this.initialGamma=null,this.initialBeta=null,this.width=window.innerWidth,this.height=window.innerHeight,this.mouseX=0,this.mouseY=0,this.targetX=0,this.targetY=0,this.lastShootingStar=0,this.shootingStarInterval=5e3+Math.random()*5e3,this.init())}init(){if(this.resize(),window.addEventListener("resize",()=>this.resize()),window.addEventListener("mousemove",t=>this.onMouseMove(t)),window.addEventListener("deviceorientation",t=>this.onDeviceMove(t)),window.addEventListener("pageshow",t=>{t.persisted&&(console.log("üåå StarryBackground: Restoring from bfcache..."),xe.ensureRunning())}),document.addEventListener("visibilitychange",()=>{document.hidden?this.active=!1:xe.ensureRunning()}),window.addEventListener("focus",()=>{xe.ensureRunning()}),this.isMobile&&typeof DeviceOrientationEvent<"u"&&typeof DeviceOrientationEvent.requestPermission=="function"){const t=()=>{DeviceOrientationEvent.requestPermission().then(e=>{e==="granted"&&window.addEventListener("deviceorientation",r=>this.onDeviceMove(r))}).catch(console.error).finally(()=>{window.removeEventListener("click",t),window.removeEventListener("touchstart",t)})};window.addEventListener("click",t),window.addEventListener("touchstart",t)}this.createSystem(),this.animate()}resize(){this.width=window.innerWidth,this.height=window.innerHeight,this.canvas.width=this.width,this.canvas.height=this.height,this.isMobile=this.width<768,this.createSystem()}createSystem(){this.active=!0,this.stars=[],this.dustNodes=[],this.shootingStars=[];const t=this.isMobile?5:8,e=this.height*.1,r=200,i=200;for(let m=0;m<t;m++)this.dustNodes.push({x:Math.random()*this.width,y:Math.random()*e,radius:Math.random()*i+r,colorPhase:Math.random()*Math.PI*2,pulseSpeed:.2+Math.random()*.2,vx:(Math.random()-.5)*.05,vy:(Math.random()-.5)*.05});const o=this.height*.2,l=this.isMobile?240:600;for(let m=0;m<l;m++)this.stars.push({x:Math.random()*this.width,y:Math.random()*o,size:Math.random()*.6+.1,baseOpacity:Math.random()*.4+.1,phase:Math.random()*Math.PI*2,speed:Math.random()*.02+.01,parallax:.02,isMilkyWay:!0});const u=this.isMobile?3500:3e3,p=Math.floor(this.width*this.height/u*1.2);for(let m=0;m<p;m++){let w=Math.random()<.6?Math.random()*(this.height*.5):Math.random()*this.height;this.stars.push({x:Math.random()*this.width,y:w,size:Math.random()*(this.isMobile?1.2:1.8),baseOpacity:Math.random()*.7+.3,phase:Math.random()*Math.PI*2,speed:Math.random()*.03+.01,parallax:Math.random()*.08+.04,isMilkyWay:!1})}}spawnShootingStar(){const t=Math.random()>.5,e=t?Math.random()*this.width*.2:this.width*.8+Math.random()*this.width*.2,r=Math.random()*(this.height*.3),i=t?Math.PI/6+Math.random()*Math.PI/6:Math.PI-Math.PI/6-Math.random()*Math.PI/6;this.shootingStars.push({x:e,y:r,vx:Math.cos(i)*(10+Math.random()*5),vy:Math.sin(i)*(10+Math.random()*5),length:60+Math.random()*90,opacity:1,life:1})}onMouseMove(t){this.isMobile||(this.targetX=t.clientX/this.width-.5,this.targetY=t.clientY/this.height-.5)}onDeviceMove(t){if(t.beta===null||t.gamma===null)return;if(this.initialBeta===null){this.initialBeta=t.beta,this.initialGamma=t.gamma;return}let e=t.gamma-this.initialGamma,r=t.beta-this.initialBeta;const i=30;e=Math.min(Math.max(e,-i),i),r=Math.min(Math.max(r,-i),i),this.targetX=e/i*.5,this.targetY=r/i*.5}lerp(t,e,r){return(1-r)*t+r*e}animate(){if(!this.active)return;const t=Date.now(),e=t*.001;t-this.lastShootingStar>this.shootingStarInterval&&(this.spawnShootingStar(),this.lastShootingStar=t,this.shootingStarInterval=4e3+Math.random()*6e3);const r=this.isMobile?.08:.02;this.mouseX+=(this.targetX-this.mouseX)*r,this.mouseY+=(this.targetY-this.mouseY)*r;const i=this.isMobile?1200:600,o=this.mouseX*i,l=this.mouseY*i,u=document.querySelector(".funnel-container"),p=u?u.scrollTop:window.scrollY||0,m=this.ctx.createLinearGradient(0,0,0,this.height);m.addColorStop(0,"#080504"),m.addColorStop(1,"#050508"),this.ctx.fillStyle=m,this.ctx.fillRect(0,0,this.width,this.height);const w={r:131,g:105,b:60},T={r:100,g:50,b:160};this.ctx.globalCompositeOperation="lighter",this.dustNodes.forEach(v=>{v.x+=v.vx,v.y+=v.vy;const A=(Math.sin(e*v.pulseSpeed+v.colorPhase)+1)/2,V=Math.floor(this.lerp(w.r,T.r,A)),S=Math.floor(this.lerp(w.g,T.g,A)),P=Math.floor(this.lerp(w.b,T.b,A)),R=.05+(Math.sin(e*.5+v.colorPhase)+1)*.02,F=`rgba(${V}, ${S}, ${P}, ${R})`,O=p*.2,$=o*.15,L=l*.15,E=v.x-$,h=v.y-L-O,d=this.ctx.createRadialGradient(E,h,0,E,h,v.radius);d.addColorStop(0,F),d.addColorStop(1,"transparent"),this.ctx.fillStyle=d,this.ctx.beginPath(),this.ctx.arc(E,h,v.radius,0,Math.PI*2),this.ctx.fill()}),this.ctx.globalCompositeOperation="source-over",this.ctx.fillStyle="#FFFFFF",this.stars.forEach(v=>{const D=.7+.3*Math.sin(e*(v.speed*50)+v.phase),A=p*(v.parallax*3);let V=v.x-o*v.parallax,S=v.y-l*v.parallax-A;const P=50,R=this.height+P*2;for(;S<-P;)S+=R;for(;S>this.height+P;)S-=R;V<-P&&(V+=this.width+P*2),V>this.width+P&&(V-=this.width+P*2),this.ctx.globalAlpha=v.baseOpacity*D,this.ctx.beginPath(),this.ctx.arc(V,S,v.size,0,Math.PI*2),this.ctx.fill()}),this.ctx.globalAlpha=1,this.shootingStars=this.shootingStars.filter(v=>{if(v.x+=v.vx,v.y+=v.vy,v.life-=.015,v.opacity=v.life,v.life<=0||v.x>this.width+100||v.y>this.height+100)return!1;const D=v.x-v.vx/Math.hypot(v.vx,v.vy)*v.length,A=v.y-v.vy/Math.hypot(v.vx,v.vy)*v.length,V=this.ctx.createLinearGradient(D,A,v.x,v.y);return V.addColorStop(0,"transparent"),V.addColorStop(.5,`rgba(255, 255, 255, ${v.opacity*.5})`),V.addColorStop(1,`rgba(255, 255, 255, ${v.opacity})`),this.ctx.strokeStyle=V,this.ctx.lineWidth=1.5,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(D,A),this.ctx.lineTo(v.x,v.y),this.ctx.stroke(),this.ctx.fillStyle=`rgba(255, 255, 255, ${v.opacity})`,this.ctx.beginPath(),this.ctx.arc(v.x,v.y,1.5,0,Math.PI*2),this.ctx.fill(),!0}),this.ctx.globalAlpha=1,requestAnimationFrame(()=>this.animate())}destroy(){this.active=!1,this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container)}static ensureRunning(){const t=window.starryBgInstance;t&&(console.log("üåå StarryBackground: Ensuring animation is running..."),t.active=!0,requestAnimationFrame(()=>t.animate()))}}const vt={log:(...n)=>{},warn:(...n)=>{},error:(...n)=>{console.error(...n)},debug:(...n)=>{}};class oc{constructor(){this.onRoute=null,this.currentVariant=null}init(t){if(!t||typeof t.onRoute!="function"){vt.error("Router init failed: config.onRoute is missing");return}this.onRoute=t.onRoute;const e=ec();e&&(vt.log(`üöÄ Active Variant: ${e.id}`),this.currentVariant=e,C.set("currentVariant",e),this.trackVariantView(e)),window.addEventListener("popstate",()=>{xe.ensureRunning(),this.handleLocation()}),this.handleLocation()}async handleLocation(){let t=window.location.pathname;this.currentVariant&&(t===`/${this.currentVariant.id}`||t===`/${this.currentVariant.id}/`)?t="/":this.currentVariant||(document.body.style.backgroundColor=""),this.onRoute&&await this.onRoute(t)}navigate(t){window.history.pushState({},"",t),this.handleLocation(),window.scrollTo(0,0)}navigateTo(t){const e=t.startsWith("/")?t:`/${t}`;this.navigate(e)}trackVariantView(t){window.fbq&&(vt.log("üìä Tracking Variant View:",t.id),window.fbq("track","ViewContent",{content_name:t.id,content_category:t.type}))}}const Ct=new oc;class ac{constructor(){this.audioCtx=null,this.isAudioUnlocked=!1,this.canVibrate=typeof navigator<"u"&&"vibrate"in navigator,this.isIOS=/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1,this.tickBuffer=null,this.hasInitialized=!1}init(t=!1){if(!(this.hasInitialized&&!t))try{const e=window.AudioContext||window.webkitAudioContext;e&&(this.audioCtx=new e,this._createTickBuffer(),this.hasInitialized=!0,this._unlock())}catch(e){console.warn("Haptics: Web Audio API not supported",e)}}_createTickBuffer(){if(!this.audioCtx)return;const t=this.audioCtx.sampleRate,e=Math.floor(.015*t),r=this.audioCtx.createBuffer(1,e,t),i=r.getChannelData(0),o=150;for(let l=0;l<e;l++){const u=l/t,p=Math.sin(2*Math.PI*o*u);let m=1;l<e*.1?m=l/(e*.1):m=1-(l-e*.1)/(e*.9),i[l]=p*m}this.tickBuffer=r}_unlock(){this.isAudioUnlocked||!this.audioCtx||(this.audioCtx.state==="suspended"?this.audioCtx.resume().then(()=>{this.isAudioUnlocked=!0}).catch(t=>console.log("Audio unlock failed, waiting for next interaction")):this.isAudioUnlocked=!0)}trigger(t="light"){if(this.canVibrate){try{switch(t){case"light":navigator.vibrate(10);break;case"medium":navigator.vibrate(20);break;case"heavy":navigator.vibrate(40);break;case"success":navigator.vibrate([10,50,20]);break;case"error":navigator.vibrate([50,100,50]);break;default:navigator.vibrate(15)}}catch{}return}if(!this.isIOS&&this.audioCtx&&this.tickBuffer){this.audioCtx.state==="suspended"&&this.audioCtx.resume();const e=this.audioCtx.createBufferSource();e.buffer=this.tickBuffer;const r=this.audioCtx.createGain();let i=1,o=1;switch(t){case"light":i=.6,o=1.2;break;case"medium":i=.8,o=1;break;case"heavy":i=1,o=.8;break;case"success":this._playTone(.6,1.2,0),setTimeout(()=>this._playTone(1,1,.1),80);return;case"error":this._playTone(.8,.8,0),setTimeout(()=>this._playTone(.8,.8,.08),80),setTimeout(()=>this._playTone(.8,.8,.16),160);return}e.playbackRate.value=o,r.gain.setValueAtTime(i,this.audioCtx.currentTime),r.gain.exponentialRampToValueAtTime(.01,this.audioCtx.currentTime+.05),e.connect(r),r.connect(this.audioCtx.destination),e.start()}}_playTone(t,e,r){if(!this.audioCtx||!this.tickBuffer)return;const i=this.audioCtx.createBufferSource();i.buffer=this.tickBuffer,i.playbackRate.value=e;const o=this.audioCtx.createGain();o.gain.setValueAtTime(t,this.audioCtx.currentTime+r),o.gain.exponentialRampToValueAtTime(.01,this.audioCtx.currentTime+r+.05),i.connect(o),o.connect(this.audioCtx.destination),i.start(this.audioCtx.currentTime+r)}}const ct=new ac;let nn=null;function xs(){return window.CircularNatalHoroscope?Promise.resolve(!0):nn?(console.log("‚è≥ Astro Library load request joined existing queue..."),nn):(console.log("üöÄ Starting Astro Library sequence..."),nn=new Promise(n=>{window.module||(window.module={exports:{}}),window.exports=window.module.exports;const t=["https://unpkg.com/circular-natal-horoscope-js@1.1.0/dist/index.js","https://cdn.jsdelivr.net/npm/circular-natal-horoscope-js@1.1.0/dist/index.js","./js/astro-lib.js"];function e(r){if(r>=t.length){console.error("‚ùå CRITICAL: –í—Å—ñ –¥–∂–µ—Ä–µ–ª–∞ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ (–≤–∫–ª—é—á–Ω–æ –∑ –ª–æ–∫–∞–ª—å–Ω–∏–º) –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ñ."),n(!1),nn=null;return}const i=t[r],o=document.createElement("script");o.src=i,o.async=!0,o.onload=()=>{window.module&&window.module.exports&&window.module.exports.Horoscope?(window.CircularNatalHoroscope=window.module.exports,console.log(`‚úÖ Astro Library Loaded Successfully from ${i}`),n(!0)):window.CircularNatalHoroscope?(console.log(`‚úÖ Astro Library Loaded (Global) from ${i}`),n(!0)):(console.warn(`‚ö†Ô∏è Script loaded from ${i}, but exports missing.`),e(r+1))},o.onerror=()=>{console.warn(`‚ö†Ô∏è Failed to load from ${i}. Switching to backup source...`),e(r+1)},document.head.appendChild(o)}e(0)}),nn)}async function ia(n){if(!await xs())throw new Error("Astro Library not loaded");const{Origin:t,Horoscope:e,Renderer:r}=window.CircularNatalHoroscope,i=n.date.split("-"),o=parseInt(i[0]),l=parseInt(i[1])-1,u=parseInt(i[2]);let p=12,m=0;if(n.time){const R=n.time.split(":");p=parseInt(R[0]),m=parseInt(R[1])}let w=50.45,T=30.52,v="Europe/Kyiv";if(n.geo){const R=parseFloat(n.geo.latitude||n.geo.lat),F=parseFloat(n.geo.longitude||n.geo.lon);!isNaN(R)&&!isNaN(F)&&(w=R,T=F,v=n.geo.timezone||v)}let D=[],A=[],V=null,S=null;function P(R){const F=Math.floor(R),O=(R-F)*60,$=Math.floor(O),L=Math.round((O-$)*60);return`${F}¬∞ ${$}' ${L}"`}try{const R=new t({year:o,month:l,date:u,hour:p,minute:m,latitude:w,longitude:T,timezone:v});S=new e({origin:R,houseSystem:"placidus",zodiac:"tropical",aspectPoints:["bodies","points","angles"],aspectWithPoints:["bodies","points","angles"],aspectTypes:["major","minor"],customOrbs:{}});const F=S.CelestialBodies,O=S.CelestialPoints,$=["sun","moon","mercury","venus","mars","jupiter","saturn","uranus","neptune","pluto"],L=["northnode","southnode","lilith","chiron"],E=["ascendant","midheaven"];$.forEach(h=>{const d=F[h];if(d){const y=d.Sign.label.toUpperCase(),_=d.ChartPosition.Ecliptic.DecimalDegrees%30,b=P(_),g=h.toUpperCase();let nt="";d.Speed&&d.Speed.DecimalDegrees<0&&(nt=" (R)"),D.push(`${g}: ${y} ${b}${nt}`)}}),L.forEach(h=>{const d=O?O[h]:null;if(d){const y=d.Sign?.label?.toUpperCase()||"UNKNOWN",_=(d.ChartPosition?.Ecliptic?.DecimalDegrees||0)%30,b=P(_);let g=h.toUpperCase();h==="northnode"&&(g="NORTH NODE (Rahu)"),h==="southnode"&&(g="SOUTH NODE (Ketu)"),h==="lilith"&&(g="LILITH (Black Moon)"),h==="chiron"&&(g="CHIRON"),D.push(`${g}: ${y} ${b}`)}}),E.forEach(h=>{let d=null;if(h==="ascendant"&&(d=S.Ascendant),h==="midheaven"&&(d=S.Midheaven),d){const y=d.Sign.label.toUpperCase(),_=d.ChartPosition.Ecliptic.DecimalDegrees%30,b=P(_),g=h.toUpperCase();D.push(`${g}: ${y} ${b}`)}}),S.Aspects&&S.Aspects.all&&S.Aspects.all.forEach(h=>{const d=h.point1?.label||h.point1?.key||"Unknown",y=h.point2?.label||h.point2?.key||"Unknown",_=h.name||h.type||"Aspect",b=h.orb!==void 0?h.orb.toFixed(1):"?";A.push(`${d} ${_} ${y} (orb ${b}¬∞)`)}),console.log("Calculated Planets (DMS + Retrograde):",D),console.log("Calculated Aspects:",A)}catch(R){return console.error("Horoscope Calculation Failed:",R),{planets:[],aspects:[],chartSvg:null,houseSystem:"Error"}}try{if(S){const R=document.createElement("div");R.style.position="absolute",R.style.left="-9999px",R.style.visibility="hidden",document.body.appendChild(R),new r(S).render(R);const O=R.querySelector("svg");O&&(O.style.backgroundColor="transparent",O.querySelectorAll("line, circle, path").forEach($=>{const L=$.getAttribute("stroke");(!L||L==="#000000"||L==="#000")&&$.setAttribute("stroke","#cda45e");const E=$.getAttribute("fill");(E==="#000000"||E==="#000")&&$.setAttribute("fill","#cda45e")}),O.querySelectorAll("text").forEach($=>{$.style.fill="#cda45e",$.setAttribute("fill","#cda45e"),$.style.fontFamily="'Montserrat', sans-serif"}),V=R.innerHTML),document.body.removeChild(R)}}catch(R){console.warn("SVG Render Error:",R)}return{planets:D,aspects:A,chartSvg:V,houseSystem:"Placidus"}}async function Le(n,t={},e={}){try{let r;if(n.startsWith("http://")||n.startsWith("https://"))r=n;else{const l=n.startsWith("/")?n.slice(1):n;r=`${nc}/${l}`}const i={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),...e},o=await fetch(r,i);if(!o.ok){const l=await o.text();throw new Error(l||`API Error: ${o.status}`)}return await o.json()}catch(r){throw r.name!=="AbortError"&&vt.error(`[API Core Error] ${n}:`,r),r}}let ae=null,Wn=null;function gr(){At&&At.PDF&&Le(At.PDF,{warmup:!0}).catch(()=>{})}function As(n){if(!n)return null;try{return JSON.parse(n)}catch{}const t="```",e=new RegExp(t+"(?:json)?\\s*([\\s\\S]*?)\\s*"+t,"i"),r=n.match(e);if(r&&r[1])try{return JSON.parse(r[1])}catch{}const i=n.indexOf("{"),o=n.lastIndexOf("}");if(i!==-1&&o!==-1&&o>i){const l=n.substring(i,o+1);try{return JSON.parse(l)}catch(u){console.error("‚ùå JSON Extraction Failed (Brace Method):",u)}}throw console.error("‚ùå Fatal: Could not parse AI response. Raw content:",n),new Error("Invalid JSON format from AI")}function oa(n){if(!n||!Array.isArray(n))return"";const t={section:"margin-bottom: 35px; page-break-inside: avoid;",h2:"color: #cda45e; font-family: 'Playfair Display', serif; font-size: 22px; font-weight: 700; margin-top: 0; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid rgba(205, 164, 94, 0.3); padding-bottom: 10px;",p:"font-family: 'Montserrat', sans-serif; font-size: 14px; line-height: 1.8; color: #e0e0e0; margin-bottom: 12px; text-align: justify;",strong:"color: #ffffff; font-weight: 600;",adviceBox:"background-color: #161b22; border: 1px solid rgba(205, 164, 94, 0.2); border-left: 4px solid #cda45e; padding: 20px; margin-top: 20px; border-radius: 0 8px 8px 0;",adviceHeader:"color: #cda45e; display: block; margin-bottom: 8px; text-transform: uppercase; font-size: 11px; letter-spacing: 2px; font-weight: 700; font-family: 'Montserrat', sans-serif;",adviceText:"margin: 0; color: #cccccc; font-style: italic; font-family: 'Montserrat', sans-serif; font-size: 13px; line-height: 1.6;"};return n.map(e=>{let r=e.analysis_text||"";r=r.replace(/\\n/g,`
`),r=r.replace(/\*\*(.*?)\*\*/g,`<strong style="${t.strong}">$1</strong>`);const i=r.split(`
`).filter(o=>o.trim()!=="").map(o=>`<p style="${t.p}">${o}</p>`).join("");return`
            <div class="report-section" style="${t.section}">
                <h2 style="${t.h2}">
                    <span style="margin-right: 8px;">${e.icon}</span> ${e.title}
                </h2>
                <div class="report-content-text">${i}</div>
                <div class="report-advice" style="${t.adviceBox}">
                    <span style="${t.adviceHeader}">‚ö°Ô∏è KOSMIC KEY:</span>
                    <p style="${t.adviceText}">${e.practical_advice}</p>
                </div>
            </div>`}).join("")}async function Ss(n,t){const e=new AbortController,r=setTimeout(()=>e.abort(),ss.REQUEST_TIMEOUT_MS);try{if(!At||!At.PROXY)throw new Error("Configuration Error: API.PROXY is missing. Please check src/config.js");vt.log(`üì° Sending request to: ${At.PROXY} [Action: ${n}]`);const i=await Le(At.PROXY,{action:n,data:t,modelName:ss.MODEL_NAME},{signal:e.signal});clearTimeout(r);const o=i.candidates?.[0]?.content?.parts?.[0]?.text;if(!o)throw new Error("AI returned empty response (no text candidate)");return o}catch(i){throw clearTimeout(r),console.error("AI Request Failed:",i),i}}async function lc(n){gr();try{let t=`–î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è: ${n}`;try{const i=await ia({date:n});i&&i.planets&&(t=`–î–∞—Ç–∞: ${n}
== –¢–µ—Ö–Ω—ñ—á–Ω—ñ –ê—Å—Ç—Ä–æ–ª–æ–≥—ñ—á–Ω—ñ –î–∞–Ω—ñ ==
${i.planets.join(`
`)}`)}catch(i){console.warn("Free astro calc skipped",i)}const e=await Ss("free_analysis",{date:n,userQuery:t});return As(e)}catch(t){return console.error("Free Analysis Error:",t),{title:"–ü–æ–º–∏–ª–∫–∞ –ó'—î–¥–Ω–∞–Ω–Ω—è",psychological_analysis:`<p>–ù–∞ –∂–∞–ª—å, —Å–µ—Ä–≤–µ—Ä –Ω–µ –∑–º—ñ–≥ –æ–±—Ä–æ–±–∏—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –®–Ü. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.</p><p style="color:rgba(255,255,255,0.3); font-size:0.7em;">Details: ${t.message}</p>`}}}async function aa(n){if(ae)return ae;let t="";try{const l=await ia(n);l&&l.planets&&(t=`== –¢–µ—Ö–Ω—ñ—á–Ω—ñ –ê—Å—Ç—Ä–æ–ª–æ–≥—ñ—á–Ω—ñ –î–∞–Ω—ñ ==
${l.planets.join(`
`)}`,C.set("planets",l.planets),l.aspects&&l.aspects.length>0&&(t+=`

== –ê—Å–ø–µ–∫—Ç–∏ –ù–∞—Ç–∞–ª—å–Ω–æ—ó –ö–∞—Ä—Ç–∏ ==
${l.aspects.join(`
`)}`,C.set("aspects",l.aspects)))}catch(l){console.warn("Local calc skipped",l)}const e=`–î–∞—Ç–∞: ${n.date}
–ß–∞—Å: ${n.time}
–ú—ñ—Å—Ç–æ: ${n.city}
${t}`,r=C.get("currentVariant");let i=e;r&&r.aiContext&&r.aiContext.additionalPrompt&&(vt.log("üß† Injecting AI Context from Variant:",r.id),i+=`

[–í–ê–ñ–õ–ò–í–ò–ô –ö–û–ù–¢–ï–ö–°–¢ –ú–ê–†–ö–ï–¢–ò–ù–ì–£: ${r.aiContext.additionalPrompt}]`);const o=C.get("planets")?{...n,planets:C.get("planets"),aspects:C.get("aspects")}:n;return ae=Ss("full_report",{userQuery:i}).then(l=>{const u=As(l);return Wn={data:u,enrichedUserData:o},u}).catch(l=>{throw ae=null,l}),ae}async function la(n,t){let e=null,r=n;try{if(Wn?(e=Wn.data,r=Wn.enrichedUserData):ae?(e=await ae,r=C.get("planets")?{...n,planets:C.get("planets")}:n):(e=await aa(n),r=C.get("planets")?{...n,planets:C.get("planets")}:n),t&&t.includes("@")){vt.log("üìß Preparing Main Report Email (Frontend Trigger)...");const i=oa(e.sections);Le(At.EMAIL,{userEmail:t,reportHtml:i,reportTitle:"–¢–≤—ñ–π –ü–æ–≤–Ω–∏–π –ê–Ω–∞–ª—ñ–∑",reportType:"main",userData:r}).catch(o=>console.error("Email Error:",o))}return e}catch(i){return console.error("Generate Full Report Error:",i),{error:!0,message:"–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –∑–≤—ñ—Ç."}}}async function cc(n,t){C.get("planets");const e=`–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: –ñ—ñ–Ω–∫–∞. –î–∞—Ç–∞: ${n.date}. –ú—ñ—Å—Ç–æ: ${n.city}`;try{vt.log("üîÆ Generating Forecast for UI preview...");const r=await Ss("forecast",{userQuery:e}),i=As(r);if(!i||!i.sections)throw new Error("Invalid Forecast JSON");const o=oa(i.sections);return vt.log("‚úÖ Forecast HTML generated. Email –±—É–¥–µ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ backend'–æ–º."),o}catch(r){return console.error("Generate Forecast Error:",r),null}}const uc=`<section id="landing-step" class="funnel-step active space-y-8 text-center flex flex-col justify-between"
    style="min-height: 100dvh;">

    <!-- Main Content Wrapper -->
    <div class="flex-grow flex flex-col justify-center space-y-8">
        <div>
            <svg class="w-16 h-16 mx-auto" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg"
                style="color: var(--accent-color);">
                <circle cx="32" cy="32" r="2.5" fill="currentColor" />
                <path
                    d="M52 32C52 43.0457 43.0457 52 32 52C20.9543 52 12 43.0457 12 32C12 20.9543 20.9543 12 32 12C43.0457 12 52 20.9543 52 32Z"
                    stroke="currentColor" stroke-width="2.5" stroke-opacity="0.3" />
                <path
                    d="M46.8564 32C46.8564 39.098 40.098 44.8564 32 44.8564C23.902 44.8564 17.1436 39.098 17.1436 32C17.1436 24.902 23.902 19.1436 32 19.1436C40.098 19.1436 46.8564 24.902 46.8564 32Z"
                    stroke="currentColor" stroke-width="2.5" />
            </svg>
        </div>
        <div class="space-y-4">
            <h2 class="text-3xl font-bold text-white tracking-tight">
                –†–æ–∑–∫—Ä–∏–π —Å–≤–æ—ó –ø—Ä–∏—Ö–æ–≤–∞–Ω—ñ —Ç–∞–ª–∞–Ω—Ç–∏ —Ç–∞ —Å–∏–ª—å–Ω—ñ —Å—Ç–æ—Ä–æ–Ω–∏
            </h2>
            <p class="text-lg" style="color: var(--secondary-text-color);">
                –û–±–µ—Ä–∏ –¥–∞—Ç—É –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è —â–æ–± –¥—ñ–∑–Ω–∞—Ç–∏—Å—è –ø—Ä–æ —Å–≤–æ—ó –ø—Ä–∏—Ö–æ–≤–∞–Ω—ñ —Ç–∞–ª–∞–Ω—Ç–∏ —Ç–∞ —Å–∏–ª—å–Ω—ñ —Å—Ç–æ—Ä–æ–Ω–∏ –≤ –æ—Å–Ω–æ–≤–Ω–∏—Ö —Å—Ñ–µ—Ä–∞—Ö
                –∂–∏—Ç—Ç—è: <span class="text-white font-medium">—Å—Ç–æ—Å—É–Ω–∫–∏, –∫–∞—Ä'—î—Ä–∞, —Ñ—ñ–Ω–∞–Ω—Å–∏ —Ç–∞ —Å–∞–º–æ—Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è</span>.
            </p>
        </div>

        <form id="birth-form" class="w-full space-y-4" novalidate>
            <div
                class="input-field shine-effect h-14 flex items-center justify-center relative hover:border-[#cda45e] transition-colors">
                <svg class="w-6 h-6 absolute left-4 top-1/2 -translate-y-1/2 animate-pulse"
                    style="color: var(--accent-color);" viewBox="0 0 24 24" fill="none"
                    xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M9 11.24V7.5C9 6.12 10.12 5 11.5 5S14 6.12 14 7.5v3.74c1.21-.81 2-2.18 2-3.74C16 5.01 13.99 3 11.5 3S7 5.01 7 7.5c0 1.56.79 2.93 2 3.74zm9.84 4.63l-4.54-2.26c-.17-.07-.35-.11-.54-.11H13v-6c0-.83-.67-1.5-1.5-1.5S10 6.67 10 7.5v10.74l-3.43-.72c-.28-.06-.57 0-.84.18l-.24.17c-.27.2-.35.59-.16.89l2.65 4.14c.44.69 1.19 1.1 1.99 1.1h6.5c1.45 0 2.56-1.25 2.45-2.69l-.32-3.92c-.08-.94-.78-1.68-1.66-1.92z"
                        fill="currentColor" />
                    <path d="M8.5 2 C 9.5 1, 13.5 1, 14.5 2" stroke="currentColor" stroke-width="1.5"
                        stroke-linecap="round" stroke-opacity="0.6" />
                    <path d="M11.5 0.5 V 1.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                        stroke-opacity="0.6" />
                </svg>

                <svg class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2"
                    style="color: var(--secondary-text-color);" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                    </path>
                </svg>

                <span id="date-placeholder" style="color: var(--secondary-text-color); pointer-events: none;">–û–±—Ä–∞—Ç–∏
                    –¥–∞—Ç—É</span>
                <input type="date" id="birth-date" name="birth-date"
                    class="absolute top-0 left-0 w-full h-full opacity-0 cursor-pointer z-10" required>
            </div>
            <p id="error-message" class="error-text">
                –ë—É–¥—å –ª–∞—Å–∫–∞, –æ–±–µ—Ä–∏ –¥–∞—Ç—É –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è.
            </p>
            <button type="submit" id="birth-form-btn" class="btn btn-primary !text-lg h-14">
                <span class="btn-text">–î—ñ–∑–Ω–∞—Ç–∏—Å—è –Ω–µ–≥–∞–π–Ω–æ</span>
                <span class="btn-spinner"></span>
            </button>
            <p class="text-[9px] !mt-[2px] opacity-40" style="color: var(--accent-color);">
                –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –ù–∞—Ç–∞–ª—å–Ω–æ—ó –∫–∞—Ä—Ç–∏ –∑–∞ —Ç–æ—á–Ω–∏–º–∏ –ï—Ñ–µ–º–µ—Ä–∏–¥–∞–º–∏
            </p>
        </form>
    </div>

    <!-- CLEAN FOOTER (JUST ONE LINK) -->
    <div class="clean-footer-link mt-auto">
        <span class="clean-footer-btn" id="open-info-modal-btn">
            –Æ—Ä–∏–¥–∏—á–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è —Ç–∞ –ü—ñ–¥—Ç—Ä–∏–º–∫–∞
        </span>
        <!-- üî• UPDATED YEAR TO 2026 -->
        <p class="text-[9px] mt-2 opacity-50">&copy; 2026 Destiny Code</p>
    </div>

</section>

<!-- ================= MODALS (OUTSIDE SECTION) ================= -->

<!-- INFO MODAL (REPLACES FOOTER CONTENT) -->
<div id="info-modal" class="modal-overlay">
    <div class="modal-content text-left">
        <span class="modal-close-icon" id="close-info-modal-icon">&times;</span>
        <div class="modal-text-content">
            <h3 class="text-center">–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h3>

            <div class="legal-links mt-4 mb-6">
                <span class="legal-link" data-legal-type="offer">–ü—É–±–ª—ñ—á–Ω–∞ –æ—Ñ–µ—Ä—Ç–∞</span>
                <span class="legal-link" data-legal-type="privacy">–ü–æ–ª—ñ—Ç–∏–∫–∞ –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω–æ—Å—Ç—ñ</span>
                <span class="legal-link" data-legal-type="refund">–ü–æ–ª—ñ—Ç–∏–∫–∞ –ø–æ–≤–µ—Ä–Ω–µ–Ω—å</span>
                <span class="legal-link" data-legal-type="contacts">–ö–æ–Ω—Ç–∞–∫—Ç–∏</span>

                <!-- üî• NEW: Telegram Bot Link -->
                <!-- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –∫–ª–∞—Å legal-link –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Å—Ç–∏–ª—é, –∞–ª–µ —Ç–µ–≥ <a> –¥–ª—è –ø—Ä—è–º–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥—É -->
                <a href="https://t.me/DestinyCodeHelpBot" target="_blank" class="legal-link"
                    style="color: #cda45e; border-color: #cda45e;">–ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –≤ Telegram</a>
            </div>

            <div class="opacity-80 text-xs mt-4 border-t border-gray-700 pt-4">
                <p class="mb-2"><strong>–í–Ü–î–ú–û–í–ê –í–Ü–î –í–Ü–î–ü–û–í–Ü–î–ê–õ–¨–ù–û–°–¢–Ü:</strong><br>–í—Å—ñ –∞—Å—Ç—Ä–æ–ª–æ–≥—ñ—á–Ω—ñ –ø—Ä–æ–≥–Ω–æ–∑–∏, —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∏
                    —Ç–∞ –æ–ø–∏—Å–∏ –Ω–∞ —Ü—å–æ–º—É —Å–∞–π—Ç—ñ –Ω–∞–¥–∞—é—Ç—å—Å—è –≤–∏–∫–ª—é—á–Ω–æ –≤ —Ä–æ–∑–≤–∞–∂–∞–ª—å–Ω–∏—Ö —Ç–∞ –æ–∑–Ω–∞–π–æ–º—á–∏—Ö —Ü—ñ–ª—è—Ö.</p>
                <p class="italic opacity-70 mb-4">IMPORTANT: All materials are for educational and entertainment
                    purposes only.</p>
            </div>
        </div>
        <button class="btn modal-btn-close w-full" id="close-info-modal-btn">–ó—Ä–æ–∑—É–º—ñ–ª–æ</button>
    </div>
</div>

<!-- LEGAL MODAL (DOCUMENTS) -->
<div id="legal-modal" class="modal-overlay">
    <div class="modal-content text-left">
        <span class="modal-close-icon" id="close-legal-modal-icon">&times;</span>
        <div id="legal-modal-body" class="modal-text-content">
            <!-- Content injected via JS -->
        </div>
        <button class="btn modal-btn-close w-full" id="close-legal-modal-btn">–ó—Ä–æ–∑—É–º—ñ–ª–æ</button>
    </div>
</div>

<!-- HIDDEN LEGAL CONTENT TEMPLATES -->

<!-- NEW CONTACTS CONTENT -->
<div id="legal-content-contacts" style="display:none;">
    <h3>–ö–û–ù–¢–ê–ö–¢–ò</h3>
    <p><strong>–§–û–ü –°–µ—Ä–Ω—è–∫ –û.–û.</strong><br>
        –Ü–ü–ù: 3169419596<br>
        –ê–¥—Ä–µ—Å–∞: –£–∫—Ä–∞—ó–Ω–∞, –º. –ö–∏—ó–≤, –≤—É–ª. –ö–∞–¥–µ—Ç—Å—å–∫–∏–π –≥–∞–π 7, –∫–≤. 40<br>
        Email: destinycode.online@gmail.com<br>
        –¢–µ–ª–µ—Ñ–æ–Ω: +380939783397</p>
    <br>
    <p>–í–∏ –º–æ–∂–µ—Ç–µ –∑–≤'—è–∑–∞—Ç–∏—Å—è –∑ –Ω–∞–º–∏ –∑ –±—É–¥—å-—è–∫–∏—Ö –ø–∏—Ç–∞–Ω—å —â–æ–¥–æ —Ä–æ–±–æ—Ç–∏ —Å–µ—Ä–≤—ñ—Å—É, –æ–ø–ª–∞—Ç–∏ –∞–±–æ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∑–≤—ñ—Ç—ñ–≤.</p>
</div>

<div id="legal-content-offer" style="display:none;">
    <h3>–ü–£–ë–õ–Ü–ß–ù–ê –û–§–ï–†–¢–ê</h3>
    <p>1. –¶–µ–π –¥–æ–∫—É–º–µ–Ω—Ç —î –ø—É–±–ª—ñ—á–Ω–æ—é –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—î—é (–æ—Ñ–µ—Ä—Ç–æ—é) —Ñ—ñ–∑–∏—á–Ω–æ—ó –æ—Å–æ–±–∏-–ø—ñ–¥–ø—Ä–∏—î–º—Ü—è <strong>–°–µ—Ä–Ω—è–∫ –û.–û.</strong> (–¥–∞–ª—ñ ‚Äì
        –í–∏–∫–æ–Ω–∞–≤–µ—Ü—å) —É–∫–ª–∞—Å—Ç–∏ –¥–æ–≥–æ–≤—ñ—Ä –ø—Ä–æ –Ω–∞–¥–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–∏—Ö –ø–æ—Å–ª—É–≥ —Ä–æ–∑–≤–∞–∂–∞–ª—å–Ω–æ–≥–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä—É.</p>
    <p>2. –ü–æ—Å–ª—É–≥–∏ –Ω–∞–¥–∞—é—Ç—å—Å—è —É –≤–∏–≥–ª—è–¥—ñ —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É (–∞—Å—Ç—Ä–æ–ª–æ–≥—ñ—á–Ω–∏—Ö –∑–≤—ñ—Ç—ñ–≤), –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ–≥–æ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø—Ä–æ–≥—Ä–∞–º–Ω–æ–≥–æ
        –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è.</p>
    <p>3. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø–æ–≥–æ–¥–∂—É—î—Ç—å—Å—è, —â–æ –ø–æ—Å–ª—É–≥–∏ –º–∞—é—Ç—å –≤–∏–∫–ª—é—á–Ω–æ —Ä–æ–∑–≤–∞–∂–∞–ª—å–Ω–∏–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä. –í–∏–∫–æ–Ω–∞–≤–µ—Ü—å –Ω–µ –Ω–µ—Å–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç—ñ
        –∑–∞ –ø—Ä–∏–π–Ω—è—Ç—ñ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º —Ä—ñ—à–µ–Ω–Ω—è –Ω–∞ –æ—Å–Ω–æ–≤—ñ –Ω–∞–¥–∞–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó.</p>
    <p>4. –û–ø–ª–∞—Ç–∞ –ø–æ—Å–ª—É–≥ –∑–¥—ñ–π—Å–Ω—é—î—Ç—å—Å—è —á–µ—Ä–µ–∑ –ø–ª–∞—Ç—ñ–∂–Ω—É —Å–∏—Å—Ç–µ–º—É –Ω–∞ —É–º–æ–≤–∞—Ö 100% –ø–µ—Ä–µ–¥–æ–ø–ª–∞—Ç–∏.</p>
    <p>5. –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è —Ç–∞ —Ä–µ–∫–≤—ñ–∑–∏—Ç–∏:</p>
    <p><strong>–§–û–ü –°–µ—Ä–Ω—è–∫ –û.–û.</strong><br>
        –Ü–ü–ù: 3169419596<br>
        –ê–¥—Ä–µ—Å–∞: –£–∫—Ä–∞—ó–Ω–∞, –º. –ö–∏—ó–≤, –≤—É–ª. –ö–∞–¥–µ—Ç—Å—å–∫–∏–π –≥–∞–π 7, –∫–≤. 40<br>
        Email: destinycode.online@gmail.com<br>
        –¢–µ–ª–µ—Ñ–æ–Ω: +380939783397</p>
</div>
<div id="legal-content-privacy" style="display:none;">
    <h3>–ü–û–õ–Ü–¢–ò–ö–ê –ö–û–ù–§–Ü–î–ï–ù–¶–Ü–ô–ù–û–°–¢–Ü</h3>
    <p>1. –ú–∏ –∑–±–∏—Ä–∞—î–º–æ –ª–∏—à–µ —Ç—ñ –¥–∞–Ω—ñ, —è–∫—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –¥–ª—è –Ω–∞–¥–∞–Ω–Ω—è –ø–æ—Å–ª—É–≥–∏: –¥–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è, —á–∞—Å, –º—ñ—Å—Ç–æ (–¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É
        –Ω–∞—Ç–∞–ª—å–Ω–æ—ó –∫–∞—Ä—Ç–∏) —Ç–∞ Email (–¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –∑–≤—ñ—Ç—É).</p>
    <p>2. –ú–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞—î–º–æ –≤–∞—à—ñ –¥–∞–Ω—ñ —Ç—Ä–µ—Ç—ñ–º –æ—Å–æ–±–∞–º, –æ–∫—Ä—ñ–º –≤–∏–ø–∞–¥–∫—ñ–≤, –ø–µ—Ä–µ–¥–±–∞—á–µ–Ω–∏—Ö –∑–∞–∫–æ–Ω–æ–¥–∞–≤—Å—Ç–≤–æ–º –∞–±–æ –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏—Ö –¥–ª—è
        –æ–±—Ä–æ–±–∫–∏ –ø–ª–∞—Ç–µ–∂—É (–ø–ª–∞—Ç—ñ–∂–Ω—ñ —à–ª—é–∑–∏).</p>
    <p>3. –í–∏ –º–∞—î—Ç–µ –ø—Ä–∞–≤–æ –≤–∏–º–∞–≥–∞—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –≤–∞—à–∏—Ö –¥–∞–Ω–∏—Ö, –Ω–∞–ø–∏—Å–∞–≤—à–∏ –Ω–∞ <strong>destinycode.online@gmail.com</strong>.</p>
</div>
<div id="legal-content-refund" style="display:none;">
    <h3>–ü–û–õ–Ü–¢–ò–ö–ê –ü–û–í–ï–†–ù–ï–ù–ù–Ø –ö–û–®–¢–Ü–í</h3>
    <p>1. –û—Å–∫—ñ–ª—å–∫–∏ –ø–æ—Å–ª—É–≥–∞ —î —Ü–∏—Ñ—Ä–æ–≤–∏–º —Ç–æ–≤–∞—Ä–æ–º (–∫–æ–Ω—Ç–µ–Ω—Ç–æ–º), —è–∫–∏–π —Å–ø–æ–∂–∏–≤–∞—î—Ç—å—Å—è –≤ –º–æ–º–µ–Ω—Ç –æ—Ç—Ä–∏–º–∞–Ω–Ω—è, –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –∫–æ—à—Ç—ñ–≤
        –º–æ–∂–ª–∏–≤–µ –ª–∏—à–µ —É –≤–∏–ø–∞–¥–∫—É —Ç–µ—Ö–Ω—ñ—á–Ω–æ–≥–æ –∑–±–æ—é (–∑–≤—ñ—Ç –Ω–µ –±—É–ª–æ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ –∞–±–æ –Ω–µ –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ).</p>
    <p>2. –Ø–∫—â–æ –≤–∏ –Ω–µ –æ—Ç—Ä–∏–º–∞–ª–∏ –∑–≤—ñ—Ç –ø—Ä–æ—Ç—è–≥–æ–º 24 –≥–æ–¥–∏–Ω –ø—ñ—Å–ª—è –æ–ø–ª–∞—Ç–∏, –∑–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –Ω–∞
        <strong>destinycode.online@gmail.com</strong>, —ñ –º–∏ –≤–∏—Ä—ñ—à–∏–º–æ –ø—Ä–æ–±–ª–µ–º—É –∞–±–æ –ø–æ–≤–µ—Ä–Ω–µ–º–æ –∫–æ—à—Ç–∏.
    </p>
    <p>3. –°—É–±'—î–∫—Ç–∏–≤–Ω–µ –Ω–µ—Å–ø—Ä–∏–π–Ω—è—Ç—Ç—è —Ç–µ–∫—Å—Ç—É –∑–≤—ñ—Ç—É –Ω–µ —î –ø—ñ–¥—Å—Ç–∞–≤–æ—é –¥–ª—è –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –∫–æ—à—Ç—ñ–≤, –æ—Å–∫—ñ–ª—å–∫–∏ –ø–æ—Å–ª—É–≥–∞ –≤–≤–∞–∂–∞—î—Ç—å—Å—è
        –Ω–∞–¥–∞–Ω–æ—é –Ω–∞–ª–µ–∂–Ω–∏–º —á–∏–Ω–æ–º.</p>
</div>`;function so(n){const t=document.getElementById("app");t.classList.add("funnel-container"),t.innerHTML=uc;try{const L=C.get("currentVariant");if(L&&L.ui){console.log("üé® Applying Variant UI Overrides:",L.id);const E=document.querySelector("h2"),h=document.querySelector("p.text-lg"),d=document.querySelector("#birth-form button .btn-text");if(E&&L.ui.heroTitle&&(E.innerHTML=L.ui.heroTitle,L.id!=="february"&&(E.classList.remove("font-bold"),E.classList.add("font-semibold"),E.style.fontFamily="'Inter', sans-serif"),L.ui.heroPreTitle)){const _=document.createElement("p");_.className="text-base font-semibold mb-3",_.style.cssText="color: #cda45e; letter-spacing: 0.5px;",_.innerHTML=L.ui.heroPreTitle,E.parentNode&&E.parentNode.insertBefore(_,E)}if(h&&L.ui.heroSubtitle&&(h.innerHTML=L.ui.heroSubtitle),d&&L.ui.buttonText&&(d.innerText=L.ui.buttonText),L.ui.backgroundColor&&(console.log("üñåÔ∏è Applying Variant Background Color:",L.ui.backgroundColor),document.body.style.backgroundColor=L.ui.backgroundColor),L.ui.heroFeatures){const _=document.getElementById("birth-form");if(_&&_.parentNode){const b=document.createElement("div");b.innerHTML=L.ui.heroFeatures,_.parentNode.insertBefore(b,_.nextSibling)}}const y=document.getElementById("hero-subtitle-cta");y&&y.addEventListener("click",()=>{ct.trigger("light");const _=document.querySelector(".input-field");_&&(_.scrollIntoView({behavior:"smooth",block:"center"}),_.classList.remove("animate-pulse"),_.style.animation="none",_.offsetHeight,_.style.animation="gentle-shake 0.5s ease-in-out 2")})}}catch(L){console.error("‚ùå Error applying variant UI:",L)}if(!document.getElementById("global-anim-styles")){const L=document.createElement("style");L.id="global-anim-styles",L.innerHTML=`
            @keyframes gentle-shake {
                0%, 100% { transform: translateX(0); box-shadow: 0 0 0 0 rgba(205, 164, 94, 0); }
                25% { transform: translateX(-5px) rotate(-1deg); }
                75% { transform: translateX(5px) rotate(1deg); box-shadow: 0 0 20px 0 rgba(205, 164, 94, 0.5); }
            }

            /* üå¨Ô∏è "Mystic Breath" for Subtitle (used only if element exists) */
            @keyframes mystic-breath {
                0%, 100% { 
                    transform: scale(1); 
                    box-shadow: 0 0 0 rgba(255,255,255,0);
                    border-color: rgba(255,255,255,0.2);
                }
                50% { 
                    transform: scale(0.98); /* Squeeze inward */
                    box-shadow: 0 0 10px rgba(255, 255, 255, 0.1); /* Very subtle glow */
                    border-color: rgba(255,255,255,0.5);
                }
            }
            #hero-subtitle-cta {
                animation: mystic-breath 6s ease-in-out infinite;
            }

            /* ‚ú® "Star Shine" for Date Input Field ONLY (Stage 1) */
            /* Excludes time input on Stage 4 */
            #landing-step .input-field {
                position: relative;
                overflow: hidden;
            }
            #landing-step .input-field::after {
                content: "";
                position: absolute;
                top: 0;
                left: -50px;
                width: 17px;
                height: 100%;
                background: linear-gradient(
                    90deg,
                    transparent,
                    rgba(255, 255, 255, 0.8),
                    transparent
                );
                transform: skewX(-25deg);
                animation: shine-anim 11s infinite;
                animation-delay: 3s;
                pointer-events: none;
                z-index: 5; 
            }
            
            /* ‚ú® "Star Shine" Restored (Scoped to .shine-effect) */
            .shine-effect {
                position: relative;
                overflow: hidden;
            }
            .shine-effect::after {
                content: "";
                position: absolute;
                top: 0;
                left: -50px;
                width: 17px;
                height: 100%;
                background: linear-gradient(
                    90deg,
                    transparent,
                    rgba(255, 255, 255, 0.8),
                    transparent
                );
                transform: skewX(-25deg);
                animation: shine-anim 11s infinite;
                animation-delay: 3s;
                pointer-events: none;
                z-index: 5; 
            }
            
            @keyframes shine-anim {
                0% { left: -50px; }
                45% { left: 150%; } 
                100% { left: 150%; }
            }
        `,document.head.appendChild(L)}const e=document.getElementById("birth-form"),r=document.getElementById("birth-date"),i=document.getElementById("error-message"),o=document.getElementById("date-placeholder"),l=e.querySelector('button[type="submit"]'),u=document.getElementById("info-modal"),p=document.getElementById("legal-modal"),m=document.getElementById("open-info-modal-btn"),w=document.getElementById("close-info-modal-icon"),T=document.getElementById("close-info-modal-btn"),v=document.getElementById("close-legal-modal-icon"),D=document.getElementById("close-legal-modal-btn"),A=document.getElementById("legal-modal-body"),V=document.querySelectorAll(".legal-link[data-legal-type]");r&&r.addEventListener("blur",L=>{L.target.value&&(l.style.animation="none",requestAnimationFrame(()=>{l.style.animation="gentle-shake 0.5s ease-in-out 2"}),setTimeout(()=>{l.style.animation=""},1e3))});function S(){u&&(u.style.display="flex")}function P(){u&&(u.style.display="none")}function R(L){const E=document.getElementById("legal-content-"+L);E&&p&&A&&(A.innerHTML=E.innerHTML,p.style.display="flex")}function F(){p&&(p.style.display="none")}m&&m.addEventListener("click",()=>{ct.trigger("light"),S()}),w&&w.addEventListener("click",()=>{ct.trigger("light"),P()}),T&&T.addEventListener("click",()=>{ct.trigger("light"),P()}),v&&v.addEventListener("click",()=>{ct.trigger("light"),F()}),D&&D.addEventListener("click",()=>{ct.trigger("light"),F()}),u&&u.addEventListener("click",L=>{L.target===u&&P()}),p&&p.addEventListener("click",L=>{L.target===p&&F()}),V.forEach(L=>{L.addEventListener("click",E=>{const h=E.target.getAttribute("data-legal-type");P(),setTimeout(()=>{R(h)},50)})});function O(){const L=r.value;if(!L)o.innerText="–û–±—Ä–∞—Ç–∏ –¥–∞—Ç—É –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è",o.style.color="var(--secondary-text-color)";else{const E=L.split("-");if(E.length===3){const h=`${E[2]}.${E[1]}.${E[0]}`;o.innerText=h,o.style.color="var(--primary-text-color)",i&&(i.style.display="none")}}}function $(){r.value===""&&(r.value="1995-01-01")}r.addEventListener("input",O),r.addEventListener("change",O),r.addEventListener("blur",O),r.addEventListener("focus",$),r.addEventListener("click",$),r.addEventListener("touchstart",$),O(),e.addEventListener("submit",async function(L){L.preventDefault(),ct.trigger("heavy");const E=r.value;if(E==="")ct.trigger("error"),i.innerText="–ë—É–¥—å –ª–∞—Å–∫–∞, –æ–±–µ—Ä–∏ –¥–∞—Ç—É –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è.",i.style.display="block";else{let h=function(d,y){d.classList.add("loading"),d.disabled=!0};i.style.display="none",C.set("date",E),h(l),xs(),n.navigateTo("loading")}})}const hc=`<!-- üî• UPDATE: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ step-centered —Ç–∞ margin: auto –¥–ª—è —ñ–¥–µ–∞–ª—å–Ω–æ–≥–æ —Ü–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è —É funnel-container -->
<section id="loading-step" class="funnel-step active step-centered space-y-6 text-center" style="margin-top: auto; margin-bottom: auto;">
    
    <!-- –°–ø—ñ–Ω–µ—Ä (—Å—Ç–∏–ª—ñ –±–µ—Ä—É—Ç—å—Å—è –∑ main.css, –ø—Ä–∏–±—Ä–∞–Ω–æ –∑–∞–π–≤—ñ inline —Å—Ç–∏–ª—ñ) -->
    <div class="spinner" style="margin-left: auto; margin-right: auto;"></div>
    
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ç–µ–∫—Å—Ç—É -->
    <div id="loading-typing-container" class="typing-container">
        <span id="loading-text"></span>
        <!-- –ö—É—Ä—Å–æ—Ä (—Å—Ç–∏–ª—ñ –∑ main.css) -->
        <span id="loading-cursor" class="typing-cursor" style="display: none;"></span>
    </div>

</section>`;function ca(n,t,e,r=50,i=0,o=!1){return new Promise(l=>{let u=0;t&&(t.style.display="inline-block"),n.innerHTML="";function p(){u<e.length?(n.innerHTML=e.substring(0,u+1),u++,setTimeout(p,r)):setTimeout(()=>{!o&&t&&(t.style.display="none"),l()},i)}p()})}async function dc(n){const t=document.getElementById("app");t.classList.add("funnel-container"),t.innerHTML=hc,document.body.classList.add("warp-mode");const e=document.getElementById("loading-text"),r=document.getElementById("loading-cursor"),i=C.get("date");gr();let o=!1;const l=lc(i).then(m=>(C.set("freeReport",m),o=!0,m)).catch(m=>(console.error("API Error:",m),{error:!0,title:"‚ùå –ü–æ–º–∏–ª–∫–∞ –ê–Ω–∞–ª—ñ–∑—É",psychological_analysis:"<p>–ù–∞ –∂–∞–ª—å, —Å—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –ø—ñ–¥ —á–∞—Å –æ–±—Ä–æ–±–∫–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –≤—ñ–¥ –®–Ü.</p>"})),u=[{text:"–ê–Ω–∞–ª—ñ–∑—É—é –ø–æ–ª–æ–∂–µ–Ω–Ω—è –ø–ª–∞–Ω–µ—Ç...",pause:1e3},{text:"–ó'—î–¥–Ω—É—é—Å—å –∑ –µ—Ñ–µ–º–µ—Ä–∏–¥–∞–º–∏ NASA...",pause:1200},{text:"–ó—á–∏—Ç—É—é —Ç–≤—ñ–π –µ–Ω–µ—Ä–≥–µ—Ç–∏—á–Ω–∏–π –∫–æ–¥...",pause:1200},{text:"–†–æ–∑—à–∏—Ñ—Ä–æ–≤—É—é –∫–∞—Ä–º—ñ—á–Ω—ñ –≤—É–∑–ª–∏...",pause:1500},{text:"–ë—É–¥—É—é —Ç–≤–æ—é –Ω–∞—Ç–∞–ª—å–Ω—É –∫–∞—Ä—Ç—É...",pause:1500},{text:"–ü—Ä–∏–≥–æ—Ç—É–π—Å—è –¥—ñ–∑–Ω–∞—Ç–∏—Å—å, –Ω–∞—Å–∫—ñ–ª—å–∫–∏ —Ç–∏ –¥–∏–≤–æ–≤–∏–∂–Ω–∞ üíñ",pause:2e3,final:!0}],p=(async()=>{for(let m=0;m<u.length;m++){if(o){console.log("üöÄ API Ready! Skipping remaining animation steps.");break}const w=u[m];if(e&&r){const T=o?300:w.pause;await ca(e,r,w.text,50,T,w.final)}if(o){console.log("üöÄ API Ready! Animation loop stopped.");break}}r&&(r.style.display="none")})();await Promise.all([p,l]),document.body.classList.remove("warp-mode"),n.navigateTo("result")}const fc=`<!-- üî• UPDATE: –ó–º–µ–Ω—à–µ–Ω–æ padding-bottom —Å–µ–∫—Ü—ñ—ó –¥–æ 140px, —â–æ–± –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—Ç–∏ –∫–æ–º–ø–∞–∫—Ç–Ω—ñ—à–æ–º—É —Ñ—É—Ç–µ—Ä—É -->
<section id="result-step" class="funnel-step active space-y-6" style="padding-bottom: 140px;">
    <h2 class="text-2xl font-bold text-center text-white" id="result-title">–ê–Ω–∞–ª—ñ–∑ —Ç–≤–æ—î—ó –æ—Å–æ–±–∏—Å—Ç–æ—Å—Ç—ñ</h2>
    
    <!-- –û—Å–Ω–æ–≤–Ω–∞ –∫–∞—Ä—Ç–∫–∞ –∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º -->
    <div class="p-5 rounded-xl space-y-3" style="background-color: var(--card-bg-color); border: 1px solid var(--border-color);">
        <h3 class="text-xl font-bold" style="color: var(--accent-color);" id="free-report-title">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∑–∞–ø–æ–≤–Ω—é—î—Ç—å—Å—è —á–µ—Ä–µ–∑ JS -->
        </h3>
        <div id="free-report-text" class="text-left leading-relaxed space-y-4" style="color: var(--secondary-text-color);">
            <i>(–¢—É—Ç –∑'—è–≤–∏—Ç—å—Å—è —Ç–≤—ñ–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏–π –∞–Ω–∞–ª—ñ–∑...)</i>
        </div>

        <!-- –î–∏–≤–∞–π–¥–µ—Ä -->
        <div class="relative py-4">
            <div class="absolute inset-0 flex items-center" aria-hidden="true">
                <div class="w-full border-t border-gray-700"></div>
            </div>
            <div class="relative flex justify-center">
                <span class="px-3 text-sm text-gray-500" style="background-color: var(--card-bg-color);">–ê–õ–ï –¶–ï –©–ï –ù–ï –í–°–ï</span>
            </div>
        </div>

        <!-- –°—Ç–∞—Ç–∏—á–Ω–∏–π –ø—Ä–æ–¥–∞—é—á–∏–π –±–ª–æ–∫ -->
        <div id="marketing-hook-block" class="text-center leading-relaxed">
            <p class="text-base mb-4" style="color: var(--primary-text-color);">
                –¶–µ –ª–∏—à–µ <span style="color: var(--accent-color); font-weight: bold;">8%</span> –∞–Ω–∞–ª—ñ–∑—É —Ç–≤–æ—î—ó –æ—Å–æ–±–∏—Å—Ç–æ—Å—Ç—ñ.
                <br>
                <span style="color: var(--secondary-text-color); font-size: 0.95rem;">–î—ñ–∑–Ω–∞–π—Å—è –±—ñ–ª—å—à –¥–µ—Ç–∞–ª—å–Ω–æ –ø—Ä–æ –≤—Å—ñ —Å—Ñ–µ—Ä–∏ —Å–≤–æ–≥–æ –∂–∏—Ç—Ç—è:</span>
            </p>
            <ul class="text-left inline-block space-y-2" style="color: var(--secondary-text-color); font-size: 0.95rem;">
                <li class="flex items-center"><span class="mr-2 text-xl">‚ù§Ô∏è‚Äçüî•</span> –ö–æ—Ö–∞–Ω–Ω—è —Ç–∞ —Å—Ç–æ—Å—É–Ω–∫–∏</li>
                <li class="flex items-center"><span class="mr-2 text-xl">üí∏</span> –ì—Ä–æ—à—ñ —Ç–∞ –∫–∞—Ä'—î—Ä–∞</li>
                <li class="flex items-center"><span class="mr-2 text-xl">üîÆ</span> –ö–∞—Ä–º—ñ—á–Ω—ñ —É—Ä–æ–∫–∏ —Ç–∞ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è</li>
                <li class="flex items-center"><span class="mr-2 text-xl">‚ö°Ô∏è</span> –¢–≤–æ—ó –º–∞–π–±—É—Ç–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ</li>
            </ul>
        </div>
    </div>

    <!-- üî• NEW STICKY FOOTER (Compact Version) -->
    <!-- UPDATE: –î–æ–¥–∞–Ω–æ inline styles –¥–ª—è –∑–º–µ–Ω—à–µ–Ω–Ω—è –≤—ñ–¥—Å—Ç—É–ø—ñ–≤ (padding) –∑–≤–µ—Ä—Ö—É —Ç–∞ –∑–Ω–∏–∑—É -->
    <div class="sticky-paywall-footer" style="padding-top: 1rem; padding-bottom: calc(1rem + env(safe-area-inset-bottom));">
        
        <!-- –õ–æ–∫–∞–ª—å–Ω—ñ —Å—Ç–∏–ª—ñ –¥–ª—è –∞–Ω—ñ–º–∞—Ü—ñ—ó —Å—Ç—Ä—ñ–ª–æ—á–æ–∫ (–∑–±–µ—Ä–µ–∂–µ–Ω–æ –∑ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª—É) -->
        <style>
            @keyframes runway-lights {
                0% { opacity: 0.3; }
                50% { opacity: 1; }
                100% { opacity: 0.3; }
            }
            .runway-arrow {
                animation: runway-lights 1.2s infinite ease-in-out both;
                display: inline-block;
                color: rgba(0, 0, 0, 0.75); /* –ú'—è–∫–∏–π —á–æ—Ä–Ω–∏–π –∫–æ–ª—ñ—Ä —Å—Ç—Ä—ñ–ª–æ—á–æ–∫ */
            }
            .runway-arrow:nth-child(1) { animation-delay: 0s; }
            .runway-arrow:nth-child(2) { animation-delay: 0.2s; }
            .runway-arrow:nth-child(3) { animation-delay: 0.4s; }
        </style>

        <!-- –ö–Ω–æ–ø–∫–∞ —Ä–æ–∑—Ç—è–≥–Ω—É—Ç–∞ –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É (w-full), ID –∑–±–µ—Ä–µ–∂–µ–Ω–æ -->
        <button id="upgrade-button" class="btn btn-primary w-full !text-lg !py-4 btn-pulse-glow shadow-2xl relative overflow-hidden">
            <span class="btn-text flex items-center justify-center gap-2">
                –û—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ–≤–Ω–∏–π –∞–Ω–∞–ª—ñ–∑
                <span class="font-bold tracking-widest flex gap-[1px]">
                    <span class="runway-arrow">&gt;</span>
                    <span class="runway-arrow">&gt;</span>
                    <span class="runway-arrow">&gt;</span>
                </span>
            </span>
            <span class="btn-spinner"></span>
        </button>

        <!-- –î–æ–¥–∞—Ç–∫–æ–≤–∏–π –º—ñ–∫—Ä–æ-—Ç–µ–∫—Å—Ç –¥–æ–≤—ñ—Ä–∏ (–ó–º–µ–Ω—à–µ–Ω–æ margin-top –∑ mt-3 –¥–æ mt-2) -->
        <div class="mt-2 flex items-center justify-center opacity-70">
             <span class="text-[10px] text-gray-400 uppercase tracking-wider font-semibold">
                üîí –¢–≤—ñ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–±–µ—Ä–µ–∂–µ–Ω–æ
            </span>
        </div>
    </div>
</section>`,pc=()=>{};var io={};const ua=function(n){const t=[];let e=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?t[e++]=i:i<2048?(t[e++]=i>>6|192,t[e++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),t[e++]=i>>18|240,t[e++]=i>>12&63|128,t[e++]=i>>6&63|128,t[e++]=i&63|128):(t[e++]=i>>12|224,t[e++]=i>>6&63|128,t[e++]=i&63|128)}return t},mc=function(n){const t=[];let e=0,r=0;for(;e<n.length;){const i=n[e++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const o=n[e++];t[r++]=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){const o=n[e++],l=n[e++],u=n[e++],p=((i&7)<<18|(o&63)<<12|(l&63)<<6|u&63)-65536;t[r++]=String.fromCharCode(55296+(p>>10)),t[r++]=String.fromCharCode(56320+(p&1023))}else{const o=n[e++],l=n[e++];t[r++]=String.fromCharCode((i&15)<<12|(o&63)<<6|l&63)}}return t.join("")},ha={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,t){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){const o=n[i],l=i+1<n.length,u=l?n[i+1]:0,p=i+2<n.length,m=p?n[i+2]:0,w=o>>2,T=(o&3)<<4|u>>4;let v=(u&15)<<2|m>>6,D=m&63;p||(D=64,l||(v=64)),r.push(e[w],e[T],e[v],e[D])}return r.join("")},encodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(n):this.encodeByteArray(ua(n),t)},decodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(n):mc(this.decodeStringToByteArray(n,t))},decodeStringToByteArray(n,t){this.init_();const e=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){const o=e[n.charAt(i++)],u=i<n.length?e[n.charAt(i)]:0;++i;const m=i<n.length?e[n.charAt(i)]:64;++i;const T=i<n.length?e[n.charAt(i)]:64;if(++i,o==null||u==null||m==null||T==null)throw new gc;const v=o<<2|u>>4;if(r.push(v),m!==64){const D=u<<4&240|m>>2;if(r.push(D),T!==64){const A=m<<6&192|T;r.push(A)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class gc extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const yc=function(n){const t=ua(n);return ha.encodeByteArray(t,!0)},Zn=function(n){return yc(n).replace(/\./g,"")},_c=function(n){try{return ha.decodeString(n,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function vc(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Ec=()=>vc().__FIREBASE_DEFAULTS__,wc=()=>{if(typeof process>"u"||typeof io>"u")return;const n=io.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},bc=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=n&&_c(n[1]);return t&&JSON.parse(t)},Cs=()=>{try{return pc()||Ec()||wc()||bc()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Tc=n=>Cs()?.emulatorHosts?.[n],Ic=n=>{const t=Tc(n);if(!t)return;const e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),r]:[t.substring(0,e),r]},da=()=>Cs()?.config;class xc{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,r)=>{e?this.reject(e):this.resolve(r),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,r))}}}function Ps(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Ac(n){return(await fetch(n,{credentials:"include"})).ok}function Sc(n,t){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const e={alg:"none",type:"JWT"},r=t||"demo-project",i=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const l={iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Zn(JSON.stringify(e)),Zn(JSON.stringify(l)),""].join(".")}const an={};function Cc(){const n={prod:[],emulator:[]};for(const t of Object.keys(an))an[t]?n.emulator.push(t):n.prod.push(t);return n}function Pc(n){let t=document.getElementById(n),e=!1;return t||(t=document.createElement("div"),t.setAttribute("id",n),e=!0),{created:e,element:t}}let oo=!1;function Rc(n,t){if(typeof window>"u"||typeof document>"u"||!Ps(window.location.host)||an[n]===t||an[n]||oo)return;an[n]=t;function e(v){return`__firebase__banner__${v}`}const r="__firebase__banner",o=Cc().prod.length>0;function l(){const v=document.getElementById(r);v&&v.remove()}function u(v){v.style.display="flex",v.style.background="#7faaf0",v.style.position="fixed",v.style.bottom="5px",v.style.left="5px",v.style.padding=".5em",v.style.borderRadius="5px",v.style.alignItems="center"}function p(v,D){v.setAttribute("width","24"),v.setAttribute("id",D),v.setAttribute("height","24"),v.setAttribute("viewBox","0 0 24 24"),v.setAttribute("fill","none"),v.style.marginLeft="-6px"}function m(){const v=document.createElement("span");return v.style.cursor="pointer",v.style.marginLeft="16px",v.style.fontSize="24px",v.innerHTML=" &times;",v.onclick=()=>{oo=!0,l()},v}function w(v,D){v.setAttribute("id",D),v.innerText="Learn more",v.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",v.setAttribute("target","__blank"),v.style.paddingLeft="5px",v.style.textDecoration="underline"}function T(){const v=Pc(r),D=e("text"),A=document.getElementById(D)||document.createElement("span"),V=e("learnmore"),S=document.getElementById(V)||document.createElement("a"),P=e("preprendIcon"),R=document.getElementById(P)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(v.created){const F=v.element;u(F),w(S,V);const O=m();p(R,P),F.append(R,A,S,O),document.body.appendChild(F)}o?(A.innerText="Preview backend disconnected.",R.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(R.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,A.innerText="Preview backend running in this workspace."),A.setAttribute("id",D)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",T):T()}function kc(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Dc(){const n=Cs()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Vc(){return!Dc()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Mc(){try{return typeof indexedDB=="object"}catch{return!1}}function Lc(){return new Promise((n,t)=>{try{let e=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),e||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{e=!1},i.onerror=()=>{t(i.error?.message||"")}}catch(e){t(e)}})}const Nc="FirebaseError";class Ne extends Error{constructor(t,e,r){super(e),this.code=t,this.customData=r,this.name=Nc,Object.setPrototypeOf(this,Ne.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,fa.prototype.create)}}class fa{constructor(t,e,r){this.service=t,this.serviceName=e,this.errors=r}create(t,...e){const r=e[0]||{},i=`${this.service}/${t}`,o=this.errors[t],l=o?Oc(o,r):"Error",u=`${this.serviceName}: ${l} (${i}).`;return new Ne(i,u,r)}}function Oc(n,t){return n.replace(Fc,(e,r)=>{const i=t[r];return i!=null?String(i):`<${r}?>`})}const Fc=/\{\$([^}]+)}/g;function tr(n,t){if(n===t)return!0;const e=Object.keys(n),r=Object.keys(t);for(const i of e){if(!r.includes(i))return!1;const o=n[i],l=t[i];if(ao(o)&&ao(l)){if(!tr(o,l))return!1}else if(o!==l)return!1}for(const i of r)if(!e.includes(i))return!1;return!0}function ao(n){return n!==null&&typeof n=="object"}function er(n){return n&&n._delegate?n._delegate:n}class fn{constructor(t,e,r){this.name=t,this.instanceFactory=e,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const oe="[DEFAULT]";class Bc{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const r=new xc;if(this.instancesDeferred.set(e,r),this.isInitialized(e)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:e});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){const e=this.normalizeInstanceIdentifier(t?.identifier),r=t?.optional??!1;if(this.isInitialized(e)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:e})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if($c(t))try{this.getOrInitializeService({instanceIdentifier:oe})}catch{}for(const[e,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(e);try{const o=this.getOrInitializeService({instanceIdentifier:i});r.resolve(o)}catch{}}}}clearInstance(t=oe){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=oe){return this.instances.has(t)}getOptions(t=oe){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,r=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:e});for(const[o,l]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(o);r===u&&l.resolve(i)}return i}onInit(t,e){const r=this.normalizeInstanceIdentifier(e),i=this.onInitCallbacks.get(r)??new Set;i.add(t),this.onInitCallbacks.set(r,i);const o=this.instances.get(r);return o&&t(o,r),()=>{i.delete(t)}}invokeOnInitCallbacks(t,e){const r=this.onInitCallbacks.get(e);if(r)for(const i of r)try{i(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Uc(t),options:e}),this.instances.set(t,r),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch{}return r||null}normalizeInstanceIdentifier(t=oe){return this.component?this.component.multipleInstances?t:oe:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Uc(n){return n===oe?void 0:n}function $c(n){return n.instantiationMode==="EAGER"}class jc{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new Bc(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}var G;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(G||(G={}));const Hc={debug:G.DEBUG,verbose:G.VERBOSE,info:G.INFO,warn:G.WARN,error:G.ERROR,silent:G.SILENT},qc=G.INFO,zc={[G.DEBUG]:"log",[G.VERBOSE]:"log",[G.INFO]:"info",[G.WARN]:"warn",[G.ERROR]:"error"},Gc=(n,t,...e)=>{if(t<n.logLevel)return;const r=new Date().toISOString(),i=zc[t];if(i)console[i](`[${r}]  ${n.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class pa{constructor(t){this.name=t,this._logLevel=qc,this._logHandler=Gc,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in G))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Hc[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,G.DEBUG,...t),this._logHandler(this,G.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,G.VERBOSE,...t),this._logHandler(this,G.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,G.INFO,...t),this._logHandler(this,G.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,G.WARN,...t),this._logHandler(this,G.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,G.ERROR,...t),this._logHandler(this,G.ERROR,...t)}}const Wc=(n,t)=>t.some(e=>n instanceof e);let lo,co;function Kc(){return lo||(lo=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Qc(){return co||(co=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const ma=new WeakMap,is=new WeakMap,ga=new WeakMap,Qr=new WeakMap,Rs=new WeakMap;function Yc(n){const t=new Promise((e,r)=>{const i=()=>{n.removeEventListener("success",o),n.removeEventListener("error",l)},o=()=>{e(Qt(n.result)),i()},l=()=>{r(n.error),i()};n.addEventListener("success",o),n.addEventListener("error",l)});return t.then(e=>{e instanceof IDBCursor&&ma.set(e,n)}).catch(()=>{}),Rs.set(t,n),t}function Xc(n){if(is.has(n))return;const t=new Promise((e,r)=>{const i=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",l),n.removeEventListener("abort",l)},o=()=>{e(),i()},l=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",o),n.addEventListener("error",l),n.addEventListener("abort",l)});is.set(n,t)}let os={get(n,t,e){if(n instanceof IDBTransaction){if(t==="done")return is.get(n);if(t==="objectStoreNames")return n.objectStoreNames||ga.get(n);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return Qt(n[t])},set(n,t,e){return n[t]=e,!0},has(n,t){return n instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in n}};function Jc(n){os=n(os)}function Zc(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){const r=n.call(Yr(this),t,...e);return ga.set(r,t.sort?t.sort():[t]),Qt(r)}:Qc().includes(n)?function(...t){return n.apply(Yr(this),t),Qt(ma.get(this))}:function(...t){return Qt(n.apply(Yr(this),t))}}function tu(n){return typeof n=="function"?Zc(n):(n instanceof IDBTransaction&&Xc(n),Wc(n,Kc())?new Proxy(n,os):n)}function Qt(n){if(n instanceof IDBRequest)return Yc(n);if(Qr.has(n))return Qr.get(n);const t=tu(n);return t!==n&&(Qr.set(n,t),Rs.set(t,n)),t}const Yr=n=>Rs.get(n);function eu(n,t,{blocked:e,upgrade:r,blocking:i,terminated:o}={}){const l=indexedDB.open(n,t),u=Qt(l);return r&&l.addEventListener("upgradeneeded",p=>{r(Qt(l.result),p.oldVersion,p.newVersion,Qt(l.transaction),p)}),e&&l.addEventListener("blocked",p=>e(p.oldVersion,p.newVersion,p)),u.then(p=>{o&&p.addEventListener("close",()=>o()),i&&p.addEventListener("versionchange",m=>i(m.oldVersion,m.newVersion,m))}).catch(()=>{}),u}const nu=["get","getKey","getAll","getAllKeys","count"],ru=["put","add","delete","clear"],Xr=new Map;function uo(n,t){if(!(n instanceof IDBDatabase&&!(t in n)&&typeof t=="string"))return;if(Xr.get(t))return Xr.get(t);const e=t.replace(/FromIndex$/,""),r=t!==e,i=ru.includes(e);if(!(e in(r?IDBIndex:IDBObjectStore).prototype)||!(i||nu.includes(e)))return;const o=async function(l,...u){const p=this.transaction(l,i?"readwrite":"readonly");let m=p.store;return r&&(m=m.index(u.shift())),(await Promise.all([m[e](...u),i&&p.done]))[0]};return Xr.set(t,o),o}Jc(n=>({...n,get:(t,e,r)=>uo(t,e)||n.get(t,e,r),has:(t,e)=>!!uo(t,e)||n.has(t,e)}));class su{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(iu(e)){const r=e.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(e=>e).join(" ")}}function iu(n){return n.getComponent()?.type==="VERSION"}const as="@firebase/app",ho="0.14.7";const jt=new pa("@firebase/app"),ou="@firebase/app-compat",au="@firebase/analytics-compat",lu="@firebase/analytics",cu="@firebase/app-check-compat",uu="@firebase/app-check",hu="@firebase/auth",du="@firebase/auth-compat",fu="@firebase/database",pu="@firebase/data-connect",mu="@firebase/database-compat",gu="@firebase/functions",yu="@firebase/functions-compat",_u="@firebase/installations",vu="@firebase/installations-compat",Eu="@firebase/messaging",wu="@firebase/messaging-compat",bu="@firebase/performance",Tu="@firebase/performance-compat",Iu="@firebase/remote-config",xu="@firebase/remote-config-compat",Au="@firebase/storage",Su="@firebase/storage-compat",Cu="@firebase/firestore",Pu="@firebase/ai",Ru="@firebase/firestore-compat",ku="firebase",Du="12.8.0";const ls="[DEFAULT]",Vu={[as]:"fire-core",[ou]:"fire-core-compat",[lu]:"fire-analytics",[au]:"fire-analytics-compat",[uu]:"fire-app-check",[cu]:"fire-app-check-compat",[hu]:"fire-auth",[du]:"fire-auth-compat",[fu]:"fire-rtdb",[pu]:"fire-data-connect",[mu]:"fire-rtdb-compat",[gu]:"fire-fn",[yu]:"fire-fn-compat",[_u]:"fire-iid",[vu]:"fire-iid-compat",[Eu]:"fire-fcm",[wu]:"fire-fcm-compat",[bu]:"fire-perf",[Tu]:"fire-perf-compat",[Iu]:"fire-rc",[xu]:"fire-rc-compat",[Au]:"fire-gcs",[Su]:"fire-gcs-compat",[Cu]:"fire-fst",[Ru]:"fire-fst-compat",[Pu]:"fire-vertex","fire-js":"fire-js",[ku]:"fire-js-all"};const nr=new Map,Mu=new Map,cs=new Map;function fo(n,t){try{n.container.addComponent(t)}catch(e){jt.debug(`Component ${t.name} failed to register with FirebaseApp ${n.name}`,e)}}function rr(n){const t=n.name;if(cs.has(t))return jt.debug(`There were multiple attempts to register component ${t}.`),!1;cs.set(t,n);for(const e of nr.values())fo(e,n);for(const e of Mu.values())fo(e,n);return!0}function Lu(n,t){const e=n.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),n.container.getProvider(t)}function Nu(n){return n==null?!1:n.settings!==void 0}const Ou={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Yt=new fa("app","Firebase",Ou);class Fu{constructor(t,e,r){this._isDeleted=!1,this._options={...t},this._config={...e},this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new fn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Yt.create("app-deleted",{appName:this._name})}}const Bu=Du;function ya(n,t={}){let e=n;typeof t!="object"&&(t={name:t});const r={name:ls,automaticDataCollectionEnabled:!0,...t},i=r.name;if(typeof i!="string"||!i)throw Yt.create("bad-app-name",{appName:String(i)});if(e||(e=da()),!e)throw Yt.create("no-options");const o=nr.get(i);if(o){if(tr(e,o.options)&&tr(r,o.config))return o;throw Yt.create("duplicate-app",{appName:i})}const l=new jc(i);for(const p of cs.values())l.addComponent(p);const u=new Fu(e,r,l);return nr.set(i,u),u}function Uu(n=ls){const t=nr.get(n);if(!t&&n===ls&&da())return ya();if(!t)throw Yt.create("no-app",{appName:n});return t}function Ae(n,t,e){let r=Vu[n]??n;e&&(r+=`-${e}`);const i=r.match(/\s|\//),o=t.match(/\s|\//);if(i||o){const l=[`Unable to register library "${r}" with version "${t}":`];i&&l.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&o&&l.push("and"),o&&l.push(`version name "${t}" contains illegal characters (whitespace or "/")`),jt.warn(l.join(" "));return}rr(new fn(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}const $u="firebase-heartbeat-database",ju=1,pn="firebase-heartbeat-store";let Jr=null;function _a(){return Jr||(Jr=eu($u,ju,{upgrade:(n,t)=>{switch(t){case 0:try{n.createObjectStore(pn)}catch(e){console.warn(e)}}}}).catch(n=>{throw Yt.create("idb-open",{originalErrorMessage:n.message})})),Jr}async function Hu(n){try{const e=(await _a()).transaction(pn),r=await e.objectStore(pn).get(va(n));return await e.done,r}catch(t){if(t instanceof Ne)jt.warn(t.message);else{const e=Yt.create("idb-get",{originalErrorMessage:t?.message});jt.warn(e.message)}}}async function po(n,t){try{const r=(await _a()).transaction(pn,"readwrite");await r.objectStore(pn).put(t,va(n)),await r.done}catch(e){if(e instanceof Ne)jt.warn(e.message);else{const r=Yt.create("idb-set",{originalErrorMessage:e?.message});jt.warn(r.message)}}}function va(n){return`${n.name}!${n.options.appId}`}const qu=1024,zu=30;class Gu{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Ku(e),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=mo();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(i=>i.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:e}),this._heartbeatsCache.heartbeats.length>zu){const i=Qu(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(t){jt.warn(t)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=mo(),{heartbeatsToSend:e,unsentEntries:r}=Wu(this._heartbeatsCache.heartbeats),i=Zn(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return jt.warn(t),""}}}function mo(){return new Date().toISOString().substring(0,10)}function Wu(n,t=qu){const e=[];let r=n.slice();for(const i of n){const o=e.find(l=>l.agent===i.agent);if(o){if(o.dates.push(i.date),go(e)>t){o.dates.pop();break}}else if(e.push({agent:i.agent,dates:[i.date]}),go(e)>t){e.pop();break}r=r.slice(1)}return{heartbeatsToSend:e,unsentEntries:r}}class Ku{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Mc()?Lc().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const e=await Hu(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){const r=await this.read();return po(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){if(await this._canUseIndexedDBPromise){const r=await this.read();return po(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...t.heartbeats]})}else return}}function go(n){return Zn(JSON.stringify({version:2,heartbeats:n})).length}function Qu(n){if(n.length===0)return-1;let t=0,e=n[0].date;for(let r=1;r<n.length;r++)n[r].date<e&&(e=n[r].date,t=r);return t}function Yu(n){rr(new fn("platform-logger",t=>new su(t),"PRIVATE")),rr(new fn("heartbeat",t=>new Gu(t),"PRIVATE")),Ae(as,ho,n),Ae(as,ho,"esm2020"),Ae("fire-js","")}Yu("");var Xu="firebase",Ju="12.8.0";Ae(Xu,Ju,"app");var yo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var ks;(function(){var n;function t(E,h){function d(){}d.prototype=h.prototype,E.F=h.prototype,E.prototype=new d,E.prototype.constructor=E,E.D=function(y,_,b){for(var g=Array(arguments.length-2),nt=2;nt<arguments.length;nt++)g[nt-2]=arguments[nt];return h.prototype[_].apply(y,g)}}function e(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}t(r,e),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(E,h,d){d||(d=0);const y=Array(16);if(typeof h=="string")for(var _=0;_<16;++_)y[_]=h.charCodeAt(d++)|h.charCodeAt(d++)<<8|h.charCodeAt(d++)<<16|h.charCodeAt(d++)<<24;else for(_=0;_<16;++_)y[_]=h[d++]|h[d++]<<8|h[d++]<<16|h[d++]<<24;h=E.g[0],d=E.g[1],_=E.g[2];let b=E.g[3],g;g=h+(b^d&(_^b))+y[0]+3614090360&4294967295,h=d+(g<<7&4294967295|g>>>25),g=b+(_^h&(d^_))+y[1]+3905402710&4294967295,b=h+(g<<12&4294967295|g>>>20),g=_+(d^b&(h^d))+y[2]+606105819&4294967295,_=b+(g<<17&4294967295|g>>>15),g=d+(h^_&(b^h))+y[3]+3250441966&4294967295,d=_+(g<<22&4294967295|g>>>10),g=h+(b^d&(_^b))+y[4]+4118548399&4294967295,h=d+(g<<7&4294967295|g>>>25),g=b+(_^h&(d^_))+y[5]+1200080426&4294967295,b=h+(g<<12&4294967295|g>>>20),g=_+(d^b&(h^d))+y[6]+2821735955&4294967295,_=b+(g<<17&4294967295|g>>>15),g=d+(h^_&(b^h))+y[7]+4249261313&4294967295,d=_+(g<<22&4294967295|g>>>10),g=h+(b^d&(_^b))+y[8]+1770035416&4294967295,h=d+(g<<7&4294967295|g>>>25),g=b+(_^h&(d^_))+y[9]+2336552879&4294967295,b=h+(g<<12&4294967295|g>>>20),g=_+(d^b&(h^d))+y[10]+4294925233&4294967295,_=b+(g<<17&4294967295|g>>>15),g=d+(h^_&(b^h))+y[11]+2304563134&4294967295,d=_+(g<<22&4294967295|g>>>10),g=h+(b^d&(_^b))+y[12]+1804603682&4294967295,h=d+(g<<7&4294967295|g>>>25),g=b+(_^h&(d^_))+y[13]+4254626195&4294967295,b=h+(g<<12&4294967295|g>>>20),g=_+(d^b&(h^d))+y[14]+2792965006&4294967295,_=b+(g<<17&4294967295|g>>>15),g=d+(h^_&(b^h))+y[15]+1236535329&4294967295,d=_+(g<<22&4294967295|g>>>10),g=h+(_^b&(d^_))+y[1]+4129170786&4294967295,h=d+(g<<5&4294967295|g>>>27),g=b+(d^_&(h^d))+y[6]+3225465664&4294967295,b=h+(g<<9&4294967295|g>>>23),g=_+(h^d&(b^h))+y[11]+643717713&4294967295,_=b+(g<<14&4294967295|g>>>18),g=d+(b^h&(_^b))+y[0]+3921069994&4294967295,d=_+(g<<20&4294967295|g>>>12),g=h+(_^b&(d^_))+y[5]+3593408605&4294967295,h=d+(g<<5&4294967295|g>>>27),g=b+(d^_&(h^d))+y[10]+38016083&4294967295,b=h+(g<<9&4294967295|g>>>23),g=_+(h^d&(b^h))+y[15]+3634488961&4294967295,_=b+(g<<14&4294967295|g>>>18),g=d+(b^h&(_^b))+y[4]+3889429448&4294967295,d=_+(g<<20&4294967295|g>>>12),g=h+(_^b&(d^_))+y[9]+568446438&4294967295,h=d+(g<<5&4294967295|g>>>27),g=b+(d^_&(h^d))+y[14]+3275163606&4294967295,b=h+(g<<9&4294967295|g>>>23),g=_+(h^d&(b^h))+y[3]+4107603335&4294967295,_=b+(g<<14&4294967295|g>>>18),g=d+(b^h&(_^b))+y[8]+1163531501&4294967295,d=_+(g<<20&4294967295|g>>>12),g=h+(_^b&(d^_))+y[13]+2850285829&4294967295,h=d+(g<<5&4294967295|g>>>27),g=b+(d^_&(h^d))+y[2]+4243563512&4294967295,b=h+(g<<9&4294967295|g>>>23),g=_+(h^d&(b^h))+y[7]+1735328473&4294967295,_=b+(g<<14&4294967295|g>>>18),g=d+(b^h&(_^b))+y[12]+2368359562&4294967295,d=_+(g<<20&4294967295|g>>>12),g=h+(d^_^b)+y[5]+4294588738&4294967295,h=d+(g<<4&4294967295|g>>>28),g=b+(h^d^_)+y[8]+2272392833&4294967295,b=h+(g<<11&4294967295|g>>>21),g=_+(b^h^d)+y[11]+1839030562&4294967295,_=b+(g<<16&4294967295|g>>>16),g=d+(_^b^h)+y[14]+4259657740&4294967295,d=_+(g<<23&4294967295|g>>>9),g=h+(d^_^b)+y[1]+2763975236&4294967295,h=d+(g<<4&4294967295|g>>>28),g=b+(h^d^_)+y[4]+1272893353&4294967295,b=h+(g<<11&4294967295|g>>>21),g=_+(b^h^d)+y[7]+4139469664&4294967295,_=b+(g<<16&4294967295|g>>>16),g=d+(_^b^h)+y[10]+3200236656&4294967295,d=_+(g<<23&4294967295|g>>>9),g=h+(d^_^b)+y[13]+681279174&4294967295,h=d+(g<<4&4294967295|g>>>28),g=b+(h^d^_)+y[0]+3936430074&4294967295,b=h+(g<<11&4294967295|g>>>21),g=_+(b^h^d)+y[3]+3572445317&4294967295,_=b+(g<<16&4294967295|g>>>16),g=d+(_^b^h)+y[6]+76029189&4294967295,d=_+(g<<23&4294967295|g>>>9),g=h+(d^_^b)+y[9]+3654602809&4294967295,h=d+(g<<4&4294967295|g>>>28),g=b+(h^d^_)+y[12]+3873151461&4294967295,b=h+(g<<11&4294967295|g>>>21),g=_+(b^h^d)+y[15]+530742520&4294967295,_=b+(g<<16&4294967295|g>>>16),g=d+(_^b^h)+y[2]+3299628645&4294967295,d=_+(g<<23&4294967295|g>>>9),g=h+(_^(d|~b))+y[0]+4096336452&4294967295,h=d+(g<<6&4294967295|g>>>26),g=b+(d^(h|~_))+y[7]+1126891415&4294967295,b=h+(g<<10&4294967295|g>>>22),g=_+(h^(b|~d))+y[14]+2878612391&4294967295,_=b+(g<<15&4294967295|g>>>17),g=d+(b^(_|~h))+y[5]+4237533241&4294967295,d=_+(g<<21&4294967295|g>>>11),g=h+(_^(d|~b))+y[12]+1700485571&4294967295,h=d+(g<<6&4294967295|g>>>26),g=b+(d^(h|~_))+y[3]+2399980690&4294967295,b=h+(g<<10&4294967295|g>>>22),g=_+(h^(b|~d))+y[10]+4293915773&4294967295,_=b+(g<<15&4294967295|g>>>17),g=d+(b^(_|~h))+y[1]+2240044497&4294967295,d=_+(g<<21&4294967295|g>>>11),g=h+(_^(d|~b))+y[8]+1873313359&4294967295,h=d+(g<<6&4294967295|g>>>26),g=b+(d^(h|~_))+y[15]+4264355552&4294967295,b=h+(g<<10&4294967295|g>>>22),g=_+(h^(b|~d))+y[6]+2734768916&4294967295,_=b+(g<<15&4294967295|g>>>17),g=d+(b^(_|~h))+y[13]+1309151649&4294967295,d=_+(g<<21&4294967295|g>>>11),g=h+(_^(d|~b))+y[4]+4149444226&4294967295,h=d+(g<<6&4294967295|g>>>26),g=b+(d^(h|~_))+y[11]+3174756917&4294967295,b=h+(g<<10&4294967295|g>>>22),g=_+(h^(b|~d))+y[2]+718787259&4294967295,_=b+(g<<15&4294967295|g>>>17),g=d+(b^(_|~h))+y[9]+3951481745&4294967295,E.g[0]=E.g[0]+h&4294967295,E.g[1]=E.g[1]+(_+(g<<21&4294967295|g>>>11))&4294967295,E.g[2]=E.g[2]+_&4294967295,E.g[3]=E.g[3]+b&4294967295}r.prototype.v=function(E,h){h===void 0&&(h=E.length);const d=h-this.blockSize,y=this.C;let _=this.h,b=0;for(;b<h;){if(_==0)for(;b<=d;)i(this,E,b),b+=this.blockSize;if(typeof E=="string"){for(;b<h;)if(y[_++]=E.charCodeAt(b++),_==this.blockSize){i(this,y),_=0;break}}else for(;b<h;)if(y[_++]=E[b++],_==this.blockSize){i(this,y),_=0;break}}this.h=_,this.o+=h},r.prototype.A=function(){var E=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);E[0]=128;for(var h=1;h<E.length-8;++h)E[h]=0;h=this.o*8;for(var d=E.length-8;d<E.length;++d)E[d]=h&255,h/=256;for(this.v(E),E=Array(16),h=0,d=0;d<4;++d)for(let y=0;y<32;y+=8)E[h++]=this.g[d]>>>y&255;return E};function o(E,h){var d=u;return Object.prototype.hasOwnProperty.call(d,E)?d[E]:d[E]=h(E)}function l(E,h){this.h=h;const d=[];let y=!0;for(let _=E.length-1;_>=0;_--){const b=E[_]|0;y&&b==h||(d[_]=b,y=!1)}this.g=d}var u={};function p(E){return-128<=E&&E<128?o(E,function(h){return new l([h|0],h<0?-1:0)}):new l([E|0],E<0?-1:0)}function m(E){if(isNaN(E)||!isFinite(E))return T;if(E<0)return S(m(-E));const h=[];let d=1;for(let y=0;E>=d;y++)h[y]=E/d|0,d*=4294967296;return new l(h,0)}function w(E,h){if(E.length==0)throw Error("number format error: empty string");if(h=h||10,h<2||36<h)throw Error("radix out of range: "+h);if(E.charAt(0)=="-")return S(w(E.substring(1),h));if(E.indexOf("-")>=0)throw Error('number format error: interior "-" character');const d=m(Math.pow(h,8));let y=T;for(let b=0;b<E.length;b+=8){var _=Math.min(8,E.length-b);const g=parseInt(E.substring(b,b+_),h);_<8?(_=m(Math.pow(h,_)),y=y.j(_).add(m(g))):(y=y.j(d),y=y.add(m(g)))}return y}var T=p(0),v=p(1),D=p(16777216);n=l.prototype,n.m=function(){if(V(this))return-S(this).m();let E=0,h=1;for(let d=0;d<this.g.length;d++){const y=this.i(d);E+=(y>=0?y:4294967296+y)*h,h*=4294967296}return E},n.toString=function(E){if(E=E||10,E<2||36<E)throw Error("radix out of range: "+E);if(A(this))return"0";if(V(this))return"-"+S(this).toString(E);const h=m(Math.pow(E,6));var d=this;let y="";for(;;){const _=O(d,h).g;d=P(d,_.j(h));let b=((d.g.length>0?d.g[0]:d.h)>>>0).toString(E);if(d=_,A(d))return b+y;for(;b.length<6;)b="0"+b;y=b+y}},n.i=function(E){return E<0?0:E<this.g.length?this.g[E]:this.h};function A(E){if(E.h!=0)return!1;for(let h=0;h<E.g.length;h++)if(E.g[h]!=0)return!1;return!0}function V(E){return E.h==-1}n.l=function(E){return E=P(this,E),V(E)?-1:A(E)?0:1};function S(E){const h=E.g.length,d=[];for(let y=0;y<h;y++)d[y]=~E.g[y];return new l(d,~E.h).add(v)}n.abs=function(){return V(this)?S(this):this},n.add=function(E){const h=Math.max(this.g.length,E.g.length),d=[];let y=0;for(let _=0;_<=h;_++){let b=y+(this.i(_)&65535)+(E.i(_)&65535),g=(b>>>16)+(this.i(_)>>>16)+(E.i(_)>>>16);y=g>>>16,b&=65535,g&=65535,d[_]=g<<16|b}return new l(d,d[d.length-1]&-2147483648?-1:0)};function P(E,h){return E.add(S(h))}n.j=function(E){if(A(this)||A(E))return T;if(V(this))return V(E)?S(this).j(S(E)):S(S(this).j(E));if(V(E))return S(this.j(S(E)));if(this.l(D)<0&&E.l(D)<0)return m(this.m()*E.m());const h=this.g.length+E.g.length,d=[];for(var y=0;y<2*h;y++)d[y]=0;for(y=0;y<this.g.length;y++)for(let _=0;_<E.g.length;_++){const b=this.i(y)>>>16,g=this.i(y)&65535,nt=E.i(_)>>>16,St=E.i(_)&65535;d[2*y+2*_]+=g*St,R(d,2*y+2*_),d[2*y+2*_+1]+=b*St,R(d,2*y+2*_+1),d[2*y+2*_+1]+=g*nt,R(d,2*y+2*_+1),d[2*y+2*_+2]+=b*nt,R(d,2*y+2*_+2)}for(E=0;E<h;E++)d[E]=d[2*E+1]<<16|d[2*E];for(E=h;E<2*h;E++)d[E]=0;return new l(d,0)};function R(E,h){for(;(E[h]&65535)!=E[h];)E[h+1]+=E[h]>>>16,E[h]&=65535,h++}function F(E,h){this.g=E,this.h=h}function O(E,h){if(A(h))throw Error("division by zero");if(A(E))return new F(T,T);if(V(E))return h=O(S(E),h),new F(S(h.g),S(h.h));if(V(h))return h=O(E,S(h)),new F(S(h.g),h.h);if(E.g.length>30){if(V(E)||V(h))throw Error("slowDivide_ only works with positive integers.");for(var d=v,y=h;y.l(E)<=0;)d=$(d),y=$(y);var _=L(d,1),b=L(y,1);for(y=L(y,2),d=L(d,2);!A(y);){var g=b.add(y);g.l(E)<=0&&(_=_.add(d),b=g),y=L(y,1),d=L(d,1)}return h=P(E,_.j(h)),new F(_,h)}for(_=T;E.l(h)>=0;){for(d=Math.max(1,Math.floor(E.m()/h.m())),y=Math.ceil(Math.log(d)/Math.LN2),y=y<=48?1:Math.pow(2,y-48),b=m(d),g=b.j(h);V(g)||g.l(E)>0;)d-=y,b=m(d),g=b.j(h);A(b)&&(b=v),_=_.add(b),E=P(E,g)}return new F(_,E)}n.B=function(E){return O(this,E).h},n.and=function(E){const h=Math.max(this.g.length,E.g.length),d=[];for(let y=0;y<h;y++)d[y]=this.i(y)&E.i(y);return new l(d,this.h&E.h)},n.or=function(E){const h=Math.max(this.g.length,E.g.length),d=[];for(let y=0;y<h;y++)d[y]=this.i(y)|E.i(y);return new l(d,this.h|E.h)},n.xor=function(E){const h=Math.max(this.g.length,E.g.length),d=[];for(let y=0;y<h;y++)d[y]=this.i(y)^E.i(y);return new l(d,this.h^E.h)};function $(E){const h=E.g.length+1,d=[];for(let y=0;y<h;y++)d[y]=E.i(y)<<1|E.i(y-1)>>>31;return new l(d,E.h)}function L(E,h){const d=h>>5;h%=32;const y=E.g.length-d,_=[];for(let b=0;b<y;b++)_[b]=h>0?E.i(b+d)>>>h|E.i(b+d+1)<<32-h:E.i(b+d);return new l(_,E.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,l.prototype.add=l.prototype.add,l.prototype.multiply=l.prototype.j,l.prototype.modulo=l.prototype.B,l.prototype.compare=l.prototype.l,l.prototype.toNumber=l.prototype.m,l.prototype.toString=l.prototype.toString,l.prototype.getBits=l.prototype.i,l.fromNumber=m,l.fromString=w,ks=l}).apply(typeof yo<"u"?yo:typeof self<"u"?self:typeof window<"u"?window:{});var $n=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Ea,on,wa,Kn,us,ba,Ta,Ia;(function(){var n,t=Object.defineProperty;function e(s){s=[typeof globalThis=="object"&&globalThis,s,typeof window=="object"&&window,typeof self=="object"&&self,typeof $n=="object"&&$n];for(var a=0;a<s.length;++a){var c=s[a];if(c&&c.Math==Math)return c}throw Error("Cannot find global object")}var r=e(this);function i(s,a){if(a)t:{var c=r;s=s.split(".");for(var f=0;f<s.length-1;f++){var I=s[f];if(!(I in c))break t;c=c[I]}s=s[s.length-1],f=c[s],a=a(f),a!=f&&a!=null&&t(c,s,{configurable:!0,writable:!0,value:a})}}i("Symbol.dispose",function(s){return s||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(s){return s||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(s){return s||function(a){var c=[],f;for(f in a)Object.prototype.hasOwnProperty.call(a,f)&&c.push([f,a[f]]);return c}});var o=o||{},l=this||self;function u(s){var a=typeof s;return a=="object"&&s!=null||a=="function"}function p(s,a,c){return s.call.apply(s.bind,arguments)}function m(s,a,c){return m=p,m.apply(null,arguments)}function w(s,a){var c=Array.prototype.slice.call(arguments,1);return function(){var f=c.slice();return f.push.apply(f,arguments),s.apply(this,f)}}function T(s,a){function c(){}c.prototype=a.prototype,s.Z=a.prototype,s.prototype=new c,s.prototype.constructor=s,s.Ob=function(f,I,x){for(var N=Array(arguments.length-2),j=2;j<arguments.length;j++)N[j-2]=arguments[j];return a.prototype[I].apply(f,N)}}var v=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?s=>s&&AsyncContext.Snapshot.wrap(s):s=>s;function D(s){const a=s.length;if(a>0){const c=Array(a);for(let f=0;f<a;f++)c[f]=s[f];return c}return[]}function A(s,a){for(let f=1;f<arguments.length;f++){const I=arguments[f];var c=typeof I;if(c=c!="object"?c:I?Array.isArray(I)?"array":c:"null",c=="array"||c=="object"&&typeof I.length=="number"){c=s.length||0;const x=I.length||0;s.length=c+x;for(let N=0;N<x;N++)s[c+N]=I[N]}else s.push(I)}}class V{constructor(a,c){this.i=a,this.j=c,this.h=0,this.g=null}get(){let a;return this.h>0?(this.h--,a=this.g,this.g=a.next,a.next=null):a=this.i(),a}}function S(s){l.setTimeout(()=>{throw s},0)}function P(){var s=E;let a=null;return s.g&&(a=s.g,s.g=s.g.next,s.g||(s.h=null),a.next=null),a}class R{constructor(){this.h=this.g=null}add(a,c){const f=F.get();f.set(a,c),this.h?this.h.next=f:this.g=f,this.h=f}}var F=new V(()=>new O,s=>s.reset());class O{constructor(){this.next=this.g=this.h=null}set(a,c){this.h=a,this.g=c,this.next=null}reset(){this.next=this.g=this.h=null}}let $,L=!1,E=new R,h=()=>{const s=Promise.resolve(void 0);$=()=>{s.then(d)}};function d(){for(var s;s=P();){try{s.h.call(s.g)}catch(c){S(c)}var a=F;a.j(s),a.h<100&&(a.h++,s.next=a.g,a.g=s)}L=!1}function y(){this.u=this.u,this.C=this.C}y.prototype.u=!1,y.prototype.dispose=function(){this.u||(this.u=!0,this.N())},y.prototype[Symbol.dispose]=function(){this.dispose()},y.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function _(s,a){this.type=s,this.g=this.target=a,this.defaultPrevented=!1}_.prototype.h=function(){this.defaultPrevented=!0};var b=(function(){if(!l.addEventListener||!Object.defineProperty)return!1;var s=!1,a=Object.defineProperty({},"passive",{get:function(){s=!0}});try{const c=()=>{};l.addEventListener("test",c,a),l.removeEventListener("test",c,a)}catch{}return s})();function g(s){return/^[\s\xa0]*$/.test(s)}function nt(s,a){_.call(this,s?s.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,s&&this.init(s,a)}T(nt,_),nt.prototype.init=function(s,a){const c=this.type=s.type,f=s.changedTouches&&s.changedTouches.length?s.changedTouches[0]:null;this.target=s.target||s.srcElement,this.g=a,a=s.relatedTarget,a||(c=="mouseover"?a=s.fromElement:c=="mouseout"&&(a=s.toElement)),this.relatedTarget=a,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=s.clientX!==void 0?s.clientX:s.pageX,this.clientY=s.clientY!==void 0?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0),this.button=s.button,this.key=s.key||"",this.ctrlKey=s.ctrlKey,this.altKey=s.altKey,this.shiftKey=s.shiftKey,this.metaKey=s.metaKey,this.pointerId=s.pointerId||0,this.pointerType=s.pointerType,this.state=s.state,this.i=s,s.defaultPrevented&&nt.Z.h.call(this)},nt.prototype.h=function(){nt.Z.h.call(this);const s=this.i;s.preventDefault?s.preventDefault():s.returnValue=!1};var St="closure_listenable_"+(Math.random()*1e6|0),Bt=0;function Sn(s,a,c,f,I){this.listener=s,this.proxy=null,this.src=a,this.type=c,this.capture=!!f,this.ha=I,this.key=++Bt,this.da=this.fa=!1}function ye(s){s.da=!0,s.listener=null,s.proxy=null,s.src=null,s.ha=null}function _e(s,a,c){for(const f in s)a.call(c,s[f],f,s)}function Be(s,a){for(const c in s)a.call(void 0,s[c],c,s)}function It(s){const a={};for(const c in s)a[c]=s[c];return a}const si="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ii(s,a){let c,f;for(let I=1;I<arguments.length;I++){f=arguments[I];for(c in f)s[c]=f[c];for(let x=0;x<si.length;x++)c=si[x],Object.prototype.hasOwnProperty.call(f,c)&&(s[c]=f[c])}}function Cn(s){this.src=s,this.g={},this.h=0}Cn.prototype.add=function(s,a,c,f,I){const x=s.toString();s=this.g[x],s||(s=this.g[x]=[],this.h++);const N=Ar(s,a,f,I);return N>-1?(a=s[N],c||(a.fa=!1)):(a=new Sn(a,this.src,x,!!f,I),a.fa=c,s.push(a)),a};function xr(s,a){const c=a.type;if(c in s.g){var f=s.g[c],I=Array.prototype.indexOf.call(f,a,void 0),x;(x=I>=0)&&Array.prototype.splice.call(f,I,1),x&&(ye(a),s.g[c].length==0&&(delete s.g[c],s.h--))}}function Ar(s,a,c,f){for(let I=0;I<s.length;++I){const x=s[I];if(!x.da&&x.listener==a&&x.capture==!!c&&x.ha==f)return I}return-1}var Sr="closure_lm_"+(Math.random()*1e6|0),Cr={};function oi(s,a,c,f,I){if(Array.isArray(a)){for(let x=0;x<a.length;x++)oi(s,a[x],c,f,I);return null}return c=ci(c),s&&s[St]?s.J(a,c,u(f)?!!f.capture:!1,I):Al(s,a,c,!1,f,I)}function Al(s,a,c,f,I,x){if(!a)throw Error("Invalid event type");const N=u(I)?!!I.capture:!!I;let j=Rr(s);if(j||(s[Sr]=j=new Cn(s)),c=j.add(a,c,f,N,x),c.proxy)return c;if(f=Sl(),c.proxy=f,f.src=s,f.listener=c,s.addEventListener)b||(I=N),I===void 0&&(I=!1),s.addEventListener(a.toString(),f,I);else if(s.attachEvent)s.attachEvent(li(a.toString()),f);else if(s.addListener&&s.removeListener)s.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return c}function Sl(){function s(c){return a.call(s.src,s.listener,c)}const a=Cl;return s}function ai(s,a,c,f,I){if(Array.isArray(a))for(var x=0;x<a.length;x++)ai(s,a[x],c,f,I);else f=u(f)?!!f.capture:!!f,c=ci(c),s&&s[St]?(s=s.i,x=String(a).toString(),x in s.g&&(a=s.g[x],c=Ar(a,c,f,I),c>-1&&(ye(a[c]),Array.prototype.splice.call(a,c,1),a.length==0&&(delete s.g[x],s.h--)))):s&&(s=Rr(s))&&(a=s.g[a.toString()],s=-1,a&&(s=Ar(a,c,f,I)),(c=s>-1?a[s]:null)&&Pr(c))}function Pr(s){if(typeof s!="number"&&s&&!s.da){var a=s.src;if(a&&a[St])xr(a.i,s);else{var c=s.type,f=s.proxy;a.removeEventListener?a.removeEventListener(c,f,s.capture):a.detachEvent?a.detachEvent(li(c),f):a.addListener&&a.removeListener&&a.removeListener(f),(c=Rr(a))?(xr(c,s),c.h==0&&(c.src=null,a[Sr]=null)):ye(s)}}}function li(s){return s in Cr?Cr[s]:Cr[s]="on"+s}function Cl(s,a){if(s.da)s=!0;else{a=new nt(a,this);const c=s.listener,f=s.ha||s.src;s.fa&&Pr(s),s=c.call(f,a)}return s}function Rr(s){return s=s[Sr],s instanceof Cn?s:null}var kr="__closure_events_fn_"+(Math.random()*1e9>>>0);function ci(s){return typeof s=="function"?s:(s[kr]||(s[kr]=function(a){return s.handleEvent(a)}),s[kr])}function pt(){y.call(this),this.i=new Cn(this),this.M=this,this.G=null}T(pt,y),pt.prototype[St]=!0,pt.prototype.removeEventListener=function(s,a,c,f){ai(this,s,a,c,f)};function Et(s,a){var c,f=s.G;if(f)for(c=[];f;f=f.G)c.push(f);if(s=s.M,f=a.type||a,typeof a=="string")a=new _(a,s);else if(a instanceof _)a.target=a.target||s;else{var I=a;a=new _(f,s),ii(a,I)}I=!0;let x,N;if(c)for(N=c.length-1;N>=0;N--)x=a.g=c[N],I=Pn(x,f,!0,a)&&I;if(x=a.g=s,I=Pn(x,f,!0,a)&&I,I=Pn(x,f,!1,a)&&I,c)for(N=0;N<c.length;N++)x=a.g=c[N],I=Pn(x,f,!1,a)&&I}pt.prototype.N=function(){if(pt.Z.N.call(this),this.i){var s=this.i;for(const a in s.g){const c=s.g[a];for(let f=0;f<c.length;f++)ye(c[f]);delete s.g[a],s.h--}}this.G=null},pt.prototype.J=function(s,a,c,f){return this.i.add(String(s),a,!1,c,f)},pt.prototype.K=function(s,a,c,f){return this.i.add(String(s),a,!0,c,f)};function Pn(s,a,c,f){if(a=s.i.g[String(a)],!a)return!0;a=a.concat();let I=!0;for(let x=0;x<a.length;++x){const N=a[x];if(N&&!N.da&&N.capture==c){const j=N.listener,it=N.ha||N.src;N.fa&&xr(s.i,N),I=j.call(it,f)!==!1&&I}}return I&&!f.defaultPrevented}function Pl(s,a){if(typeof s!="function")if(s&&typeof s.handleEvent=="function")s=m(s.handleEvent,s);else throw Error("Invalid listener argument");return Number(a)>2147483647?-1:l.setTimeout(s,a||0)}function ui(s){s.g=Pl(()=>{s.g=null,s.i&&(s.i=!1,ui(s))},s.l);const a=s.h;s.h=null,s.m.apply(null,a)}class Rl extends y{constructor(a,c){super(),this.m=a,this.l=c,this.h=null,this.i=!1,this.g=null}j(a){this.h=arguments,this.g?this.i=!0:ui(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ue(s){y.call(this),this.h=s,this.g={}}T(Ue,y);var hi=[];function di(s){_e(s.g,function(a,c){this.g.hasOwnProperty(c)&&Pr(a)},s),s.g={}}Ue.prototype.N=function(){Ue.Z.N.call(this),di(this)},Ue.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Dr=l.JSON.stringify,kl=l.JSON.parse,Dl=class{stringify(s){return l.JSON.stringify(s,void 0)}parse(s){return l.JSON.parse(s,void 0)}};function fi(){}function pi(){}var $e={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Vr(){_.call(this,"d")}T(Vr,_);function Mr(){_.call(this,"c")}T(Mr,_);var ee={},mi=null;function Rn(){return mi=mi||new pt}ee.Ia="serverreachability";function gi(s){_.call(this,ee.Ia,s)}T(gi,_);function je(s){const a=Rn();Et(a,new gi(a))}ee.STAT_EVENT="statevent";function yi(s,a){_.call(this,ee.STAT_EVENT,s),this.stat=a}T(yi,_);function wt(s){const a=Rn();Et(a,new yi(a,s))}ee.Ja="timingevent";function _i(s,a){_.call(this,ee.Ja,s),this.size=a}T(_i,_);function He(s,a){if(typeof s!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){s()},a)}function qe(){this.g=!0}qe.prototype.ua=function(){this.g=!1};function Vl(s,a,c,f,I,x){s.info(function(){if(s.g)if(x){var N="",j=x.split("&");for(let K=0;K<j.length;K++){var it=j[K].split("=");if(it.length>1){const ot=it[0];it=it[1];const Mt=ot.split("_");N=Mt.length>=2&&Mt[1]=="type"?N+(ot+"="+it+"&"):N+(ot+"=redacted&")}}}else N=null;else N=x;return"XMLHTTP REQ ("+f+") [attempt "+I+"]: "+a+`
`+c+`
`+N})}function Ml(s,a,c,f,I,x,N){s.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+I+"]: "+a+`
`+c+`
`+x+" "+N})}function ve(s,a,c,f){s.info(function(){return"XMLHTTP TEXT ("+a+"): "+Nl(s,c)+(f?" "+f:"")})}function Ll(s,a){s.info(function(){return"TIMEOUT: "+a})}qe.prototype.info=function(){};function Nl(s,a){if(!s.g)return a;if(!a)return null;try{const x=JSON.parse(a);if(x){for(s=0;s<x.length;s++)if(Array.isArray(x[s])){var c=x[s];if(!(c.length<2)){var f=c[1];if(Array.isArray(f)&&!(f.length<1)){var I=f[0];if(I!="noop"&&I!="stop"&&I!="close")for(let N=1;N<f.length;N++)f[N]=""}}}}return Dr(x)}catch{return a}}var kn={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},vi={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Ei;function Lr(){}T(Lr,fi),Lr.prototype.g=function(){return new XMLHttpRequest},Ei=new Lr;function ze(s){return encodeURIComponent(String(s))}function Ol(s){var a=1;s=s.split(":");const c=[];for(;a>0&&s.length;)c.push(s.shift()),a--;return s.length&&c.push(s.join(":")),c}function Ht(s,a,c,f){this.j=s,this.i=a,this.l=c,this.S=f||1,this.V=new Ue(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new wi}function wi(){this.i=null,this.g="",this.h=!1}var bi={},Nr={};function Or(s,a,c){s.M=1,s.A=Vn(Vt(a)),s.u=c,s.R=!0,Ti(s,null)}function Ti(s,a){s.F=Date.now(),Dn(s),s.B=Vt(s.A);var c=s.B,f=s.S;Array.isArray(f)||(f=[String(f)]),Ni(c.i,"t",f),s.C=0,c=s.j.L,s.h=new wi,s.g=to(s.j,c?a:null,!s.u),s.P>0&&(s.O=new Rl(m(s.Y,s,s.g),s.P)),a=s.V,c=s.g,f=s.ba;var I="readystatechange";Array.isArray(I)||(I&&(hi[0]=I.toString()),I=hi);for(let x=0;x<I.length;x++){const N=oi(c,I[x],f||a.handleEvent,!1,a.h||a);if(!N)break;a.g[N.key]=N}a=s.J?It(s.J):{},s.u?(s.v||(s.v="POST"),a["Content-Type"]="application/x-www-form-urlencoded",s.g.ea(s.B,s.v,s.u,a)):(s.v="GET",s.g.ea(s.B,s.v,null,a)),je(),Vl(s.i,s.v,s.B,s.l,s.S,s.u)}Ht.prototype.ba=function(s){s=s.target;const a=this.O;a&&Gt(s)==3?a.j():this.Y(s)},Ht.prototype.Y=function(s){try{if(s==this.g)t:{const j=Gt(this.g),it=this.g.ya(),K=this.g.ca();if(!(j<3)&&(j!=3||this.g&&(this.h.h||this.g.la()||Hi(this.g)))){this.K||j!=4||it==7||(it==8||K<=0?je(3):je(2)),Fr(this);var a=this.g.ca();this.X=a;var c=Fl(this);if(this.o=a==200,Ml(this.i,this.v,this.B,this.l,this.S,j,a),this.o){if(this.U&&!this.L){e:{if(this.g){var f,I=this.g;if((f=I.g?I.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!g(f)){var x=f;break e}}x=null}if(s=x)ve(this.i,this.l,s,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Br(this,s);else{this.o=!1,this.m=3,wt(12),ne(this),Ge(this);break t}}if(this.R){s=!0;let ot;for(;!this.K&&this.C<c.length;)if(ot=Bl(this,c),ot==Nr){j==4&&(this.m=4,wt(14),s=!1),ve(this.i,this.l,null,"[Incomplete Response]");break}else if(ot==bi){this.m=4,wt(15),ve(this.i,this.l,c,"[Invalid Chunk]"),s=!1;break}else ve(this.i,this.l,ot,null),Br(this,ot);if(Ii(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),j!=4||c.length!=0||this.h.h||(this.m=1,wt(16),s=!1),this.o=this.o&&s,!s)ve(this.i,this.l,c,"[Invalid Chunked Response]"),ne(this),Ge(this);else if(c.length>0&&!this.W){this.W=!0;var N=this.j;N.g==this&&N.aa&&!N.P&&(N.j.info("Great, no buffering proxy detected. Bytes received: "+c.length),Wr(N),N.P=!0,wt(11))}}else ve(this.i,this.l,c,null),Br(this,c);j==4&&ne(this),this.o&&!this.K&&(j==4?Yi(this.j,this):(this.o=!1,Dn(this)))}else Zl(this.g),a==400&&c.indexOf("Unknown SID")>0?(this.m=3,wt(12)):(this.m=0,wt(13)),ne(this),Ge(this)}}}catch{}};function Fl(s){if(!Ii(s))return s.g.la();const a=Hi(s.g);if(a==="")return"";let c="";const f=a.length,I=Gt(s.g)==4;if(!s.h.i){if(typeof TextDecoder>"u")return ne(s),Ge(s),"";s.h.i=new l.TextDecoder}for(let x=0;x<f;x++)s.h.h=!0,c+=s.h.i.decode(a[x],{stream:!(I&&x==f-1)});return a.length=0,s.h.g+=c,s.C=0,s.h.g}function Ii(s){return s.g?s.v=="GET"&&s.M!=2&&s.j.Aa:!1}function Bl(s,a){var c=s.C,f=a.indexOf(`
`,c);return f==-1?Nr:(c=Number(a.substring(c,f)),isNaN(c)?bi:(f+=1,f+c>a.length?Nr:(a=a.slice(f,f+c),s.C=f+c,a)))}Ht.prototype.cancel=function(){this.K=!0,ne(this)};function Dn(s){s.T=Date.now()+s.H,xi(s,s.H)}function xi(s,a){if(s.D!=null)throw Error("WatchDog timer not null");s.D=He(m(s.aa,s),a)}function Fr(s){s.D&&(l.clearTimeout(s.D),s.D=null)}Ht.prototype.aa=function(){this.D=null;const s=Date.now();s-this.T>=0?(Ll(this.i,this.B),this.M!=2&&(je(),wt(17)),ne(this),this.m=2,Ge(this)):xi(this,this.T-s)};function Ge(s){s.j.I==0||s.K||Yi(s.j,s)}function ne(s){Fr(s);var a=s.O;a&&typeof a.dispose=="function"&&a.dispose(),s.O=null,di(s.V),s.g&&(a=s.g,s.g=null,a.abort(),a.dispose())}function Br(s,a){try{var c=s.j;if(c.I!=0&&(c.g==s||Ur(c.h,s))){if(!s.L&&Ur(c.h,s)&&c.I==3){try{var f=c.Ba.g.parse(a)}catch{f=null}if(Array.isArray(f)&&f.length==3){var I=f;if(I[0]==0){t:if(!c.v){if(c.g)if(c.g.F+3e3<s.F)Fn(c),Nn(c);else break t;Gr(c),wt(18)}}else c.xa=I[1],0<c.xa-c.K&&I[2]<37500&&c.F&&c.A==0&&!c.C&&(c.C=He(m(c.Va,c),6e3));Ci(c.h)<=1&&c.ta&&(c.ta=void 0)}else se(c,11)}else if((s.L||c.g==s)&&Fn(c),!g(a))for(I=c.Ba.g.parse(a),a=0;a<I.length;a++){let K=I[a];const ot=K[0];if(!(ot<=c.K))if(c.K=ot,K=K[1],c.I==2)if(K[0]=="c"){c.M=K[1],c.ba=K[2];const Mt=K[3];Mt!=null&&(c.ka=Mt,c.j.info("VER="+c.ka));const ie=K[4];ie!=null&&(c.za=ie,c.j.info("SVER="+c.za));const Wt=K[5];Wt!=null&&typeof Wt=="number"&&Wt>0&&(f=1.5*Wt,c.O=f,c.j.info("backChannelRequestTimeoutMs_="+f)),f=c;const Kt=s.g;if(Kt){const Un=Kt.g?Kt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Un){var x=f.h;x.g||Un.indexOf("spdy")==-1&&Un.indexOf("quic")==-1&&Un.indexOf("h2")==-1||(x.j=x.l,x.g=new Set,x.h&&($r(x,x.h),x.h=null))}if(f.G){const Kr=Kt.g?Kt.g.getResponseHeader("X-HTTP-Session-Id"):null;Kr&&(f.wa=Kr,Y(f.J,f.G,Kr))}}c.I=3,c.l&&c.l.ra(),c.aa&&(c.T=Date.now()-s.F,c.j.info("Handshake RTT: "+c.T+"ms")),f=c;var N=s;if(f.na=Zi(f,f.L?f.ba:null,f.W),N.L){Pi(f.h,N);var j=N,it=f.O;it&&(j.H=it),j.D&&(Fr(j),Dn(j)),f.g=N}else Ki(f);c.i.length>0&&On(c)}else K[0]!="stop"&&K[0]!="close"||se(c,7);else c.I==3&&(K[0]=="stop"||K[0]=="close"?K[0]=="stop"?se(c,7):zr(c):K[0]!="noop"&&c.l&&c.l.qa(K),c.A=0)}}je(4)}catch{}}var Ul=class{constructor(s,a){this.g=s,this.map=a}};function Ai(s){this.l=s||10,l.PerformanceNavigationTiming?(s=l.performance.getEntriesByType("navigation"),s=s.length>0&&(s[0].nextHopProtocol=="hq"||s[0].nextHopProtocol=="h2")):s=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=s?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Si(s){return s.h?!0:s.g?s.g.size>=s.j:!1}function Ci(s){return s.h?1:s.g?s.g.size:0}function Ur(s,a){return s.h?s.h==a:s.g?s.g.has(a):!1}function $r(s,a){s.g?s.g.add(a):s.h=a}function Pi(s,a){s.h&&s.h==a?s.h=null:s.g&&s.g.has(a)&&s.g.delete(a)}Ai.prototype.cancel=function(){if(this.i=Ri(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const s of this.g.values())s.cancel();this.g.clear()}};function Ri(s){if(s.h!=null)return s.i.concat(s.h.G);if(s.g!=null&&s.g.size!==0){let a=s.i;for(const c of s.g.values())a=a.concat(c.G);return a}return D(s.i)}var ki=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function $l(s,a){if(s){s=s.split("&");for(let c=0;c<s.length;c++){const f=s[c].indexOf("=");let I,x=null;f>=0?(I=s[c].substring(0,f),x=s[c].substring(f+1)):I=s[c],a(I,x?decodeURIComponent(x.replace(/\+/g," ")):"")}}}function qt(s){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let a;s instanceof qt?(this.l=s.l,We(this,s.j),this.o=s.o,this.g=s.g,Ke(this,s.u),this.h=s.h,jr(this,Oi(s.i)),this.m=s.m):s&&(a=String(s).match(ki))?(this.l=!1,We(this,a[1]||"",!0),this.o=Qe(a[2]||""),this.g=Qe(a[3]||"",!0),Ke(this,a[4]),this.h=Qe(a[5]||"",!0),jr(this,a[6]||"",!0),this.m=Qe(a[7]||"")):(this.l=!1,this.i=new Xe(null,this.l))}qt.prototype.toString=function(){const s=[];var a=this.j;a&&s.push(Ye(a,Di,!0),":");var c=this.g;return(c||a=="file")&&(s.push("//"),(a=this.o)&&s.push(Ye(a,Di,!0),"@"),s.push(ze(c).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c=this.u,c!=null&&s.push(":",String(c))),(c=this.h)&&(this.g&&c.charAt(0)!="/"&&s.push("/"),s.push(Ye(c,c.charAt(0)=="/"?ql:Hl,!0))),(c=this.i.toString())&&s.push("?",c),(c=this.m)&&s.push("#",Ye(c,Gl)),s.join("")},qt.prototype.resolve=function(s){const a=Vt(this);let c=!!s.j;c?We(a,s.j):c=!!s.o,c?a.o=s.o:c=!!s.g,c?a.g=s.g:c=s.u!=null;var f=s.h;if(c)Ke(a,s.u);else if(c=!!s.h){if(f.charAt(0)!="/")if(this.g&&!this.h)f="/"+f;else{var I=a.h.lastIndexOf("/");I!=-1&&(f=a.h.slice(0,I+1)+f)}if(I=f,I==".."||I==".")f="";else if(I.indexOf("./")!=-1||I.indexOf("/.")!=-1){f=I.lastIndexOf("/",0)==0,I=I.split("/");const x=[];for(let N=0;N<I.length;){const j=I[N++];j=="."?f&&N==I.length&&x.push(""):j==".."?((x.length>1||x.length==1&&x[0]!="")&&x.pop(),f&&N==I.length&&x.push("")):(x.push(j),f=!0)}f=x.join("/")}else f=I}return c?a.h=f:c=s.i.toString()!=="",c?jr(a,Oi(s.i)):c=!!s.m,c&&(a.m=s.m),a};function Vt(s){return new qt(s)}function We(s,a,c){s.j=c?Qe(a,!0):a,s.j&&(s.j=s.j.replace(/:$/,""))}function Ke(s,a){if(a){if(a=Number(a),isNaN(a)||a<0)throw Error("Bad port number "+a);s.u=a}else s.u=null}function jr(s,a,c){a instanceof Xe?(s.i=a,Wl(s.i,s.l)):(c||(a=Ye(a,zl)),s.i=new Xe(a,s.l))}function Y(s,a,c){s.i.set(a,c)}function Vn(s){return Y(s,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),s}function Qe(s,a){return s?a?decodeURI(s.replace(/%25/g,"%2525")):decodeURIComponent(s):""}function Ye(s,a,c){return typeof s=="string"?(s=encodeURI(s).replace(a,jl),c&&(s=s.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),s):null}function jl(s){return s=s.charCodeAt(0),"%"+(s>>4&15).toString(16)+(s&15).toString(16)}var Di=/[#\/\?@]/g,Hl=/[#\?:]/g,ql=/[#\?]/g,zl=/[#\?@]/g,Gl=/#/g;function Xe(s,a){this.h=this.g=null,this.i=s||null,this.j=!!a}function re(s){s.g||(s.g=new Map,s.h=0,s.i&&$l(s.i,function(a,c){s.add(decodeURIComponent(a.replace(/\+/g," ")),c)}))}n=Xe.prototype,n.add=function(s,a){re(this),this.i=null,s=Ee(this,s);let c=this.g.get(s);return c||this.g.set(s,c=[]),c.push(a),this.h+=1,this};function Vi(s,a){re(s),a=Ee(s,a),s.g.has(a)&&(s.i=null,s.h-=s.g.get(a).length,s.g.delete(a))}function Mi(s,a){return re(s),a=Ee(s,a),s.g.has(a)}n.forEach=function(s,a){re(this),this.g.forEach(function(c,f){c.forEach(function(I){s.call(a,I,f,this)},this)},this)};function Li(s,a){re(s);let c=[];if(typeof a=="string")Mi(s,a)&&(c=c.concat(s.g.get(Ee(s,a))));else for(s=Array.from(s.g.values()),a=0;a<s.length;a++)c=c.concat(s[a]);return c}n.set=function(s,a){return re(this),this.i=null,s=Ee(this,s),Mi(this,s)&&(this.h-=this.g.get(s).length),this.g.set(s,[a]),this.h+=1,this},n.get=function(s,a){return s?(s=Li(this,s),s.length>0?String(s[0]):a):a};function Ni(s,a,c){Vi(s,a),c.length>0&&(s.i=null,s.g.set(Ee(s,a),D(c)),s.h+=c.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const s=[],a=Array.from(this.g.keys());for(let f=0;f<a.length;f++){var c=a[f];const I=ze(c);c=Li(this,c);for(let x=0;x<c.length;x++){let N=I;c[x]!==""&&(N+="="+ze(c[x])),s.push(N)}}return this.i=s.join("&")};function Oi(s){const a=new Xe;return a.i=s.i,s.g&&(a.g=new Map(s.g),a.h=s.h),a}function Ee(s,a){return a=String(a),s.j&&(a=a.toLowerCase()),a}function Wl(s,a){a&&!s.j&&(re(s),s.i=null,s.g.forEach(function(c,f){const I=f.toLowerCase();f!=I&&(Vi(this,f),Ni(this,I,c))},s)),s.j=a}function Kl(s,a){const c=new qe;if(l.Image){const f=new Image;f.onload=w(zt,c,"TestLoadImage: loaded",!0,a,f),f.onerror=w(zt,c,"TestLoadImage: error",!1,a,f),f.onabort=w(zt,c,"TestLoadImage: abort",!1,a,f),f.ontimeout=w(zt,c,"TestLoadImage: timeout",!1,a,f),l.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=s}else a(!1)}function Ql(s,a){const c=new qe,f=new AbortController,I=setTimeout(()=>{f.abort(),zt(c,"TestPingServer: timeout",!1,a)},1e4);fetch(s,{signal:f.signal}).then(x=>{clearTimeout(I),x.ok?zt(c,"TestPingServer: ok",!0,a):zt(c,"TestPingServer: server error",!1,a)}).catch(()=>{clearTimeout(I),zt(c,"TestPingServer: error",!1,a)})}function zt(s,a,c,f,I){try{I&&(I.onload=null,I.onerror=null,I.onabort=null,I.ontimeout=null),f(c)}catch{}}function Yl(){this.g=new Dl}function Hr(s){this.i=s.Sb||null,this.h=s.ab||!1}T(Hr,fi),Hr.prototype.g=function(){return new Mn(this.i,this.h)};function Mn(s,a){pt.call(this),this.H=s,this.o=a,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}T(Mn,pt),n=Mn.prototype,n.open=function(s,a){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=s,this.D=a,this.readyState=1,Ze(this)},n.send=function(s){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const a={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};s&&(a.body=s),(this.H||l).fetch(new Request(this.D,a)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Je(this)),this.readyState=0},n.Pa=function(s){if(this.g&&(this.l=s,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=s.headers,this.readyState=2,Ze(this)),this.g&&(this.readyState=3,Ze(this),this.g)))if(this.responseType==="arraybuffer")s.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in s){if(this.j=s.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Fi(this)}else s.text().then(this.Oa.bind(this),this.ga.bind(this))};function Fi(s){s.j.read().then(s.Ma.bind(s)).catch(s.ga.bind(s))}n.Ma=function(s){if(this.g){if(this.o&&s.value)this.response.push(s.value);else if(!this.o){var a=s.value?s.value:new Uint8Array(0);(a=this.B.decode(a,{stream:!s.done}))&&(this.response=this.responseText+=a)}s.done?Je(this):Ze(this),this.readyState==3&&Fi(this)}},n.Oa=function(s){this.g&&(this.response=this.responseText=s,Je(this))},n.Na=function(s){this.g&&(this.response=s,Je(this))},n.ga=function(){this.g&&Je(this)};function Je(s){s.readyState=4,s.l=null,s.j=null,s.B=null,Ze(s)}n.setRequestHeader=function(s,a){this.A.append(s,a)},n.getResponseHeader=function(s){return this.h&&this.h.get(s.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const s=[],a=this.h.entries();for(var c=a.next();!c.done;)c=c.value,s.push(c[0]+": "+c[1]),c=a.next();return s.join(`\r
`)};function Ze(s){s.onreadystatechange&&s.onreadystatechange.call(s)}Object.defineProperty(Mn.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(s){this.m=s?"include":"same-origin"}});function Bi(s){let a="";return _e(s,function(c,f){a+=f,a+=":",a+=c,a+=`\r
`}),a}function qr(s,a,c){t:{for(f in c){var f=!1;break t}f=!0}f||(c=Bi(c),typeof s=="string"?c!=null&&ze(c):Y(s,a,c))}function Z(s){pt.call(this),this.headers=new Map,this.L=s||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}T(Z,pt);var Xl=/^https?$/i,Jl=["POST","PUT"];n=Z.prototype,n.Fa=function(s){this.H=s},n.ea=function(s,a,c,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+s);a=a?a.toUpperCase():"GET",this.D=s,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Ei.g(),this.g.onreadystatechange=v(m(this.Ca,this));try{this.B=!0,this.g.open(a,String(s),!0),this.B=!1}catch(x){Ui(this,x);return}if(s=c||"",c=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var I in f)c.set(I,f[I]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(const x of f.keys())c.set(x,f.get(x));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(c.keys()).find(x=>x.toLowerCase()=="content-type"),I=l.FormData&&s instanceof l.FormData,!(Array.prototype.indexOf.call(Jl,a,void 0)>=0)||f||I||c.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[x,N]of c)this.g.setRequestHeader(x,N);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(s),this.v=!1}catch(x){Ui(this,x)}};function Ui(s,a){s.h=!1,s.g&&(s.j=!0,s.g.abort(),s.j=!1),s.l=a,s.o=5,$i(s),Ln(s)}function $i(s){s.A||(s.A=!0,Et(s,"complete"),Et(s,"error"))}n.abort=function(s){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=s||7,Et(this,"complete"),Et(this,"abort"),Ln(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ln(this,!0)),Z.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?ji(this):this.Xa())},n.Xa=function(){ji(this)};function ji(s){if(s.h&&typeof o<"u"){if(s.v&&Gt(s)==4)setTimeout(s.Ca.bind(s),0);else if(Et(s,"readystatechange"),Gt(s)==4){s.h=!1;try{const x=s.ca();t:switch(x){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var a=!0;break t;default:a=!1}var c;if(!(c=a)){var f;if(f=x===0){let N=String(s.D).match(ki)[1]||null;!N&&l.self&&l.self.location&&(N=l.self.location.protocol.slice(0,-1)),f=!Xl.test(N?N.toLowerCase():"")}c=f}if(c)Et(s,"complete"),Et(s,"success");else{s.o=6;try{var I=Gt(s)>2?s.g.statusText:""}catch{I=""}s.l=I+" ["+s.ca()+"]",$i(s)}}finally{Ln(s)}}}}function Ln(s,a){if(s.g){s.m&&(clearTimeout(s.m),s.m=null);const c=s.g;s.g=null,a||Et(s,"ready");try{c.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Gt(s){return s.g?s.g.readyState:0}n.ca=function(){try{return Gt(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(s){if(this.g){var a=this.g.responseText;return s&&a.indexOf(s)==0&&(a=a.substring(s.length)),kl(a)}};function Hi(s){try{if(!s.g)return null;if("response"in s.g)return s.g.response;switch(s.F){case"":case"text":return s.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in s.g)return s.g.mozResponseArrayBuffer}return null}catch{return null}}function Zl(s){const a={};s=(s.g&&Gt(s)>=2&&s.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<s.length;f++){if(g(s[f]))continue;var c=Ol(s[f]);const I=c[0];if(c=c[1],typeof c!="string")continue;c=c.trim();const x=a[I]||[];a[I]=x,x.push(c)}Be(a,function(f){return f.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function tn(s,a,c){return c&&c.internalChannelParams&&c.internalChannelParams[s]||a}function qi(s){this.za=0,this.i=[],this.j=new qe,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=tn("failFast",!1,s),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=tn("baseRetryDelayMs",5e3,s),this.Za=tn("retryDelaySeedMs",1e4,s),this.Ta=tn("forwardChannelMaxRetries",2,s),this.va=tn("forwardChannelRequestTimeoutMs",2e4,s),this.ma=s&&s.xmlHttpFactory||void 0,this.Ua=s&&s.Rb||void 0,this.Aa=s&&s.useFetchStreams||!1,this.O=void 0,this.L=s&&s.supportsCrossDomainXhr||!1,this.M="",this.h=new Ai(s&&s.concurrentRequestLimit),this.Ba=new Yl,this.S=s&&s.fastHandshake||!1,this.R=s&&s.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=s&&s.Pb||!1,s&&s.ua&&this.j.ua(),s&&s.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&s&&s.detectBufferingProxy||!1,this.ia=void 0,s&&s.longPollingTimeout&&s.longPollingTimeout>0&&(this.ia=s.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=qi.prototype,n.ka=8,n.I=1,n.connect=function(s,a,c,f){wt(0),this.W=s,this.H=a||{},c&&f!==void 0&&(this.H.OSID=c,this.H.OAID=f),this.F=this.X,this.J=Zi(this,null,this.W),On(this)};function zr(s){if(zi(s),s.I==3){var a=s.V++,c=Vt(s.J);if(Y(c,"SID",s.M),Y(c,"RID",a),Y(c,"TYPE","terminate"),en(s,c),a=new Ht(s,s.j,a),a.M=2,a.A=Vn(Vt(c)),c=!1,l.navigator&&l.navigator.sendBeacon)try{c=l.navigator.sendBeacon(a.A.toString(),"")}catch{}!c&&l.Image&&(new Image().src=a.A,c=!0),c||(a.g=to(a.j,null),a.g.ea(a.A)),a.F=Date.now(),Dn(a)}Ji(s)}function Nn(s){s.g&&(Wr(s),s.g.cancel(),s.g=null)}function zi(s){Nn(s),s.v&&(l.clearTimeout(s.v),s.v=null),Fn(s),s.h.cancel(),s.m&&(typeof s.m=="number"&&l.clearTimeout(s.m),s.m=null)}function On(s){if(!Si(s.h)&&!s.m){s.m=!0;var a=s.Ea;$||h(),L||($(),L=!0),E.add(a,s),s.D=0}}function tc(s,a){return Ci(s.h)>=s.h.j-(s.m?1:0)?!1:s.m?(s.i=a.G.concat(s.i),!0):s.I==1||s.I==2||s.D>=(s.Sa?0:s.Ta)?!1:(s.m=He(m(s.Ea,s,a),Xi(s,s.D)),s.D++,!0)}n.Ea=function(s){if(this.m)if(this.m=null,this.I==1){if(!s){this.V=Math.floor(Math.random()*1e5),s=this.V++;const I=new Ht(this,this.j,s);let x=this.o;if(this.U&&(x?(x=It(x),ii(x,this.U)):x=this.U),this.u!==null||this.R||(I.J=x,x=null),this.S)t:{for(var a=0,c=0;c<this.i.length;c++){e:{var f=this.i[c];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break e}f=void 0}if(f===void 0)break;if(a+=f,a>4096){a=c;break t}if(a===4096||c===this.i.length-1){a=c+1;break t}}a=1e3}else a=1e3;a=Wi(this,I,a),c=Vt(this.J),Y(c,"RID",s),Y(c,"CVER",22),this.G&&Y(c,"X-HTTP-Session-Id",this.G),en(this,c),x&&(this.R?a="headers="+ze(Bi(x))+"&"+a:this.u&&qr(c,this.u,x)),$r(this.h,I),this.Ra&&Y(c,"TYPE","init"),this.S?(Y(c,"$req",a),Y(c,"SID","null"),I.U=!0,Or(I,c,null)):Or(I,c,a),this.I=2}}else this.I==3&&(s?Gi(this,s):this.i.length==0||Si(this.h)||Gi(this))};function Gi(s,a){var c;a?c=a.l:c=s.V++;const f=Vt(s.J);Y(f,"SID",s.M),Y(f,"RID",c),Y(f,"AID",s.K),en(s,f),s.u&&s.o&&qr(f,s.u,s.o),c=new Ht(s,s.j,c,s.D+1),s.u===null&&(c.J=s.o),a&&(s.i=a.G.concat(s.i)),a=Wi(s,c,1e3),c.H=Math.round(s.va*.5)+Math.round(s.va*.5*Math.random()),$r(s.h,c),Or(c,f,a)}function en(s,a){s.H&&_e(s.H,function(c,f){Y(a,f,c)}),s.l&&_e({},function(c,f){Y(a,f,c)})}function Wi(s,a,c){c=Math.min(s.i.length,c);const f=s.l?m(s.l.Ka,s.l,s):null;t:{var I=s.i;let j=-1;for(;;){const it=["count="+c];j==-1?c>0?(j=I[0].g,it.push("ofs="+j)):j=0:it.push("ofs="+j);let K=!0;for(let ot=0;ot<c;ot++){var x=I[ot].g;const Mt=I[ot].map;if(x-=j,x<0)j=Math.max(0,I[ot].g-100),K=!1;else try{x="req"+x+"_"||"";try{var N=Mt instanceof Map?Mt:Object.entries(Mt);for(const[ie,Wt]of N){let Kt=Wt;u(Wt)&&(Kt=Dr(Wt)),it.push(x+ie+"="+encodeURIComponent(Kt))}}catch(ie){throw it.push(x+"type="+encodeURIComponent("_badmap")),ie}}catch{f&&f(Mt)}}if(K){N=it.join("&");break t}}N=void 0}return s=s.i.splice(0,c),a.G=s,N}function Ki(s){if(!s.g&&!s.v){s.Y=1;var a=s.Da;$||h(),L||($(),L=!0),E.add(a,s),s.A=0}}function Gr(s){return s.g||s.v||s.A>=3?!1:(s.Y++,s.v=He(m(s.Da,s),Xi(s,s.A)),s.A++,!0)}n.Da=function(){if(this.v=null,Qi(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var s=4*this.T;this.j.info("BP detection timer enabled: "+s),this.B=He(m(this.Wa,this),s)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,wt(10),Nn(this),Qi(this))};function Wr(s){s.B!=null&&(l.clearTimeout(s.B),s.B=null)}function Qi(s){s.g=new Ht(s,s.j,"rpc",s.Y),s.u===null&&(s.g.J=s.o),s.g.P=0;var a=Vt(s.na);Y(a,"RID","rpc"),Y(a,"SID",s.M),Y(a,"AID",s.K),Y(a,"CI",s.F?"0":"1"),!s.F&&s.ia&&Y(a,"TO",s.ia),Y(a,"TYPE","xmlhttp"),en(s,a),s.u&&s.o&&qr(a,s.u,s.o),s.O&&(s.g.H=s.O);var c=s.g;s=s.ba,c.M=1,c.A=Vn(Vt(a)),c.u=null,c.R=!0,Ti(c,s)}n.Va=function(){this.C!=null&&(this.C=null,Nn(this),Gr(this),wt(19))};function Fn(s){s.C!=null&&(l.clearTimeout(s.C),s.C=null)}function Yi(s,a){var c=null;if(s.g==a){Fn(s),Wr(s),s.g=null;var f=2}else if(Ur(s.h,a))c=a.G,Pi(s.h,a),f=1;else return;if(s.I!=0){if(a.o)if(f==1){c=a.u?a.u.length:0,a=Date.now()-a.F;var I=s.D;f=Rn(),Et(f,new _i(f,c)),On(s)}else Ki(s);else if(I=a.m,I==3||I==0&&a.X>0||!(f==1&&tc(s,a)||f==2&&Gr(s)))switch(c&&c.length>0&&(a=s.h,a.i=a.i.concat(c)),I){case 1:se(s,5);break;case 4:se(s,10);break;case 3:se(s,6);break;default:se(s,2)}}}function Xi(s,a){let c=s.Qa+Math.floor(Math.random()*s.Za);return s.isActive()||(c*=2),c*a}function se(s,a){if(s.j.info("Error code "+a),a==2){var c=m(s.bb,s),f=s.Ua;const I=!f;f=new qt(f||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||We(f,"https"),Vn(f),I?Kl(f.toString(),c):Ql(f.toString(),c)}else wt(2);s.I=0,s.l&&s.l.pa(a),Ji(s),zi(s)}n.bb=function(s){s?(this.j.info("Successfully pinged google.com"),wt(2)):(this.j.info("Failed to ping google.com"),wt(1))};function Ji(s){if(s.I=0,s.ja=[],s.l){const a=Ri(s.h);(a.length!=0||s.i.length!=0)&&(A(s.ja,a),A(s.ja,s.i),s.h.i.length=0,D(s.i),s.i.length=0),s.l.oa()}}function Zi(s,a,c){var f=c instanceof qt?Vt(c):new qt(c);if(f.g!="")a&&(f.g=a+"."+f.g),Ke(f,f.u);else{var I=l.location;f=I.protocol,a=a?a+"."+I.hostname:I.hostname,I=+I.port;const x=new qt(null);f&&We(x,f),a&&(x.g=a),I&&Ke(x,I),c&&(x.h=c),f=x}return c=s.G,a=s.wa,c&&a&&Y(f,c,a),Y(f,"VER",s.ka),en(s,f),f}function to(s,a,c){if(a&&!s.L)throw Error("Can't create secondary domain capable XhrIo object.");return a=s.Aa&&!s.ma?new Z(new Hr({ab:c})):new Z(s.ma),a.Fa(s.L),a}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function eo(){}n=eo.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function Bn(){}Bn.prototype.g=function(s,a){return new xt(s,a)};function xt(s,a){pt.call(this),this.g=new qi(a),this.l=s,this.h=a&&a.messageUrlParams||null,s=a&&a.messageHeaders||null,a&&a.clientProtocolHeaderRequired&&(s?s["X-Client-Protocol"]="webchannel":s={"X-Client-Protocol":"webchannel"}),this.g.o=s,s=a&&a.initMessageHeaders||null,a&&a.messageContentType&&(s?s["X-WebChannel-Content-Type"]=a.messageContentType:s={"X-WebChannel-Content-Type":a.messageContentType}),a&&a.sa&&(s?s["X-WebChannel-Client-Profile"]=a.sa:s={"X-WebChannel-Client-Profile":a.sa}),this.g.U=s,(s=a&&a.Qb)&&!g(s)&&(this.g.u=s),this.A=a&&a.supportsCrossDomainXhr||!1,this.v=a&&a.sendRawJson||!1,(a=a&&a.httpSessionIdParam)&&!g(a)&&(this.g.G=a,s=this.h,s!==null&&a in s&&(s=this.h,a in s&&delete s[a])),this.j=new we(this)}T(xt,pt),xt.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},xt.prototype.close=function(){zr(this.g)},xt.prototype.o=function(s){var a=this.g;if(typeof s=="string"){var c={};c.__data__=s,s=c}else this.v&&(c={},c.__data__=Dr(s),s=c);a.i.push(new Ul(a.Ya++,s)),a.I==3&&On(a)},xt.prototype.N=function(){this.g.l=null,delete this.j,zr(this.g),delete this.g,xt.Z.N.call(this)};function no(s){Vr.call(this),s.__headers__&&(this.headers=s.__headers__,this.statusCode=s.__status__,delete s.__headers__,delete s.__status__);var a=s.__sm__;if(a){t:{for(const c in a){s=c;break t}s=void 0}(this.i=s)&&(s=this.i,a=a!==null&&s in a?a[s]:void 0),this.data=a}else this.data=s}T(no,Vr);function ro(){Mr.call(this),this.status=1}T(ro,Mr);function we(s){this.g=s}T(we,eo),we.prototype.ra=function(){Et(this.g,"a")},we.prototype.qa=function(s){Et(this.g,new no(s))},we.prototype.pa=function(s){Et(this.g,new ro)},we.prototype.oa=function(){Et(this.g,"b")},Bn.prototype.createWebChannel=Bn.prototype.g,xt.prototype.send=xt.prototype.o,xt.prototype.open=xt.prototype.m,xt.prototype.close=xt.prototype.close,Ia=function(){return new Bn},Ta=function(){return Rn()},ba=ee,us={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},kn.NO_ERROR=0,kn.TIMEOUT=8,kn.HTTP_ERROR=6,Kn=kn,vi.COMPLETE="complete",wa=vi,pi.EventType=$e,$e.OPEN="a",$e.CLOSE="b",$e.ERROR="c",$e.MESSAGE="d",pt.prototype.listen=pt.prototype.J,on=pi,Z.prototype.listenOnce=Z.prototype.K,Z.prototype.getLastError=Z.prototype.Ha,Z.prototype.getLastErrorCode=Z.prototype.ya,Z.prototype.getStatus=Z.prototype.ca,Z.prototype.getResponseJson=Z.prototype.La,Z.prototype.getResponseText=Z.prototype.la,Z.prototype.send=Z.prototype.ea,Z.prototype.setWithCredentials=Z.prototype.Fa,Ea=Z}).apply(typeof $n<"u"?$n:typeof self<"u"?self:typeof window<"u"?window:{});class gt{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}gt.UNAUTHENTICATED=new gt(null),gt.GOOGLE_CREDENTIALS=new gt("google-credentials-uid"),gt.FIRST_PARTY=new gt("first-party-uid"),gt.MOCK_USER=new gt("mock-user");let Oe="12.8.0";function Zu(n){Oe=n}const he=new pa("@firebase/firestore");function be(){return he.logLevel}function B(n,...t){if(he.logLevel<=G.DEBUG){const e=t.map(Ds);he.debug(`Firestore (${Oe}): ${n}`,...e)}}function de(n,...t){if(he.logLevel<=G.ERROR){const e=t.map(Ds);he.error(`Firestore (${Oe}): ${n}`,...e)}}function yr(n,...t){if(he.logLevel<=G.WARN){const e=t.map(Ds);he.warn(`Firestore (${Oe}): ${n}`,...e)}}function Ds(n){if(typeof n=="string")return n;try{return(function(e){return JSON.stringify(e)})(n)}catch{return n}}function q(n,t,e){let r="Unexpected state";typeof t=="string"?r=t:e=t,xa(n,r,e)}function xa(n,t,e){let r=`FIRESTORE (${Oe}) INTERNAL ASSERTION FAILED: ${t} (ID: ${n.toString(16)})`;if(e!==void 0)try{r+=" CONTEXT: "+JSON.stringify(e)}catch{r+=" CONTEXT: "+e}throw de(r),new Error(r)}function tt(n,t,e,r){let i="Unexpected state";typeof e=="string"?i=e:r=e,n||xa(t,i,r)}function Q(n,t){return n}const M={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class U extends Ne{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ce{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class Aa{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class th{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(gt.UNAUTHENTICATED)))}shutdown(){}}class eh{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class nh{constructor(t){this.t=t,this.currentUser=gt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){tt(this.o===void 0,42304);let r=this.i;const i=p=>this.i!==r?(r=this.i,e(p)):Promise.resolve();let o=new ce;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new ce,t.enqueueRetryable((()=>i(this.currentUser)))};const l=()=>{const p=o;t.enqueueRetryable((async()=>{await p.promise,await i(this.currentUser)}))},u=p=>{B("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=p,this.o&&(this.auth.addAuthTokenListener(this.o),l())};this.t.onInit((p=>u(p))),setTimeout((()=>{if(!this.auth){const p=this.t.getImmediate({optional:!0});p?u(p):(B("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new ce)}}),0),l()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((r=>this.i!==t?(B("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(tt(typeof r.accessToken=="string",31837,{l:r}),new Aa(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return tt(t===null||typeof t=="string",2055,{h:t}),new gt(t)}}class rh{constructor(t,e,r){this.P=t,this.T=e,this.I=r,this.type="FirstParty",this.user=gt.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);const t=this.A();return t&&this.R.set("Authorization",t),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class sh{constructor(t,e,r){this.P=t,this.T=e,this.I=r}getToken(){return Promise.resolve(new rh(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable((()=>e(gt.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class _o{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ih{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Nu(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){tt(this.o===void 0,3512);const r=o=>{o.error!=null&&B("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const l=o.token!==this.m;return this.m=o.token,B("FirebaseAppCheckTokenProvider",`Received ${l?"new":"existing"} token.`),l?e(o.token):Promise.resolve()};this.o=o=>{t.enqueueRetryable((()=>r(o)))};const i=o=>{B("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>i(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?i(o):B("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new _o(this.p));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((e=>e?(tt(typeof e.token=="string",44558,{tokenResult:e}),this.m=e.token,new _o(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function oh(n){const t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let r=0;r<n;r++)e[r]=Math.floor(256*Math.random());return e}class Vs{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=oh(40);for(let o=0;o<i.length;++o)r.length<20&&i[o]<e&&(r+=t.charAt(i[o]%62))}return r}}function W(n,t){return n<t?-1:n>t?1:0}function hs(n,t){const e=Math.min(n.length,t.length);for(let r=0;r<e;r++){const i=n.charAt(r),o=t.charAt(r);if(i!==o)return Zr(i)===Zr(o)?W(i,o):Zr(i)?1:-1}return W(n.length,t.length)}const ah=55296,lh=57343;function Zr(n){const t=n.charCodeAt(0);return t>=ah&&t<=lh}function Re(n,t,e){return n.length===t.length&&n.every(((r,i)=>e(r,t[i])))}const vo="__name__";class Lt{constructor(t,e,r){e===void 0?e=0:e>t.length&&q(637,{offset:e,range:t.length}),r===void 0?r=t.length-e:r>t.length-e&&q(1746,{length:r,range:t.length-e}),this.segments=t,this.offset=e,this.len=r}get length(){return this.len}isEqual(t){return Lt.comparator(this,t)===0}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Lt?t.forEach((r=>{e.push(r)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,r=this.limit();e<r;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const r=Math.min(t.length,e.length);for(let i=0;i<r;i++){const o=Lt.compareSegments(t.get(i),e.get(i));if(o!==0)return o}return W(t.length,e.length)}static compareSegments(t,e){const r=Lt.isNumericId(t),i=Lt.isNumericId(e);return r&&!i?-1:!r&&i?1:r&&i?Lt.extractNumericId(t).compare(Lt.extractNumericId(e)):hs(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return ks.fromString(t.substring(4,t.length-2))}}class et extends Lt{construct(t,e,r){return new et(t,e,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const r of t){if(r.indexOf("//")>=0)throw new U(M.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);e.push(...r.split("/").filter((i=>i.length>0)))}return new et(e)}static emptyPath(){return new et([])}}const ch=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class dt extends Lt{construct(t,e,r){return new dt(t,e,r)}static isValidIdentifier(t){return ch.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),dt.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===vo}static keyField(){return new dt([vo])}static fromServerFormat(t){const e=[];let r="",i=0;const o=()=>{if(r.length===0)throw new U(M.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(r),r=""};let l=!1;for(;i<t.length;){const u=t[i];if(u==="\\"){if(i+1===t.length)throw new U(M.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const p=t[i+1];if(p!=="\\"&&p!=="."&&p!=="`")throw new U(M.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=p,i+=2}else u==="`"?(l=!l,i++):u!=="."||l?(r+=u,i++):(o(),i++)}if(o(),l)throw new U(M.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new dt(e)}static emptyPath(){return new dt([])}}class H{constructor(t){this.path=t}static fromPath(t){return new H(et.fromString(t))}static fromName(t){return new H(et.fromString(t).popFirst(5))}static empty(){return new H(et.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&et.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return et.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new H(new et(t.slice()))}}function uh(n,t,e){if(!e)throw new U(M.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function hh(n,t,e,r){if(t===!0&&r===!0)throw new U(M.INVALID_ARGUMENT,`${n} and ${e} cannot be used together.`)}function Eo(n){if(!H.isDocumentKey(n))throw new U(M.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Sa(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Ms(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const t=(function(r){return r.constructor?r.constructor.name:null})(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":q(12329,{type:typeof n})}function ds(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new U(M.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const e=Ms(n);throw new U(M.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return n}function st(n,t){const e={typeString:n};return t&&(e.value=t),e}function wn(n,t){if(!Sa(n))throw new U(M.INVALID_ARGUMENT,"JSON must be an object");let e;for(const r in t)if(t[r]){const i=t[r].typeString,o="value"in t[r]?{value:t[r].value}:void 0;if(!(r in n)){e=`JSON missing required field: '${r}'`;break}const l=n[r];if(i&&typeof l!==i){e=`JSON field '${r}' must be a ${i}.`;break}if(o!==void 0&&l!==o.value){e=`Expected '${r}' field to equal '${o.value}'`;break}}if(e)throw new U(M.INVALID_ARGUMENT,e);return!0}const wo=-62135596800,bo=1e6;class J{static now(){return J.fromMillis(Date.now())}static fromDate(t){return J.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),r=Math.floor((t-1e3*e)*bo);return new J(e,r)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new U(M.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new U(M.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<wo)throw new U(M.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new U(M.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/bo}_compareTo(t){return this.seconds===t.seconds?W(this.nanoseconds,t.nanoseconds):W(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:J._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(wn(t,J._jsonSchema))return new J(t.seconds,t.nanoseconds)}valueOf(){const t=this.seconds-wo;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}J._jsonSchemaVersion="firestore/timestamp/1.0",J._jsonSchema={type:st("string",J._jsonSchemaVersion),seconds:st("number"),nanoseconds:st("number")};class X{static fromTimestamp(t){return new X(t)}static min(){return new X(new J(0,0))}static max(){return new X(new J(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const mn=-1;function dh(n,t){const e=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=X.fromTimestamp(r===1e9?new J(e+1,0):new J(e,r));return new Xt(i,H.empty(),t)}function fh(n){return new Xt(n.readTime,n.key,mn)}class Xt{constructor(t,e,r){this.readTime=t,this.documentKey=e,this.largestBatchId=r}static min(){return new Xt(X.min(),H.empty(),mn)}static max(){return new Xt(X.max(),H.empty(),mn)}}function ph(n,t){let e=n.readTime.compareTo(t.readTime);return e!==0?e:(e=H.comparator(n.documentKey,t.documentKey),e!==0?e:W(n.largestBatchId,t.largestBatchId))}const mh="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class gh{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function Ls(n){if(n.code!==M.FAILED_PRECONDITION||n.message!==mh)throw n;B("LocalStore","Unexpectedly lost primary lease")}class k{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&q(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new k(((r,i)=>{this.nextCallback=o=>{this.wrapSuccess(t,o).next(r,i)},this.catchCallback=o=>{this.wrapFailure(e,o).next(r,i)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof k?e:k.resolve(e)}catch(e){return k.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):k.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):k.reject(e)}static resolve(t){return new k(((e,r)=>{e(t)}))}static reject(t){return new k(((e,r)=>{r(t)}))}static waitFor(t){return new k(((e,r)=>{let i=0,o=0,l=!1;t.forEach((u=>{++i,u.next((()=>{++o,l&&o===i&&e()}),(p=>r(p)))})),l=!0,o===i&&e()}))}static or(t){let e=k.resolve(!1);for(const r of t)e=e.next((i=>i?k.resolve(i):r()));return e}static forEach(t,e){const r=[];return t.forEach(((i,o)=>{r.push(e.call(this,i,o))})),this.waitFor(r)}static mapArray(t,e){return new k(((r,i)=>{const o=t.length,l=new Array(o);let u=0;for(let p=0;p<o;p++){const m=p;e(t[m]).next((w=>{l[m]=w,++u,u===o&&r(l)}),(w=>i(w)))}}))}static doWhile(t,e){return new k(((r,i)=>{const o=()=>{t()===!0?e().next((()=>{o()}),i):r()};o()}))}}function yh(n){const t=n.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}function bn(n){return n.name==="IndexedDbTransactionError"}class Ns{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>e.writeSequenceNumber(r))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ue&&this.ue(t),t}}Ns.ce=-1;const Os=-1;function Fs(n){return n==null}function sr(n){return n===0&&1/n==-1/0}function _h(n){return typeof n=="number"&&Number.isInteger(n)&&!sr(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const Ca="";function vh(n){let t="";for(let e=0;e<n.length;e++)t.length>0&&(t=To(t)),t=Eh(n.get(e),t);return To(t)}function Eh(n,t){let e=t;const r=n.length;for(let i=0;i<r;i++){const o=n.charAt(i);switch(o){case"\0":e+="";break;case Ca:e+="";break;default:e+=o}}return e}function To(n){return n+Ca+""}function Io(n){let t=0;for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&t++;return t}function Fe(n,t){for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&t(e,n[e])}function Pa(n){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}class Tt{constructor(t,e){this.comparator=t,this.root=e||ut.EMPTY}insert(t,e){return new Tt(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,ut.BLACK,null,null))}remove(t){return new Tt(this.comparator,this.root.remove(t,this.comparator).copy(null,null,ut.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const r=this.comparator(t,e.key);if(r===0)return e.value;r<0?e=e.left:r>0&&(e=e.right)}return null}indexOf(t){let e=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(t,r.key);if(i===0)return e+r.left.size;i<0?r=r.left:(e+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,r)=>(t(e,r),!1)))}toString(){const t=[];return this.inorderTraversal(((e,r)=>(t.push(`${e}:${r}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new jn(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new jn(this.root,t,this.comparator,!1)}getReverseIterator(){return new jn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new jn(this.root,t,this.comparator,!0)}}class jn{constructor(t,e,r,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!t.isEmpty();)if(o=e?r(t.key,e):1,e&&i&&(o*=-1),o<0)t=this.isReverse?t.left:t.right;else{if(o===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class ut{constructor(t,e,r,i,o){this.key=t,this.value=e,this.color=r??ut.RED,this.left=i??ut.EMPTY,this.right=o??ut.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,r,i,o){return new ut(t??this.key,e??this.value,r??this.color,i??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,r){let i=this;const o=r(t,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(t,e,r),null):o===0?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return ut.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let r,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),e(t,i.key)===0){if(i.right.isEmpty())return ut.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,ut.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,ut.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw q(43730,{key:this.key,value:this.value});if(this.right.isRed())throw q(14113,{key:this.key,value:this.value});const t=this.left.check();if(t!==this.right.check())throw q(27949);return t+(this.isRed()?0:1)}}ut.EMPTY=null,ut.RED=!0,ut.BLACK=!1;ut.EMPTY=new class{constructor(){this.size=0}get key(){throw q(57766)}get value(){throw q(16141)}get color(){throw q(16727)}get left(){throw q(29726)}get right(){throw q(36894)}copy(t,e,r,i,o){return this}insert(t,e,r){return new ut(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ft{constructor(t){this.comparator=t,this.data=new Tt(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,r)=>(t(e),!1)))}forEachInRange(t,e){const r=this.data.getIteratorFrom(t[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let r;for(r=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new xo(this.data.getIterator())}getIteratorFrom(t){return new xo(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((r=>{e=e.add(r)})),e}isEqual(t){if(!(t instanceof ft)||this.size!==t.size)return!1;const e=this.data.getIterator(),r=t.data.getIterator();for(;e.hasNext();){const i=e.getNext().key,o=r.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new ft(this.comparator);return e.data=t,e}}class xo{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Dt{constructor(t){this.fields=t,t.sort(dt.comparator)}static empty(){return new Dt([])}unionWith(t){let e=new ft(dt.comparator);for(const r of this.fields)e=e.add(r);for(const r of t)e=e.add(r);return new Dt(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Re(this.fields,t.fields,((e,r)=>e.isEqual(r)))}}class wh extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Ot{constructor(t){this.binaryString=t}static fromBase64String(t){const e=(function(i){try{return atob(i)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new wh("Invalid base64 string: "+o):o}})(t);return new Ot(e)}static fromUint8Array(t){const e=(function(i){let o="";for(let l=0;l<i.length;++l)o+=String.fromCharCode(i[l]);return o})(t);return new Ot(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(e){return btoa(e)})(this.binaryString)}toUint8Array(){return(function(e){const r=new Uint8Array(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return W(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Ot.EMPTY_BYTE_STRING=new Ot("");const bh=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function fe(n){if(tt(!!n,39018),typeof n=="string"){let t=0;const e=bh.exec(n);if(tt(!!e,46558,{timestamp:n}),e[1]){let i=e[1];i=(i+"000000000").substr(0,9),t=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:ht(n.seconds),nanos:ht(n.nanos)}}function ht(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function ke(n){return typeof n=="string"?Ot.fromBase64String(n):Ot.fromUint8Array(n)}const Ra="server_timestamp",ka="__type__",Da="__previous_value__",Va="__local_write_time__";function Bs(n){return(n?.mapValue?.fields||{})[ka]?.stringValue===Ra}function Us(n){const t=n.mapValue.fields[Da];return Bs(t)?Us(t):t}function ir(n){const t=fe(n.mapValue.fields[Va].timestampValue);return new J(t.seconds,t.nanos)}class Th{constructor(t,e,r,i,o,l,u,p,m,w,T){this.databaseId=t,this.appId=e,this.persistenceKey=r,this.host=i,this.ssl=o,this.forceLongPolling=l,this.autoDetectLongPolling=u,this.longPollingOptions=p,this.useFetchStreams=m,this.isUsingEmulator=w,this.apiKey=T}}const or="(default)";class ar{constructor(t,e){this.projectId=t,this.database=e||or}static empty(){return new ar("","")}get isDefaultDatabase(){return this.database===or}isEqual(t){return t instanceof ar&&t.projectId===this.projectId&&t.database===this.database}}function Ih(n,t){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new U(M.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ar(n.options.projectId,t)}const Ma="__type__",xh="__max__",Hn={mapValue:{}},La="__vector__",fs="value";function pe(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Bs(n)?4:Sh(n)?9007199254740991:Ah(n)?10:11:q(28295,{value:n})}function Ft(n,t){if(n===t)return!0;const e=pe(n);if(e!==pe(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return ir(n).isEqual(ir(t));case 3:return(function(i,o){if(typeof i.timestampValue=="string"&&typeof o.timestampValue=="string"&&i.timestampValue.length===o.timestampValue.length)return i.timestampValue===o.timestampValue;const l=fe(i.timestampValue),u=fe(o.timestampValue);return l.seconds===u.seconds&&l.nanos===u.nanos})(n,t);case 5:return n.stringValue===t.stringValue;case 6:return(function(i,o){return ke(i.bytesValue).isEqual(ke(o.bytesValue))})(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return(function(i,o){return ht(i.geoPointValue.latitude)===ht(o.geoPointValue.latitude)&&ht(i.geoPointValue.longitude)===ht(o.geoPointValue.longitude)})(n,t);case 2:return(function(i,o){if("integerValue"in i&&"integerValue"in o)return ht(i.integerValue)===ht(o.integerValue);if("doubleValue"in i&&"doubleValue"in o){const l=ht(i.doubleValue),u=ht(o.doubleValue);return l===u?sr(l)===sr(u):isNaN(l)&&isNaN(u)}return!1})(n,t);case 9:return Re(n.arrayValue.values||[],t.arrayValue.values||[],Ft);case 10:case 11:return(function(i,o){const l=i.mapValue.fields||{},u=o.mapValue.fields||{};if(Io(l)!==Io(u))return!1;for(const p in l)if(l.hasOwnProperty(p)&&(u[p]===void 0||!Ft(l[p],u[p])))return!1;return!0})(n,t);default:return q(52216,{left:n})}}function gn(n,t){return(n.values||[]).find((e=>Ft(e,t)))!==void 0}function De(n,t){if(n===t)return 0;const e=pe(n),r=pe(t);if(e!==r)return W(e,r);switch(e){case 0:case 9007199254740991:return 0;case 1:return W(n.booleanValue,t.booleanValue);case 2:return(function(o,l){const u=ht(o.integerValue||o.doubleValue),p=ht(l.integerValue||l.doubleValue);return u<p?-1:u>p?1:u===p?0:isNaN(u)?isNaN(p)?0:-1:1})(n,t);case 3:return Ao(n.timestampValue,t.timestampValue);case 4:return Ao(ir(n),ir(t));case 5:return hs(n.stringValue,t.stringValue);case 6:return(function(o,l){const u=ke(o),p=ke(l);return u.compareTo(p)})(n.bytesValue,t.bytesValue);case 7:return(function(o,l){const u=o.split("/"),p=l.split("/");for(let m=0;m<u.length&&m<p.length;m++){const w=W(u[m],p[m]);if(w!==0)return w}return W(u.length,p.length)})(n.referenceValue,t.referenceValue);case 8:return(function(o,l){const u=W(ht(o.latitude),ht(l.latitude));return u!==0?u:W(ht(o.longitude),ht(l.longitude))})(n.geoPointValue,t.geoPointValue);case 9:return So(n.arrayValue,t.arrayValue);case 10:return(function(o,l){const u=o.fields||{},p=l.fields||{},m=u[fs]?.arrayValue,w=p[fs]?.arrayValue,T=W(m?.values?.length||0,w?.values?.length||0);return T!==0?T:So(m,w)})(n.mapValue,t.mapValue);case 11:return(function(o,l){if(o===Hn.mapValue&&l===Hn.mapValue)return 0;if(o===Hn.mapValue)return 1;if(l===Hn.mapValue)return-1;const u=o.fields||{},p=Object.keys(u),m=l.fields||{},w=Object.keys(m);p.sort(),w.sort();for(let T=0;T<p.length&&T<w.length;++T){const v=hs(p[T],w[T]);if(v!==0)return v;const D=De(u[p[T]],m[w[T]]);if(D!==0)return D}return W(p.length,w.length)})(n.mapValue,t.mapValue);default:throw q(23264,{he:e})}}function Ao(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return W(n,t);const e=fe(n),r=fe(t),i=W(e.seconds,r.seconds);return i!==0?i:W(e.nanos,r.nanos)}function So(n,t){const e=n.values||[],r=t.values||[];for(let i=0;i<e.length&&i<r.length;++i){const o=De(e[i],r[i]);if(o)return o}return W(e.length,r.length)}function Ve(n){return ps(n)}function ps(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(e){const r=fe(e);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(e){return ke(e).toBase64()})(n.bytesValue):"referenceValue"in n?(function(e){return H.fromName(e).toString()})(n.referenceValue):"geoPointValue"in n?(function(e){return`geo(${e.latitude},${e.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(e){let r="[",i=!0;for(const o of e.values||[])i?i=!1:r+=",",r+=ps(o);return r+"]"})(n.arrayValue):"mapValue"in n?(function(e){const r=Object.keys(e.fields||{}).sort();let i="{",o=!0;for(const l of r)o?o=!1:i+=",",i+=`${l}:${ps(e.fields[l])}`;return i+"}"})(n.mapValue):q(61005,{value:n})}function Qn(n){switch(pe(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=Us(n);return t?16+Qn(t):16;case 5:return 2*n.stringValue.length;case 6:return ke(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((i,o)=>i+Qn(o)),0)})(n.arrayValue);case 10:case 11:return(function(r){let i=0;return Fe(r.fields,((o,l)=>{i+=o.length+Qn(l)})),i})(n.mapValue);default:throw q(13486,{value:n})}}function ms(n){return!!n&&"integerValue"in n}function $s(n){return!!n&&"arrayValue"in n}function Yn(n){return!!n&&"mapValue"in n}function Ah(n){return(n?.mapValue?.fields||{})[Ma]?.stringValue===La}function ln(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const t={mapValue:{fields:{}}};return Fe(n.mapValue.fields,((e,r)=>t.mapValue.fields[e]=ln(r))),t}if(n.arrayValue){const t={arrayValue:{values:[]}};for(let e=0;e<(n.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=ln(n.arrayValue.values[e]);return t}return{...n}}function Sh(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===xh}class Rt{constructor(t){this.value=t}static empty(){return new Rt({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let r=0;r<t.length-1;++r)if(e=(e.mapValue.fields||{})[t.get(r)],!Yn(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=ln(e)}setAll(t){let e=dt.emptyPath(),r={},i=[];t.forEach(((l,u)=>{if(!e.isImmediateParentOf(u)){const p=this.getFieldsMap(e);this.applyChanges(p,r,i),r={},i=[],e=u.popLast()}l?r[u.lastSegment()]=ln(l):i.push(u.lastSegment())}));const o=this.getFieldsMap(e);this.applyChanges(o,r,i)}delete(t){const e=this.field(t.popLast());Yn(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Ft(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let r=0;r<t.length;++r){let i=e.mapValue.fields[t.get(r)];Yn(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},e.mapValue.fields[t.get(r)]=i),e=i}return e.mapValue.fields}applyChanges(t,e,r){Fe(e,((i,o)=>t[i]=o));for(const i of r)delete t[i]}clone(){return new Rt(ln(this.value))}}function Na(n){const t=[];return Fe(n.fields,((e,r)=>{const i=new dt([e]);if(Yn(r)){const o=Na(r.mapValue).fields;if(o.length===0)t.push(i);else for(const l of o)t.push(i.child(l))}else t.push(i)})),new Dt(t)}class Pt{constructor(t,e,r,i,o,l,u){this.key=t,this.documentType=e,this.version=r,this.readTime=i,this.createTime=o,this.data=l,this.documentState=u}static newInvalidDocument(t){return new Pt(t,0,X.min(),X.min(),X.min(),Rt.empty(),0)}static newFoundDocument(t,e,r,i){return new Pt(t,1,e,X.min(),r,i,0)}static newNoDocument(t,e){return new Pt(t,2,e,X.min(),X.min(),Rt.empty(),0)}static newUnknownDocument(t,e){return new Pt(t,3,e,X.min(),X.min(),Rt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(X.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Rt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Rt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=X.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof Pt&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Pt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class lr{constructor(t,e){this.position=t,this.inclusive=e}}function Co(n,t,e){let r=0;for(let i=0;i<n.position.length;i++){const o=t[i],l=n.position[i];if(o.field.isKeyField()?r=H.comparator(H.fromName(l.referenceValue),e.key):r=De(l,e.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function Po(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let e=0;e<n.position.length;e++)if(!Ft(n.position[e],t.position[e]))return!1;return!0}class cr{constructor(t,e="asc"){this.field=t,this.dir=e}}function Ch(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}class Oa{}class lt extends Oa{constructor(t,e,r){super(),this.field=t,this.op=e,this.value=r}static create(t,e,r){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,r):new Rh(t,e,r):e==="array-contains"?new Vh(t,r):e==="in"?new Mh(t,r):e==="not-in"?new Lh(t,r):e==="array-contains-any"?new Nh(t,r):new lt(t,e,r)}static createKeyFieldInFilter(t,e,r){return e==="in"?new kh(t,r):new Dh(t,r)}matches(t){const e=t.data.field(this.field);return this.op==="!="?e!==null&&e.nullValue===void 0&&this.matchesComparison(De(e,this.value)):e!==null&&pe(this.value)===pe(e)&&this.matchesComparison(De(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return q(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Jt extends Oa{constructor(t,e){super(),this.filters=t,this.op=e,this.Pe=null}static create(t,e){return new Jt(t,e)}matches(t){return Fa(this)?this.filters.find((e=>!e.matches(t)))===void 0:this.filters.find((e=>e.matches(t)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Fa(n){return n.op==="and"}function Ba(n){return Ph(n)&&Fa(n)}function Ph(n){for(const t of n.filters)if(t instanceof Jt)return!1;return!0}function gs(n){if(n instanceof lt)return n.field.canonicalString()+n.op.toString()+Ve(n.value);if(Ba(n))return n.filters.map((t=>gs(t))).join(",");{const t=n.filters.map((e=>gs(e))).join(",");return`${n.op}(${t})`}}function Ua(n,t){return n instanceof lt?(function(r,i){return i instanceof lt&&r.op===i.op&&r.field.isEqual(i.field)&&Ft(r.value,i.value)})(n,t):n instanceof Jt?(function(r,i){return i instanceof Jt&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce(((o,l,u)=>o&&Ua(l,i.filters[u])),!0):!1})(n,t):void q(19439)}function $a(n){return n instanceof lt?(function(e){return`${e.field.canonicalString()} ${e.op} ${Ve(e.value)}`})(n):n instanceof Jt?(function(e){return e.op.toString()+" {"+e.getFilters().map($a).join(" ,")+"}"})(n):"Filter"}class Rh extends lt{constructor(t,e,r){super(t,e,r),this.key=H.fromName(r.referenceValue)}matches(t){const e=H.comparator(t.key,this.key);return this.matchesComparison(e)}}class kh extends lt{constructor(t,e){super(t,"in",e),this.keys=ja("in",e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Dh extends lt{constructor(t,e){super(t,"not-in",e),this.keys=ja("not-in",e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function ja(n,t){return(t.arrayValue?.values||[]).map((e=>H.fromName(e.referenceValue)))}class Vh extends lt{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return $s(e)&&gn(e.arrayValue,this.value)}}class Mh extends lt{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return e!==null&&gn(this.value.arrayValue,e)}}class Lh extends lt{constructor(t,e){super(t,"not-in",e)}matches(t){if(gn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return e!==null&&e.nullValue===void 0&&!gn(this.value.arrayValue,e)}}class Nh extends lt{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!$s(e)||!e.arrayValue.values)&&e.arrayValue.values.some((r=>gn(this.value.arrayValue,r)))}}class Oh{constructor(t,e=null,r=[],i=[],o=null,l=null,u=null){this.path=t,this.collectionGroup=e,this.orderBy=r,this.filters=i,this.limit=o,this.startAt=l,this.endAt=u,this.Te=null}}function Ro(n,t=null,e=[],r=[],i=null,o=null,l=null){return new Oh(n,t,e,r,i,o,l)}function js(n){const t=Q(n);if(t.Te===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((r=>gs(r))).join(","),e+="|ob:",e+=t.orderBy.map((r=>(function(o){return o.field.canonicalString()+o.dir})(r))).join(","),Fs(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((r=>Ve(r))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((r=>Ve(r))).join(",")),t.Te=e}return t.Te}function Hs(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<n.orderBy.length;e++)if(!Ch(n.orderBy[e],t.orderBy[e]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let e=0;e<n.filters.length;e++)if(!Ua(n.filters[e],t.filters[e]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!Po(n.startAt,t.startAt)&&Po(n.endAt,t.endAt)}class _r{constructor(t,e=null,r=[],i=[],o=null,l="F",u=null,p=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=r,this.filters=i,this.limit=o,this.limitType=l,this.startAt=u,this.endAt=p,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function Fh(n,t,e,r,i,o,l,u){return new _r(n,t,e,r,i,o,l,u)}function Bh(n){return new _r(n)}function ko(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Uh(n){return H.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function $h(n){return n.collectionGroup!==null}function cn(n){const t=Q(n);if(t.Ie===null){t.Ie=[];const e=new Set;for(const o of t.explicitOrderBy)t.Ie.push(o),e.add(o.field.canonicalString());const r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(l){let u=new ft(dt.comparator);return l.filters.forEach((p=>{p.getFlattenedFilters().forEach((m=>{m.isInequality()&&(u=u.add(m.field))}))})),u})(t).forEach((o=>{e.has(o.canonicalString())||o.isKeyField()||t.Ie.push(new cr(o,r))})),e.has(dt.keyField().canonicalString())||t.Ie.push(new cr(dt.keyField(),r))}return t.Ie}function ue(n){const t=Q(n);return t.Ee||(t.Ee=jh(t,cn(n))),t.Ee}function jh(n,t){if(n.limitType==="F")return Ro(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map((i=>{const o=i.dir==="desc"?"asc":"desc";return new cr(i.field,o)}));const e=n.endAt?new lr(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new lr(n.startAt.position,n.startAt.inclusive):null;return Ro(n.path,n.collectionGroup,t,n.filters,n.limit,e,r)}}function ys(n,t,e){return new _r(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,e,n.startAt,n.endAt)}function Ha(n,t){return Hs(ue(n),ue(t))&&n.limitType===t.limitType}function qa(n){return`${js(ue(n))}|lt:${n.limitType}`}function rn(n){return`Query(target=${(function(e){let r=e.path.canonicalString();return e.collectionGroup!==null&&(r+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(r+=`, filters: [${e.filters.map((i=>$a(i))).join(", ")}]`),Fs(e.limit)||(r+=", limit: "+e.limit),e.orderBy.length>0&&(r+=`, orderBy: [${e.orderBy.map((i=>(function(l){return`${l.field.canonicalString()} (${l.dir})`})(i))).join(", ")}]`),e.startAt&&(r+=", startAt: ",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map((i=>Ve(i))).join(",")),e.endAt&&(r+=", endAt: ",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map((i=>Ve(i))).join(",")),`Target(${r})`})(ue(n))}; limitType=${n.limitType})`}function qs(n,t){return t.isFoundDocument()&&(function(r,i){const o=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):H.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(n,t)&&(function(r,i){for(const o of cn(r))if(!o.field.isKeyField()&&i.data.field(o.field)===null)return!1;return!0})(n,t)&&(function(r,i){for(const o of r.filters)if(!o.matches(i))return!1;return!0})(n,t)&&(function(r,i){return!(r.startAt&&!(function(l,u,p){const m=Co(l,u,p);return l.inclusive?m<=0:m<0})(r.startAt,cn(r),i)||r.endAt&&!(function(l,u,p){const m=Co(l,u,p);return l.inclusive?m>=0:m>0})(r.endAt,cn(r),i))})(n,t)}function Hh(n){return(t,e)=>{let r=!1;for(const i of cn(n)){const o=qh(i,t,e);if(o!==0)return o;r=r||i.field.isKeyField()}return 0}}function qh(n,t,e){const r=n.field.isKeyField()?H.comparator(t.key,e.key):(function(o,l,u){const p=l.data.field(o),m=u.data.field(o);return p!==null&&m!==null?De(p,m):q(42886)})(n.field,t,e);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return q(19790,{direction:n.dir})}}class me{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),r=this.inner[e];if(r!==void 0){for(const[i,o]of r)if(this.equalsFn(i,t))return o}}has(t){return this.get(t)!==void 0}set(t,e){const r=this.mapKeyFn(t),i=this.inner[r];if(i===void 0)return this.inner[r]=[[t,e]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],t))return void(i[o]=[t,e]);i.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),r=this.inner[e];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return r.length===1?delete this.inner[e]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(t){Fe(this.inner,((e,r)=>{for(const[i,o]of r)t(i,o)}))}isEmpty(){return Pa(this.inner)}size(){return this.innerSize}}const zh=new Tt(H.comparator);function ur(){return zh}const za=new Tt(H.comparator);function qn(...n){let t=za;for(const e of n)t=t.insert(e.key,e);return t}function Ga(n){let t=za;return n.forEach(((e,r)=>t=t.insert(e,r.overlayedDocument))),t}function le(){return un()}function Wa(){return un()}function un(){return new me((n=>n.toString()),((n,t)=>n.isEqual(t)))}const Gh=new Tt(H.comparator),Wh=new ft(H.comparator);function yt(...n){let t=Wh;for(const e of n)t=t.add(e);return t}const Kh=new ft(W);function Qh(){return Kh}function zs(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:sr(t)?"-0":t}}function Ka(n){return{integerValue:""+n}}function Yh(n,t){return _h(t)?Ka(t):zs(n,t)}class vr{constructor(){this._=void 0}}function Xh(n,t,e){return n instanceof yn?(function(i,o){const l={fields:{[ka]:{stringValue:Ra},[Va]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return o&&Bs(o)&&(o=Us(o)),o&&(l.fields[Da]=o),{mapValue:l}})(e,t):n instanceof _n?Ya(n,t):n instanceof vn?Xa(n,t):(function(i,o){const l=Qa(i,o),u=Do(l)+Do(i.Ae);return ms(l)&&ms(i.Ae)?Ka(u):zs(i.serializer,u)})(n,t)}function Jh(n,t,e){return n instanceof _n?Ya(n,t):n instanceof vn?Xa(n,t):e}function Qa(n,t){return n instanceof hr?(function(r){return ms(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(t)?t:{integerValue:0}:null}class yn extends vr{}class _n extends vr{constructor(t){super(),this.elements=t}}function Ya(n,t){const e=Ja(t);for(const r of n.elements)e.some((i=>Ft(i,r)))||e.push(r);return{arrayValue:{values:e}}}class vn extends vr{constructor(t){super(),this.elements=t}}function Xa(n,t){let e=Ja(t);for(const r of n.elements)e=e.filter((i=>!Ft(i,r)));return{arrayValue:{values:e}}}class hr extends vr{constructor(t,e){super(),this.serializer=t,this.Ae=e}}function Do(n){return ht(n.integerValue||n.doubleValue)}function Ja(n){return $s(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class Zh{constructor(t,e){this.field=t,this.transform=e}}function td(n,t){return n.field.isEqual(t.field)&&(function(r,i){return r instanceof _n&&i instanceof _n||r instanceof vn&&i instanceof vn?Re(r.elements,i.elements,Ft):r instanceof hr&&i instanceof hr?Ft(r.Ae,i.Ae):r instanceof yn&&i instanceof yn})(n.transform,t.transform)}class ed{constructor(t,e){this.version=t,this.transformResults=e}}class Ut{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Ut}static exists(t){return new Ut(void 0,t)}static updateTime(t){return new Ut(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Xn(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}class Er{}function Za(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new el(n.key,Ut.none()):new Tn(n.key,n.data,Ut.none());{const e=n.data,r=Rt.empty();let i=new ft(dt.comparator);for(let o of t.fields)if(!i.has(o)){let l=e.field(o);l===null&&o.length>1&&(o=o.popLast(),l=e.field(o)),l===null?r.delete(o):r.set(o,l),i=i.add(o)}return new ge(n.key,r,new Dt(i.toArray()),Ut.none())}}function nd(n,t,e){n instanceof Tn?(function(i,o,l){const u=i.value.clone(),p=Mo(i.fieldTransforms,o,l.transformResults);u.setAll(p),o.convertToFoundDocument(l.version,u).setHasCommittedMutations()})(n,t,e):n instanceof ge?(function(i,o,l){if(!Xn(i.precondition,o))return void o.convertToUnknownDocument(l.version);const u=Mo(i.fieldTransforms,o,l.transformResults),p=o.data;p.setAll(tl(i)),p.setAll(u),o.convertToFoundDocument(l.version,p).setHasCommittedMutations()})(n,t,e):(function(i,o,l){o.convertToNoDocument(l.version).setHasCommittedMutations()})(0,t,e)}function hn(n,t,e,r){return n instanceof Tn?(function(o,l,u,p){if(!Xn(o.precondition,l))return u;const m=o.value.clone(),w=Lo(o.fieldTransforms,p,l);return m.setAll(w),l.convertToFoundDocument(l.version,m).setHasLocalMutations(),null})(n,t,e,r):n instanceof ge?(function(o,l,u,p){if(!Xn(o.precondition,l))return u;const m=Lo(o.fieldTransforms,p,l),w=l.data;return w.setAll(tl(o)),w.setAll(m),l.convertToFoundDocument(l.version,w).setHasLocalMutations(),u===null?null:u.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((T=>T.field)))})(n,t,e,r):(function(o,l,u){return Xn(o.precondition,l)?(l.convertToNoDocument(l.version).setHasLocalMutations(),null):u})(n,t,e)}function rd(n,t){let e=null;for(const r of n.fieldTransforms){const i=t.data.field(r.field),o=Qa(r.transform,i||null);o!=null&&(e===null&&(e=Rt.empty()),e.set(r.field,o))}return e||null}function Vo(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!(function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Re(r,i,((o,l)=>td(o,l)))})(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}class Tn extends Er{constructor(t,e,r,i=[]){super(),this.key=t,this.value=e,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class ge extends Er{constructor(t,e,r,i,o=[]){super(),this.key=t,this.data=e,this.fieldMask=r,this.precondition=i,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function tl(n){const t=new Map;return n.fieldMask.fields.forEach((e=>{if(!e.isEmpty()){const r=n.data.field(e);t.set(e,r)}})),t}function Mo(n,t,e){const r=new Map;tt(n.length===e.length,32656,{Ve:e.length,de:n.length});for(let i=0;i<e.length;i++){const o=n[i],l=o.transform,u=t.data.field(o.field);r.set(o.field,Jh(l,u,e[i]))}return r}function Lo(n,t,e){const r=new Map;for(const i of n){const o=i.transform,l=e.data.field(i.field);r.set(i.field,Xh(o,l,t))}return r}class el extends Er{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class sd extends Er{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class id{constructor(t,e,r,i){this.batchId=t,this.localWriteTime=e,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(t,e){const r=e.mutationResults;for(let i=0;i<this.mutations.length;i++){const o=this.mutations[i];o.key.isEqual(t.key)&&nd(o,t,r[i])}}applyToLocalView(t,e){for(const r of this.baseMutations)r.key.isEqual(t.key)&&(e=hn(r,t,e,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(t.key)&&(e=hn(r,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const r=Wa();return this.mutations.forEach((i=>{const o=t.get(i.key),l=o.overlayedDocument;let u=this.applyToLocalView(l,o.mutatedFields);u=e.has(i.key)?null:u;const p=Za(l,u);p!==null&&r.set(i.key,p),l.isValidDocument()||l.convertToNoDocument(X.min())})),r}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),yt())}isEqual(t){return this.batchId===t.batchId&&Re(this.mutations,t.mutations,((e,r)=>Vo(e,r)))&&Re(this.baseMutations,t.baseMutations,((e,r)=>Vo(e,r)))}}class Gs{constructor(t,e,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=r,this.docVersions=i}static from(t,e,r){tt(t.mutations.length===r.length,58842,{me:t.mutations.length,fe:r.length});let i=(function(){return Gh})();const o=t.mutations;for(let l=0;l<o.length;l++)i=i.insert(o[l].key,r[l].version);return new Gs(t,e,r,i)}}class od{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}var rt,z;function ad(n){switch(n){case M.OK:return q(64938);case M.CANCELLED:case M.UNKNOWN:case M.DEADLINE_EXCEEDED:case M.RESOURCE_EXHAUSTED:case M.INTERNAL:case M.UNAVAILABLE:case M.UNAUTHENTICATED:return!1;case M.INVALID_ARGUMENT:case M.NOT_FOUND:case M.ALREADY_EXISTS:case M.PERMISSION_DENIED:case M.FAILED_PRECONDITION:case M.ABORTED:case M.OUT_OF_RANGE:case M.UNIMPLEMENTED:case M.DATA_LOSS:return!0;default:return q(15467,{code:n})}}function ld(n){if(n===void 0)return de("GRPC error has no .code"),M.UNKNOWN;switch(n){case rt.OK:return M.OK;case rt.CANCELLED:return M.CANCELLED;case rt.UNKNOWN:return M.UNKNOWN;case rt.DEADLINE_EXCEEDED:return M.DEADLINE_EXCEEDED;case rt.RESOURCE_EXHAUSTED:return M.RESOURCE_EXHAUSTED;case rt.INTERNAL:return M.INTERNAL;case rt.UNAVAILABLE:return M.UNAVAILABLE;case rt.UNAUTHENTICATED:return M.UNAUTHENTICATED;case rt.INVALID_ARGUMENT:return M.INVALID_ARGUMENT;case rt.NOT_FOUND:return M.NOT_FOUND;case rt.ALREADY_EXISTS:return M.ALREADY_EXISTS;case rt.PERMISSION_DENIED:return M.PERMISSION_DENIED;case rt.FAILED_PRECONDITION:return M.FAILED_PRECONDITION;case rt.ABORTED:return M.ABORTED;case rt.OUT_OF_RANGE:return M.OUT_OF_RANGE;case rt.UNIMPLEMENTED:return M.UNIMPLEMENTED;case rt.DATA_LOSS:return M.DATA_LOSS;default:return q(39323,{code:n})}}(z=rt||(rt={}))[z.OK=0]="OK",z[z.CANCELLED=1]="CANCELLED",z[z.UNKNOWN=2]="UNKNOWN",z[z.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",z[z.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",z[z.NOT_FOUND=5]="NOT_FOUND",z[z.ALREADY_EXISTS=6]="ALREADY_EXISTS",z[z.PERMISSION_DENIED=7]="PERMISSION_DENIED",z[z.UNAUTHENTICATED=16]="UNAUTHENTICATED",z[z.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",z[z.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",z[z.ABORTED=10]="ABORTED",z[z.OUT_OF_RANGE=11]="OUT_OF_RANGE",z[z.UNIMPLEMENTED=12]="UNIMPLEMENTED",z[z.INTERNAL=13]="INTERNAL",z[z.UNAVAILABLE=14]="UNAVAILABLE",z[z.DATA_LOSS=15]="DATA_LOSS";new ks([4294967295,4294967295],0);class cd{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function _s(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function ud(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function hd(n,t){return _s(n,t.toTimestamp())}function Se(n){return tt(!!n,49232),X.fromTimestamp((function(e){const r=fe(e);return new J(r.seconds,r.nanos)})(n))}function nl(n,t){return vs(n,t).canonicalString()}function vs(n,t){const e=(function(i){return new et(["projects",i.projectId,"databases",i.database])})(n).child("documents");return t===void 0?e:e.child(t)}function dd(n){const t=et.fromString(n);return tt(Ed(t),10190,{key:t.toString()}),t}function Es(n,t){return nl(n.databaseId,t.path)}function fd(n){const t=dd(n);return t.length===4?et.emptyPath():md(t)}function pd(n){return new et(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function md(n){return tt(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function No(n,t,e){return{name:Es(n,t),fields:e.value.mapValue.fields}}function gd(n,t){let e;if(t instanceof Tn)e={update:No(n,t.key,t.value)};else if(t instanceof el)e={delete:Es(n,t.key)};else if(t instanceof ge)e={update:No(n,t.key,t.data),updateMask:vd(t.fieldMask)};else{if(!(t instanceof sd))return q(16599,{dt:t.type});e={verify:Es(n,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map((r=>(function(o,l){const u=l.transform;if(u instanceof yn)return{fieldPath:l.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof _n)return{fieldPath:l.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof vn)return{fieldPath:l.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof hr)return{fieldPath:l.field.canonicalString(),increment:u.Ae};throw q(20930,{transform:l.transform})})(0,r)))),t.precondition.isNone||(e.currentDocument=(function(i,o){return o.updateTime!==void 0?{updateTime:hd(i,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:q(27497)})(n,t.precondition)),e}function yd(n,t){return n&&n.length>0?(tt(t!==void 0,14353),n.map((e=>(function(i,o){let l=i.updateTime?Se(i.updateTime):Se(o);return l.isEqual(X.min())&&(l=Se(o)),new ed(l,i.transformResults||[])})(e,t)))):[]}function _d(n){let t=fd(n.parent);const e=n.structuredQuery,r=e.from?e.from.length:0;let i=null;if(r>0){tt(r===1,65062);const w=e.from[0];w.allDescendants?i=w.collectionId:t=t.child(w.collectionId)}let o=[];e.where&&(o=(function(T){const v=rl(T);return v instanceof Jt&&Ba(v)?v.getFilters():[v]})(e.where));let l=[];e.orderBy&&(l=(function(T){return T.map((v=>(function(A){return new cr(Te(A.field),(function(S){switch(S){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(A.direction))})(v)))})(e.orderBy));let u=null;e.limit&&(u=(function(T){let v;return v=typeof T=="object"?T.value:T,Fs(v)?null:v})(e.limit));let p=null;e.startAt&&(p=(function(T){const v=!!T.before,D=T.values||[];return new lr(D,v)})(e.startAt));let m=null;return e.endAt&&(m=(function(T){const v=!T.before,D=T.values||[];return new lr(D,v)})(e.endAt)),Fh(t,i,l,o,u,"F",p,m)}function rl(n){return n.unaryFilter!==void 0?(function(e){switch(e.unaryFilter.op){case"IS_NAN":const r=Te(e.unaryFilter.field);return lt.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=Te(e.unaryFilter.field);return lt.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=Te(e.unaryFilter.field);return lt.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const l=Te(e.unaryFilter.field);return lt.create(l,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return q(61313);default:return q(60726)}})(n):n.fieldFilter!==void 0?(function(e){return lt.create(Te(e.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return q(58110);default:return q(50506)}})(e.fieldFilter.op),e.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(e){return Jt.create(e.compositeFilter.filters.map((r=>rl(r))),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return q(1026)}})(e.compositeFilter.op))})(n):q(30097,{filter:n})}function Te(n){return dt.fromServerFormat(n.fieldPath)}function vd(n){const t=[];return n.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function Ed(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}function sl(n){return!!n&&typeof n._toProto=="function"&&n._protoValueType==="ProtoValue"}class wd{constructor(t){this.yt=t}}function bd(n){const t=_d({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?ys(t,t.limit,"L"):t}class Td{constructor(){this.Sn=new Id}addToCollectionParentIndex(t,e){return this.Sn.add(e),k.resolve()}getCollectionParents(t,e){return k.resolve(this.Sn.getEntries(e))}addFieldIndex(t,e){return k.resolve()}deleteFieldIndex(t,e){return k.resolve()}deleteAllFieldIndexes(t){return k.resolve()}createTargetIndexes(t,e){return k.resolve()}getDocumentsMatchingTarget(t,e){return k.resolve(null)}getIndexType(t,e){return k.resolve(0)}getFieldIndexes(t,e){return k.resolve([])}getNextCollectionGroupToUpdate(t){return k.resolve(null)}getMinOffset(t,e){return k.resolve(Xt.min())}getMinOffsetFromCollectionGroup(t,e){return k.resolve(Xt.min())}updateCollectionGroup(t,e,r){return k.resolve()}updateIndexEntries(t,e){return k.resolve()}}class Id{constructor(){this.index={}}add(t){const e=t.lastSegment(),r=t.popLast(),i=this.index[e]||new ft(et.comparator),o=!i.has(r);return this.index[e]=i.add(r),o}has(t){const e=t.lastSegment(),r=t.popLast(),i=this.index[e];return i&&i.has(r)}getEntries(t){return(this.index[t]||new ft(et.comparator)).toArray()}}const Oo={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},il=41943040;class bt{static withCacheSize(t){return new bt(t,bt.DEFAULT_COLLECTION_PERCENTILE,bt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=r}}bt.DEFAULT_COLLECTION_PERCENTILE=10,bt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,bt.DEFAULT=new bt(il,bt.DEFAULT_COLLECTION_PERCENTILE,bt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),bt.DISABLED=new bt(-1,0,0);class Me{constructor(t){this.sr=t}next(){return this.sr+=2,this.sr}static _r(){return new Me(0)}static ar(){return new Me(-1)}}const Fo="LruGarbageCollector",xd=1048576;function Bo([n,t],[e,r]){const i=W(n,e);return i===0?W(t,r):i}class Ad{constructor(t){this.Pr=t,this.buffer=new ft(Bo),this.Tr=0}Ir(){return++this.Tr}Er(t){const e=[t,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(e);else{const r=this.buffer.last();Bo(e,r)<0&&(this.buffer=this.buffer.delete(r).add(e))}}get maxValue(){return this.buffer.last()[0]}}class Sd{constructor(t,e,r){this.garbageCollector=t,this.asyncQueue=e,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Ar(t){B(Fo,`Garbage collection scheduled in ${t}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){bn(e)?B(Fo,"Ignoring IndexedDB error during garbage collection: ",e):await Ls(e)}await this.Ar(3e5)}))}}class Cd{constructor(t,e){this.Vr=t,this.params=e}calculateTargetCount(t,e){return this.Vr.dr(t).next((r=>Math.floor(e/100*r)))}nthSequenceNumber(t,e){if(e===0)return k.resolve(Ns.ce);const r=new Ad(e);return this.Vr.forEachTarget(t,(i=>r.Er(i.sequenceNumber))).next((()=>this.Vr.mr(t,(i=>r.Er(i))))).next((()=>r.maxValue))}removeTargets(t,e,r){return this.Vr.removeTargets(t,e,r)}removeOrphanedDocuments(t,e){return this.Vr.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(B("LruGarbageCollector","Garbage collection skipped; disabled"),k.resolve(Oo)):this.getCacheSize(t).next((r=>r<this.params.cacheSizeCollectionThreshold?(B("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Oo):this.gr(t,e)))}getCacheSize(t){return this.Vr.getCacheSize(t)}gr(t,e){let r,i,o,l,u,p,m;const w=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((T=>(T>this.params.maximumSequenceNumbersToCollect?(B("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${T}`),i=this.params.maximumSequenceNumbersToCollect):i=T,l=Date.now(),this.nthSequenceNumber(t,i)))).next((T=>(r=T,u=Date.now(),this.removeTargets(t,r,e)))).next((T=>(o=T,p=Date.now(),this.removeOrphanedDocuments(t,r)))).next((T=>(m=Date.now(),be()<=G.DEBUG&&B("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${l-w}ms
	Determined least recently used ${i} in `+(u-l)+`ms
	Removed ${o} targets in `+(p-u)+`ms
	Removed ${T} documents in `+(m-p)+`ms
Total Duration: ${m-w}ms`),k.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:T}))))}}function Pd(n,t){return new Cd(n,t)}class Rd{constructor(){this.changes=new me((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Pt.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const r=this.changes.get(e);return r!==void 0?k.resolve(r):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class kd{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class Dd{constructor(t,e,r,i){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=r,this.indexManager=i}getDocument(t,e){let r=null;return this.documentOverlayCache.getOverlay(t,e).next((i=>(r=i,this.remoteDocumentCache.getEntry(t,e)))).next((i=>(r!==null&&hn(r.mutation,i,Dt.empty(),J.now()),i)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((r=>this.getLocalViewOfDocuments(t,r,yt()).next((()=>r))))}getLocalViewOfDocuments(t,e,r=yt()){const i=le();return this.populateOverlays(t,i,e).next((()=>this.computeViews(t,e,i,r).next((o=>{let l=qn();return o.forEach(((u,p)=>{l=l.insert(u,p.overlayedDocument)})),l}))))}getOverlayedDocuments(t,e){const r=le();return this.populateOverlays(t,r,e).next((()=>this.computeViews(t,e,r,yt())))}populateOverlays(t,e,r){const i=[];return r.forEach((o=>{e.has(o)||i.push(o)})),this.documentOverlayCache.getOverlays(t,i).next((o=>{o.forEach(((l,u)=>{e.set(l,u)}))}))}computeViews(t,e,r,i){let o=ur();const l=un(),u=(function(){return un()})();return e.forEach(((p,m)=>{const w=r.get(m.key);i.has(m.key)&&(w===void 0||w.mutation instanceof ge)?o=o.insert(m.key,m):w!==void 0?(l.set(m.key,w.mutation.getFieldMask()),hn(w.mutation,m,w.mutation.getFieldMask(),J.now())):l.set(m.key,Dt.empty())})),this.recalculateAndSaveOverlays(t,o).next((p=>(p.forEach(((m,w)=>l.set(m,w))),e.forEach(((m,w)=>u.set(m,new kd(w,l.get(m)??null)))),u)))}recalculateAndSaveOverlays(t,e){const r=un();let i=new Tt(((l,u)=>l-u)),o=yt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((l=>{for(const u of l)u.keys().forEach((p=>{const m=e.get(p);if(m===null)return;let w=r.get(p)||Dt.empty();w=u.applyToLocalView(m,w),r.set(p,w);const T=(i.get(u.batchId)||yt()).add(p);i=i.insert(u.batchId,T)}))})).next((()=>{const l=[],u=i.getReverseIterator();for(;u.hasNext();){const p=u.getNext(),m=p.key,w=p.value,T=Wa();w.forEach((v=>{if(!o.has(v)){const D=Za(e.get(v),r.get(v));D!==null&&T.set(v,D),o=o.add(v)}})),l.push(this.documentOverlayCache.saveOverlays(t,m,T))}return k.waitFor(l)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((r=>this.recalculateAndSaveOverlays(t,r)))}getDocumentsMatchingQuery(t,e,r,i){return Uh(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):$h(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,r,i):this.getDocumentsMatchingCollectionQuery(t,e,r,i)}getNextDocuments(t,e,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,r,i).next((o=>{const l=i-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,r.largestBatchId,i-o.size):k.resolve(le());let u=mn,p=o;return l.next((m=>k.forEach(m,((w,T)=>(u<T.largestBatchId&&(u=T.largestBatchId),o.get(w)?k.resolve():this.remoteDocumentCache.getEntry(t,w).next((v=>{p=p.insert(w,v)}))))).next((()=>this.populateOverlays(t,m,o))).next((()=>this.computeViews(t,p,m,yt()))).next((w=>({batchId:u,changes:Ga(w)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new H(e)).next((r=>{let i=qn();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i}))}getDocumentsMatchingCollectionGroupQuery(t,e,r,i){const o=e.collectionGroup;let l=qn();return this.indexManager.getCollectionParents(t,o).next((u=>k.forEach(u,(p=>{const m=(function(T,v){return new _r(v,null,T.explicitOrderBy.slice(),T.filters.slice(),T.limit,T.limitType,T.startAt,T.endAt)})(e,p.child(o));return this.getDocumentsMatchingCollectionQuery(t,m,r,i).next((w=>{w.forEach(((T,v)=>{l=l.insert(T,v)}))}))})).next((()=>l))))}getDocumentsMatchingCollectionQuery(t,e,r,i){let o;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,r.largestBatchId).next((l=>(o=l,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,r,o,i)))).next((l=>{o.forEach(((p,m)=>{const w=m.getKey();l.get(w)===null&&(l=l.insert(w,Pt.newInvalidDocument(w)))}));let u=qn();return l.forEach(((p,m)=>{const w=o.get(p);w!==void 0&&hn(w.mutation,m,Dt.empty(),J.now()),qs(e,m)&&(u=u.insert(p,m))})),u}))}}class Vd{constructor(t){this.serializer=t,this.Nr=new Map,this.Br=new Map}getBundleMetadata(t,e){return k.resolve(this.Nr.get(e))}saveBundleMetadata(t,e){return this.Nr.set(e.id,(function(i){return{id:i.id,version:i.version,createTime:Se(i.createTime)}})(e)),k.resolve()}getNamedQuery(t,e){return k.resolve(this.Br.get(e))}saveNamedQuery(t,e){return this.Br.set(e.name,(function(i){return{name:i.name,query:bd(i.bundledQuery),readTime:Se(i.readTime)}})(e)),k.resolve()}}class Md{constructor(){this.overlays=new Tt(H.comparator),this.Lr=new Map}getOverlay(t,e){return k.resolve(this.overlays.get(e))}getOverlays(t,e){const r=le();return k.forEach(e,(i=>this.getOverlay(t,i).next((o=>{o!==null&&r.set(i,o)})))).next((()=>r))}saveOverlays(t,e,r){return r.forEach(((i,o)=>{this.bt(t,e,o)})),k.resolve()}removeOverlaysForBatchId(t,e,r){const i=this.Lr.get(r);return i!==void 0&&(i.forEach((o=>this.overlays=this.overlays.remove(o))),this.Lr.delete(r)),k.resolve()}getOverlaysForCollection(t,e,r){const i=le(),o=e.length+1,l=new H(e.child("")),u=this.overlays.getIteratorFrom(l);for(;u.hasNext();){const p=u.getNext().value,m=p.getKey();if(!e.isPrefixOf(m.path))break;m.path.length===o&&p.largestBatchId>r&&i.set(p.getKey(),p)}return k.resolve(i)}getOverlaysForCollectionGroup(t,e,r,i){let o=new Tt(((m,w)=>m-w));const l=this.overlays.getIterator();for(;l.hasNext();){const m=l.getNext().value;if(m.getKey().getCollectionGroup()===e&&m.largestBatchId>r){let w=o.get(m.largestBatchId);w===null&&(w=le(),o=o.insert(m.largestBatchId,w)),w.set(m.getKey(),m)}}const u=le(),p=o.getIterator();for(;p.hasNext()&&(p.getNext().value.forEach(((m,w)=>u.set(m,w))),!(u.size()>=i)););return k.resolve(u)}bt(t,e,r){const i=this.overlays.get(r.key);if(i!==null){const l=this.Lr.get(i.largestBatchId).delete(r.key);this.Lr.set(i.largestBatchId,l)}this.overlays=this.overlays.insert(r.key,new od(e,r));let o=this.Lr.get(e);o===void 0&&(o=yt(),this.Lr.set(e,o)),this.Lr.set(e,o.add(r.key))}}class Ld{constructor(){this.sessionToken=Ot.EMPTY_BYTE_STRING}getSessionToken(t){return k.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,k.resolve()}}class Ws{constructor(){this.kr=new ft(at.Kr),this.qr=new ft(at.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(t,e){const r=new at(t,e);this.kr=this.kr.add(r),this.qr=this.qr.add(r)}$r(t,e){t.forEach((r=>this.addReference(r,e)))}removeReference(t,e){this.Wr(new at(t,e))}Qr(t,e){t.forEach((r=>this.removeReference(r,e)))}Gr(t){const e=new H(new et([])),r=new at(e,t),i=new at(e,t+1),o=[];return this.qr.forEachInRange([r,i],(l=>{this.Wr(l),o.push(l.key)})),o}zr(){this.kr.forEach((t=>this.Wr(t)))}Wr(t){this.kr=this.kr.delete(t),this.qr=this.qr.delete(t)}jr(t){const e=new H(new et([])),r=new at(e,t),i=new at(e,t+1);let o=yt();return this.qr.forEachInRange([r,i],(l=>{o=o.add(l.key)})),o}containsKey(t){const e=new at(t,0),r=this.kr.firstAfterOrEqual(e);return r!==null&&t.isEqual(r.key)}}class at{constructor(t,e){this.key=t,this.Hr=e}static Kr(t,e){return H.comparator(t.key,e.key)||W(t.Hr,e.Hr)}static Ur(t,e){return W(t.Hr,e.Hr)||H.comparator(t.key,e.key)}}class Nd{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.Yn=1,this.Jr=new ft(at.Kr)}checkEmpty(t){return k.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,r,i){const o=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const l=new id(o,e,r,i);this.mutationQueue.push(l);for(const u of i)this.Jr=this.Jr.add(new at(u.key,o)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast());return k.resolve(l)}lookupMutationBatch(t,e){return k.resolve(this.Zr(e))}getNextMutationBatchAfterBatchId(t,e){const r=e+1,i=this.Xr(r),o=i<0?0:i;return k.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return k.resolve(this.mutationQueue.length===0?Os:this.Yn-1)}getAllMutationBatches(t){return k.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const r=new at(e,0),i=new at(e,Number.POSITIVE_INFINITY),o=[];return this.Jr.forEachInRange([r,i],(l=>{const u=this.Zr(l.Hr);o.push(u)})),k.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(t,e){let r=new ft(W);return e.forEach((i=>{const o=new at(i,0),l=new at(i,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([o,l],(u=>{r=r.add(u.Hr)}))})),k.resolve(this.Yr(r))}getAllMutationBatchesAffectingQuery(t,e){const r=e.path,i=r.length+1;let o=r;H.isDocumentKey(o)||(o=o.child(""));const l=new at(new H(o),0);let u=new ft(W);return this.Jr.forEachWhile((p=>{const m=p.key.path;return!!r.isPrefixOf(m)&&(m.length===i&&(u=u.add(p.Hr)),!0)}),l),k.resolve(this.Yr(u))}Yr(t){const e=[];return t.forEach((r=>{const i=this.Zr(r);i!==null&&e.push(i)})),e}removeMutationBatch(t,e){tt(this.ei(e.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Jr;return k.forEach(e.mutations,(i=>{const o=new at(i.key,e.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)})).next((()=>{this.Jr=r}))}nr(t){}containsKey(t,e){const r=new at(e,0),i=this.Jr.firstAfterOrEqual(r);return k.resolve(e.isEqual(i&&i.key))}performConsistencyCheck(t){return this.mutationQueue.length,k.resolve()}ei(t,e){return this.Xr(t)}Xr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Zr(t){const e=this.Xr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class Od{constructor(t){this.ti=t,this.docs=(function(){return new Tt(H.comparator)})(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const r=e.key,i=this.docs.get(r),o=i?i.size:0,l=this.ti(e);return this.docs=this.docs.insert(r,{document:e.mutableCopy(),size:l}),this.size+=l-o,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const r=this.docs.get(e);return k.resolve(r?r.document.mutableCopy():Pt.newInvalidDocument(e))}getEntries(t,e){let r=ur();return e.forEach((i=>{const o=this.docs.get(i);r=r.insert(i,o?o.document.mutableCopy():Pt.newInvalidDocument(i))})),k.resolve(r)}getDocumentsMatchingQuery(t,e,r,i){let o=ur();const l=e.path,u=new H(l.child("__id-9223372036854775808__")),p=this.docs.getIteratorFrom(u);for(;p.hasNext();){const{key:m,value:{document:w}}=p.getNext();if(!l.isPrefixOf(m.path))break;m.path.length>l.length+1||ph(fh(w),r)<=0||(i.has(w.key)||qs(e,w))&&(o=o.insert(w.key,w.mutableCopy()))}return k.resolve(o)}getAllFromCollectionGroup(t,e,r,i){q(9500)}ni(t,e){return k.forEach(this.docs,(r=>e(r)))}newChangeBuffer(t){return new Fd(this)}getSize(t){return k.resolve(this.size)}}class Fd extends Rd{constructor(t){super(),this.Mr=t}applyChanges(t){const e=[];return this.changes.forEach(((r,i)=>{i.isValidDocument()?e.push(this.Mr.addEntry(t,i)):this.Mr.removeEntry(r)})),k.waitFor(e)}getFromCache(t,e){return this.Mr.getEntry(t,e)}getAllFromCache(t,e){return this.Mr.getEntries(t,e)}}class Bd{constructor(t){this.persistence=t,this.ri=new me((e=>js(e)),Hs),this.lastRemoteSnapshotVersion=X.min(),this.highestTargetId=0,this.ii=0,this.si=new Ws,this.targetCount=0,this.oi=Me._r()}forEachTarget(t,e){return this.ri.forEach(((r,i)=>e(i))),k.resolve()}getLastRemoteSnapshotVersion(t){return k.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return k.resolve(this.ii)}allocateTargetId(t){return this.highestTargetId=this.oi.next(),k.resolve(this.highestTargetId)}setTargetsMetadata(t,e,r){return r&&(this.lastRemoteSnapshotVersion=r),e>this.ii&&(this.ii=e),k.resolve()}lr(t){this.ri.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.oi=new Me(e),this.highestTargetId=e),t.sequenceNumber>this.ii&&(this.ii=t.sequenceNumber)}addTargetData(t,e){return this.lr(e),this.targetCount+=1,k.resolve()}updateTargetData(t,e){return this.lr(e),k.resolve()}removeTargetData(t,e){return this.ri.delete(e.target),this.si.Gr(e.targetId),this.targetCount-=1,k.resolve()}removeTargets(t,e,r){let i=0;const o=[];return this.ri.forEach(((l,u)=>{u.sequenceNumber<=e&&r.get(u.targetId)===null&&(this.ri.delete(l),o.push(this.removeMatchingKeysForTargetId(t,u.targetId)),i++)})),k.waitFor(o).next((()=>i))}getTargetCount(t){return k.resolve(this.targetCount)}getTargetData(t,e){const r=this.ri.get(e)||null;return k.resolve(r)}addMatchingKeys(t,e,r){return this.si.$r(e,r),k.resolve()}removeMatchingKeys(t,e,r){this.si.Qr(e,r);const i=this.persistence.referenceDelegate,o=[];return i&&e.forEach((l=>{o.push(i.markPotentiallyOrphaned(t,l))})),k.waitFor(o)}removeMatchingKeysForTargetId(t,e){return this.si.Gr(e),k.resolve()}getMatchingKeysForTargetId(t,e){const r=this.si.jr(e);return k.resolve(r)}containsKey(t,e){return k.resolve(this.si.containsKey(e))}}class ol{constructor(t,e){this._i={},this.overlays={},this.ai=new Ns(0),this.ui=!1,this.ui=!0,this.ci=new Ld,this.referenceDelegate=t(this),this.li=new Bd(this),this.indexManager=new Td,this.remoteDocumentCache=(function(i){return new Od(i)})((r=>this.referenceDelegate.hi(r))),this.serializer=new wd(e),this.Pi=new Vd(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Md,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let r=this._i[t.toKey()];return r||(r=new Nd(e,this.referenceDelegate),this._i[t.toKey()]=r),r}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(t,e,r){B("MemoryPersistence","Starting transaction:",t);const i=new Ud(this.ai.next());return this.referenceDelegate.Ti(),r(i).next((o=>this.referenceDelegate.Ii(i).next((()=>o)))).toPromise().then((o=>(i.raiseOnCommittedEvent(),o)))}Ei(t,e){return k.or(Object.values(this._i).map((r=>()=>r.containsKey(t,e))))}}class Ud extends gh{constructor(t){super(),this.currentSequenceNumber=t}}class Ks{constructor(t){this.persistence=t,this.Ri=new Ws,this.Ai=null}static Vi(t){return new Ks(t)}get di(){if(this.Ai)return this.Ai;throw q(60996)}addReference(t,e,r){return this.Ri.addReference(r,e),this.di.delete(r.toString()),k.resolve()}removeReference(t,e,r){return this.Ri.removeReference(r,e),this.di.add(r.toString()),k.resolve()}markPotentiallyOrphaned(t,e){return this.di.add(e.toString()),k.resolve()}removeTarget(t,e){this.Ri.Gr(e.targetId).forEach((i=>this.di.add(i.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next((i=>{i.forEach((o=>this.di.add(o.toString())))})).next((()=>r.removeTargetData(t,e)))}Ti(){this.Ai=new Set}Ii(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return k.forEach(this.di,(r=>{const i=H.fromPath(r);return this.mi(t,i).next((o=>{o||e.removeEntry(i,X.min())}))})).next((()=>(this.Ai=null,e.apply(t))))}updateLimboDocument(t,e){return this.mi(t,e).next((r=>{r?this.di.delete(e.toString()):this.di.add(e.toString())}))}hi(t){return 0}mi(t,e){return k.or([()=>k.resolve(this.Ri.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ei(t,e)])}}class dr{constructor(t,e){this.persistence=t,this.fi=new me((r=>vh(r.path)),((r,i)=>r.isEqual(i))),this.garbageCollector=Pd(this,e)}static Vi(t,e){return new dr(t,e)}Ti(){}Ii(t){return k.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}dr(t){const e=this.pr(t);return this.persistence.getTargetCache().getTargetCount(t).next((r=>e.next((i=>r+i))))}pr(t){let e=0;return this.mr(t,(r=>{e++})).next((()=>e))}mr(t,e){return k.forEach(this.fi,((r,i)=>this.wr(t,r,i).next((o=>o?k.resolve():e(i)))))}removeTargets(t,e,r){return this.persistence.getTargetCache().removeTargets(t,e,r)}removeOrphanedDocuments(t,e){let r=0;const i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.ni(t,(l=>this.wr(t,l,e).next((u=>{u||(r++,o.removeEntry(l,X.min()))})))).next((()=>o.apply(t))).next((()=>r))}markPotentiallyOrphaned(t,e){return this.fi.set(e,t.currentSequenceNumber),k.resolve()}removeTarget(t,e){const r=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,r)}addReference(t,e,r){return this.fi.set(r,t.currentSequenceNumber),k.resolve()}removeReference(t,e,r){return this.fi.set(r,t.currentSequenceNumber),k.resolve()}updateLimboDocument(t,e){return this.fi.set(e,t.currentSequenceNumber),k.resolve()}hi(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=Qn(t.data.value)),e}wr(t,e,r){return k.or([()=>this.persistence.Ei(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{const i=this.fi.get(e);return k.resolve(i!==void 0&&i>r)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}class Qs{constructor(t,e,r,i){this.targetId=t,this.fromCache=e,this.Ts=r,this.Is=i}static Es(t,e){let r=yt(),i=yt();for(const o of e.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new Qs(t,e.fromCache,r,i)}}class $d{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class jd{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=(function(){return Vc()?8:yh(kc())>0?6:4})()}initialize(t,e){this.fs=t,this.indexManager=e,this.Rs=!0}getDocumentsMatchingQuery(t,e,r,i){const o={result:null};return this.gs(t,e).next((l=>{o.result=l})).next((()=>{if(!o.result)return this.ps(t,e,i,r).next((l=>{o.result=l}))})).next((()=>{if(o.result)return;const l=new $d;return this.ys(t,e,l).next((u=>{if(o.result=u,this.As)return this.ws(t,e,l,u.size)}))})).next((()=>o.result))}ws(t,e,r,i){return r.documentReadCount<this.Vs?(be()<=G.DEBUG&&B("QueryEngine","SDK will not create cache indexes for query:",rn(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),k.resolve()):(be()<=G.DEBUG&&B("QueryEngine","Query:",rn(e),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.ds*i?(be()<=G.DEBUG&&B("QueryEngine","The SDK decides to create cache indexes for query:",rn(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,ue(e))):k.resolve())}gs(t,e){if(ko(e))return k.resolve(null);let r=ue(e);return this.indexManager.getIndexType(t,r).next((i=>i===0?null:(e.limit!==null&&i===1&&(e=ys(e,null,"F"),r=ue(e)),this.indexManager.getDocumentsMatchingTarget(t,r).next((o=>{const l=yt(...o);return this.fs.getDocuments(t,l).next((u=>this.indexManager.getMinOffset(t,r).next((p=>{const m=this.bs(e,u);return this.Ss(e,m,l,p.readTime)?this.gs(t,ys(e,null,"F")):this.Ds(t,m,e,p)}))))})))))}ps(t,e,r,i){return ko(e)||i.isEqual(X.min())?k.resolve(null):this.fs.getDocuments(t,r).next((o=>{const l=this.bs(e,o);return this.Ss(e,l,r,i)?k.resolve(null):(be()<=G.DEBUG&&B("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),rn(e)),this.Ds(t,l,e,dh(i,mn)).next((u=>u)))}))}bs(t,e){let r=new ft(Hh(t));return e.forEach(((i,o)=>{qs(t,o)&&(r=r.add(o))})),r}Ss(t,e,r,i){if(t.limit===null)return!1;if(r.size!==e.size)return!0;const o=t.limitType==="F"?e.last():e.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}ys(t,e,r){return be()<=G.DEBUG&&B("QueryEngine","Using full collection scan to execute query:",rn(e)),this.fs.getDocumentsMatchingQuery(t,e,Xt.min(),r)}Ds(t,e,r,i){return this.fs.getDocumentsMatchingQuery(t,r,i).next((o=>(e.forEach((l=>{o=o.insert(l.key,l)})),o)))}}const Hd="LocalStore";class qd{constructor(t,e,r,i){this.persistence=t,this.Cs=e,this.serializer=i,this.vs=new Tt(W),this.Fs=new me((o=>js(o)),Hs),this.Ms=new Map,this.xs=t.getRemoteDocumentCache(),this.li=t.getTargetCache(),this.Pi=t.getBundleCache(),this.Os(r)}Os(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Dd(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.vs)))}}function zd(n,t,e,r){return new qd(n,t,e,r)}async function al(n,t){const e=Q(n);return await e.persistence.runTransaction("Handle user change","readonly",(r=>{let i;return e.mutationQueue.getAllMutationBatches(r).next((o=>(i=o,e.Os(t),e.mutationQueue.getAllMutationBatches(r)))).next((o=>{const l=[],u=[];let p=yt();for(const m of i){l.push(m.batchId);for(const w of m.mutations)p=p.add(w.key)}for(const m of o){u.push(m.batchId);for(const w of m.mutations)p=p.add(w.key)}return e.localDocuments.getDocuments(r,p).next((m=>({Ns:m,removedBatchIds:l,addedBatchIds:u})))}))}))}function Gd(n,t){const e=Q(n);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const i=t.batch.keys(),o=e.xs.newChangeBuffer({trackRemovals:!0});return(function(u,p,m,w){const T=m.batch,v=T.keys();let D=k.resolve();return v.forEach((A=>{D=D.next((()=>w.getEntry(p,A))).next((V=>{const S=m.docVersions.get(A);tt(S!==null,48541),V.version.compareTo(S)<0&&(T.applyToRemoteDocument(V,m),V.isValidDocument()&&(V.setReadTime(m.commitVersion),w.addEntry(V)))}))})),D.next((()=>u.mutationQueue.removeMutationBatch(p,T)))})(e,r,t,o).next((()=>o.apply(r))).next((()=>e.mutationQueue.performConsistencyCheck(r))).next((()=>e.documentOverlayCache.removeOverlaysForBatchId(r,i,t.batch.batchId))).next((()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(u){let p=yt();for(let m=0;m<u.mutationResults.length;++m)u.mutationResults[m].transformResults.length>0&&(p=p.add(u.batch.mutations[m].key));return p})(t)))).next((()=>e.localDocuments.getDocuments(r,i)))}))}function Wd(n){const t=Q(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.li.getLastRemoteSnapshotVersion(e)))}function Kd(n,t){const e=Q(n);return e.persistence.runTransaction("Get next mutation batch","readonly",(r=>(t===void 0&&(t=Os),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t))))}class Uo{constructor(){this.activeTargetIds=Qh()}Qs(t){this.activeTargetIds=this.activeTargetIds.add(t)}Gs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Ws(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Qd{constructor(){this.vo=new Uo,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,r){}addLocalQueryTarget(t,e=!0){return e&&this.vo.Qs(t),this.Fo[t]||"not-current"}updateQueryState(t,e,r){this.Fo[t]=e}removeLocalQueryTarget(t){this.vo.Gs(t)}isLocalQueryTarget(t){return this.vo.activeTargetIds.has(t)}clearQueryState(t){delete this.Fo[t]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(t){return this.vo.activeTargetIds.has(t)}start(){return this.vo=new Uo,Promise.resolve()}handleUserChange(t,e,r){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class Yd{Mo(t){}shutdown(){}}const $o="ConnectivityMonitor";class jo{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(t){this.Lo.push(t)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){B($o,"Network connectivity changed: AVAILABLE");for(const t of this.Lo)t(0)}Bo(){B($o,"Network connectivity changed: UNAVAILABLE");for(const t of this.Lo)t(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let zn=null;function ws(){return zn===null?zn=(function(){return 268435456+Math.round(2147483648*Math.random())})():zn++,"0x"+zn.toString(16)}const ts="RestConnection",Xd={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class Jd{get Ko(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.qo=e+"://"+t.host,this.Uo=`projects/${r}/databases/${i}`,this.$o=this.databaseId.database===or?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Wo(t,e,r,i,o){const l=ws(),u=this.Qo(t,e.toUriEncodedString());B(ts,`Sending RPC '${t}' ${l}:`,u,r);const p={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(p,i,o);const{host:m}=new URL(u),w=Ps(m);return this.zo(t,u,p,r,w).then((T=>(B(ts,`Received RPC '${t}' ${l}: `,T),T)),(T=>{throw yr(ts,`RPC '${t}' ${l} failed with error: `,T,"url: ",u,"request:",r),T}))}jo(t,e,r,i,o,l){return this.Wo(t,e,r,i,o)}Go(t,e,r){t["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Oe})(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((i,o)=>t[o]=i)),r&&r.headers.forEach(((i,o)=>t[o]=i))}Qo(t,e){const r=Xd[t];let i=`${this.qo}/v1/${e}:${r}`;return this.databaseInfo.apiKey&&(i=`${i}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),i}terminate(){}}class Zd{constructor(t){this.Ho=t.Ho,this.Jo=t.Jo}Zo(t){this.Xo=t}Yo(t){this.e_=t}t_(t){this.n_=t}onMessage(t){this.r_=t}close(){this.Jo()}send(t){this.Ho(t)}i_(){this.Xo()}s_(){this.e_()}o_(t){this.n_(t)}__(t){this.r_(t)}}const mt="WebChannelConnection",sn=(n,t,e)=>{n.listen(t,(r=>{try{e(r)}catch(i){setTimeout((()=>{throw i}),0)}}))};class Ce extends Jd{constructor(t){super(t),this.a_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}static u_(){if(!Ce.c_){const t=Ta();sn(t,ba.STAT_EVENT,(e=>{e.stat===us.PROXY?B(mt,"STAT_EVENT: detected buffering proxy"):e.stat===us.NOPROXY&&B(mt,"STAT_EVENT: detected no buffering proxy")})),Ce.c_=!0}}zo(t,e,r,i,o){const l=ws();return new Promise(((u,p)=>{const m=new Ea;m.setWithCredentials(!0),m.listenOnce(wa.COMPLETE,(()=>{try{switch(m.getLastErrorCode()){case Kn.NO_ERROR:const T=m.getResponseJson();B(mt,`XHR for RPC '${t}' ${l} received:`,JSON.stringify(T)),u(T);break;case Kn.TIMEOUT:B(mt,`RPC '${t}' ${l} timed out`),p(new U(M.DEADLINE_EXCEEDED,"Request time out"));break;case Kn.HTTP_ERROR:const v=m.getStatus();if(B(mt,`RPC '${t}' ${l} failed with status:`,v,"response text:",m.getResponseText()),v>0){let D=m.getResponseJson();Array.isArray(D)&&(D=D[0]);const A=D?.error;if(A&&A.status&&A.message){const V=(function(P){const R=P.toLowerCase().replace(/_/g,"-");return Object.values(M).indexOf(R)>=0?R:M.UNKNOWN})(A.status);p(new U(V,A.message))}else p(new U(M.UNKNOWN,"Server responded with status "+m.getStatus()))}else p(new U(M.UNAVAILABLE,"Connection failed."));break;default:q(9055,{l_:t,streamId:l,h_:m.getLastErrorCode(),P_:m.getLastError()})}}finally{B(mt,`RPC '${t}' ${l} completed.`)}}));const w=JSON.stringify(i);B(mt,`RPC '${t}' ${l} sending request:`,i),m.send(e,"POST",w,r,15)}))}T_(t,e,r){const i=ws(),o=[this.qo,"/","google.firestore.v1.Firestore","/",t,"/channel"],l=this.createWebChannelTransport(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},p=this.longPollingOptions.timeoutSeconds;p!==void 0&&(u.longPollingTimeout=Math.round(1e3*p)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Go(u.initMessageHeaders,e,r),u.encodeInitMessageHeaders=!0;const m=o.join("");B(mt,`Creating RPC '${t}' stream ${i}: ${m}`,u);const w=l.createWebChannel(m,u);this.I_(w);let T=!1,v=!1;const D=new Zd({Ho:A=>{v?B(mt,`Not sending because RPC '${t}' stream ${i} is closed:`,A):(T||(B(mt,`Opening RPC '${t}' stream ${i} transport.`),w.open(),T=!0),B(mt,`RPC '${t}' stream ${i} sending:`,A),w.send(A))},Jo:()=>w.close()});return sn(w,on.EventType.OPEN,(()=>{v||(B(mt,`RPC '${t}' stream ${i} transport opened.`),D.i_())})),sn(w,on.EventType.CLOSE,(()=>{v||(v=!0,B(mt,`RPC '${t}' stream ${i} transport closed`),D.o_(),this.E_(w))})),sn(w,on.EventType.ERROR,(A=>{v||(v=!0,yr(mt,`RPC '${t}' stream ${i} transport errored. Name:`,A.name,"Message:",A.message),D.o_(new U(M.UNAVAILABLE,"The operation could not be completed")))})),sn(w,on.EventType.MESSAGE,(A=>{if(!v){const V=A.data[0];tt(!!V,16349);const S=V,P=S?.error||S[0]?.error;if(P){B(mt,`RPC '${t}' stream ${i} received error:`,P);const R=P.status;let F=(function(L){const E=rt[L];if(E!==void 0)return ld(E)})(R),O=P.message;F===void 0&&(F=M.INTERNAL,O="Unknown error status: "+R+" with message "+P.message),v=!0,D.o_(new U(F,O)),w.close()}else B(mt,`RPC '${t}' stream ${i} received:`,V),D.__(V)}})),Ce.u_(),setTimeout((()=>{D.s_()}),0),D}terminate(){this.a_.forEach((t=>t.close())),this.a_=[]}I_(t){this.a_.push(t)}E_(t){this.a_=this.a_.filter((e=>e===t))}Go(t,e,r){super.Go(t,e,r),this.databaseInfo.apiKey&&(t["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return Ia()}}function tf(n){return new Ce(n)}function es(){return typeof document<"u"?document:null}function wr(n){return new cd(n,!0)}Ce.c_=!1;class ll{constructor(t,e,r=1e3,i=1.5,o=6e4){this.Ci=t,this.timerId=e,this.R_=r,this.A_=i,this.V_=o,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(t){this.cancel();const e=Math.floor(this.d_+this.y_()),r=Math.max(0,Date.now()-this.f_),i=Math.max(0,e-r);i>0&&B("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.d_} ms, delay with jitter: ${e} ms, last attempt: ${r} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,i,(()=>(this.f_=Date.now(),t()))),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}const Ho="PersistentStream";class ef{constructor(t,e,r,i,o,l,u,p){this.Ci=t,this.b_=r,this.S_=i,this.connection=o,this.authCredentialsProvider=l,this.appCheckCredentialsProvider=u,this.listener=p,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new ll(t,e)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,(()=>this.k_())))}K_(t){this.q_(),this.stream.send(t)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(t,e){this.q_(),this.U_(),this.M_.cancel(),this.D_++,t!==4?this.M_.reset():e&&e.code===M.RESOURCE_EXHAUSTED?(de(e.toString()),de("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):e&&e.code===M.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.t_(e)}W_(){}auth(){this.state=1;const t=this.Q_(this.D_),e=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,i])=>{this.D_===e&&this.G_(r,i)}),(r=>{t((()=>{const i=new U(M.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(i)}))}))}G_(t,e){const r=this.Q_(this.D_);this.stream=this.j_(t,e),this.stream.Zo((()=>{r((()=>this.listener.Zo()))})),this.stream.Yo((()=>{r((()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.Yo())))})),this.stream.t_((i=>{r((()=>this.z_(i)))})),this.stream.onMessage((i=>{r((()=>++this.F_==1?this.H_(i):this.onNext(i)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(t){return B(Ho,`close with error: ${t}`),this.stream=null,this.close(4,t)}Q_(t){return e=>{this.Ci.enqueueAndForget((()=>this.D_===t?e():(B(Ho,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class nf extends ef{constructor(t,e,r,i,o,l){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,r,i,l),this.serializer=o}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(t,e){return this.connection.T_("Write",t,e)}H_(t){return tt(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,tt(!t.writeResults||t.writeResults.length===0,55816),this.listener.ta()}onNext(t){tt(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.M_.reset();const e=yd(t.writeResults,t.commitTime),r=Se(t.commitTime);return this.listener.na(r,e)}ra(){const t={};t.database=pd(this.serializer),this.K_(t)}ea(t){const e={streamToken:this.lastStreamToken,writes:t.map((r=>gd(this.serializer,r)))};this.K_(e)}}class rf{}class sf extends rf{constructor(t,e,r,i){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=r,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new U(M.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(t,e,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,l])=>this.connection.Wo(t,vs(e,r),i,o,l))).catch((o=>{throw o.name==="FirebaseError"?(o.code===M.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new U(M.UNKNOWN,o.toString())}))}jo(t,e,r,i,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([l,u])=>this.connection.jo(t,vs(e,r),i,l,u,o))).catch((l=>{throw l.name==="FirebaseError"?(l.code===M.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new U(M.UNKNOWN,l.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}function of(n,t,e,r){return new sf(n,t,e,r)}class af{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(t){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,t==="Online"&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){const e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(de(e),this.aa=!1):B("OnlineStateTracker",e)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const In="RemoteStore";class lf{constructor(t,e,r,i,o){this.localStore=t,this.datastore=e,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=o,this.Aa.Mo((l=>{r.enqueueAndForget((async()=>{An(this)&&(B(In,"Restarting streams for network reachability change."),await(async function(p){const m=Q(p);m.Ea.add(4),await xn(m),m.Va.set("Unknown"),m.Ea.delete(4),await br(m)})(this))}))})),this.Va=new af(r,i)}}async function br(n){if(An(n))for(const t of n.Ra)await t(!0)}async function xn(n){for(const t of n.Ra)await t(!1)}function An(n){return Q(n).Ea.size===0}async function cl(n,t,e){if(!bn(t))throw t;n.Ea.add(1),await xn(n),n.Va.set("Offline"),e||(e=()=>Wd(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{B(In,"Retrying IndexedDB access"),await e(),n.Ea.delete(1),await br(n)}))}function ul(n,t){return t().catch((e=>cl(n,e,t)))}async function Tr(n){const t=Q(n),e=Zt(t);let r=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:Os;for(;cf(t);)try{const i=await Kd(t.localStore,r);if(i===null){t.Ta.length===0&&e.L_();break}r=i.batchId,uf(t,i)}catch(i){await cl(t,i)}hl(t)&&dl(t)}function cf(n){return An(n)&&n.Ta.length<10}function uf(n,t){n.Ta.push(t);const e=Zt(n);e.O_()&&e.Y_&&e.ea(t.mutations)}function hl(n){return An(n)&&!Zt(n).x_()&&n.Ta.length>0}function dl(n){Zt(n).start()}async function hf(n){Zt(n).ra()}async function df(n){const t=Zt(n);for(const e of n.Ta)t.ea(e.mutations)}async function ff(n,t,e){const r=n.Ta.shift(),i=Gs.from(r,t,e);await ul(n,(()=>n.remoteSyncer.applySuccessfulWrite(i))),await Tr(n)}async function pf(n,t){t&&Zt(n).Y_&&await(async function(r,i){if((function(l){return ad(l)&&l!==M.ABORTED})(i.code)){const o=r.Ta.shift();Zt(r).B_(),await ul(r,(()=>r.remoteSyncer.rejectFailedWrite(o.batchId,i))),await Tr(r)}})(n,t),hl(n)&&dl(n)}async function qo(n,t){const e=Q(n);e.asyncQueue.verifyOperationInProgress(),B(In,"RemoteStore received new credentials");const r=An(e);e.Ea.add(3),await xn(e),r&&e.Va.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await br(e)}async function mf(n,t){const e=Q(n);t?(e.Ea.delete(2),await br(e)):t||(e.Ea.add(2),await xn(e),e.Va.set("Unknown"))}function Zt(n){return n.fa||(n.fa=(function(e,r,i){const o=Q(e);return o.sa(),new nf(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)})(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),Yo:hf.bind(null,n),t_:pf.bind(null,n),ta:df.bind(null,n),na:ff.bind(null,n)}),n.Ra.push((async t=>{t?(n.fa.B_(),await Tr(n)):(await n.fa.stop(),n.Ta.length>0&&(B(In,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class Ys{constructor(t,e,r,i,o){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new ce,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((l=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,r,i,o){const l=Date.now()+r,u=new Ys(t,e,l,i,o);return u.start(r),u}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new U(M.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function fl(n,t){if(de("AsyncQueue",`${t}: ${n}`),bn(n))return new U(M.UNAVAILABLE,`${t}: ${n}`);throw n}class gf{constructor(){this.queries=zo(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(e,r){const i=Q(e),o=i.queries;i.queries=zo(),o.forEach(((l,u)=>{for(const p of u.ba)p.onError(r)}))})(this,new U(M.ABORTED,"Firestore shutting down"))}}function zo(){return new me((n=>qa(n)),Ha)}function yf(n){n.Ca.forEach((t=>{t.next()}))}var Go,Wo;(Wo=Go||(Go={})).Ma="default",Wo.Cache="cache";const _f="SyncEngine";class vf{constructor(t,e,r,i,o,l){this.localStore=t,this.remoteStore=e,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=l,this.Pu={},this.Tu=new me((u=>qa(u)),Ha),this.Iu=new Map,this.Eu=new Set,this.Ru=new Tt(H.comparator),this.Au=new Map,this.Vu=new Ws,this.du={},this.mu=new Map,this.fu=Me.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function Ef(n,t,e){const r=If(n);try{const i=await(function(l,u){const p=Q(l),m=J.now(),w=u.reduce(((D,A)=>D.add(A.key)),yt());let T,v;return p.persistence.runTransaction("Locally write mutations","readwrite",(D=>{let A=ur(),V=yt();return p.xs.getEntries(D,w).next((S=>{A=S,A.forEach(((P,R)=>{R.isValidDocument()||(V=V.add(P))}))})).next((()=>p.localDocuments.getOverlayedDocuments(D,A))).next((S=>{T=S;const P=[];for(const R of u){const F=rd(R,T.get(R.key).overlayedDocument);F!=null&&P.push(new ge(R.key,F,Na(F.value.mapValue),Ut.exists(!0)))}return p.mutationQueue.addMutationBatch(D,m,P,u)})).next((S=>{v=S;const P=S.applyToLocalDocumentSet(T,V);return p.documentOverlayCache.saveOverlays(D,S.batchId,P)}))})).then((()=>({batchId:v.batchId,changes:Ga(T)})))})(r.localStore,t);r.sharedClientState.addPendingMutation(i.batchId),(function(l,u,p){let m=l.du[l.currentUser.toKey()];m||(m=new Tt(W)),m=m.insert(u,p),l.du[l.currentUser.toKey()]=m})(r,i.batchId,e),await Ir(r,i.changes),await Tr(r.remoteStore)}catch(i){const o=fl(i,"Failed to persist write");e.reject(o)}}function Ko(n,t,e){const r=Q(n);if(r.isPrimaryClient&&e===0||!r.isPrimaryClient&&e===1){const i=[];r.Tu.forEach(((o,l)=>{const u=l.view.va(t);u.snapshot&&i.push(u.snapshot)})),(function(l,u){const p=Q(l);p.onlineState=u;let m=!1;p.queries.forEach(((w,T)=>{for(const v of T.ba)v.va(u)&&(m=!0)})),m&&yf(p)})(r.eventManager,t),i.length&&r.Pu.J_(i),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function wf(n,t){const e=Q(n),r=t.batch.batchId;try{const i=await Gd(e.localStore,t);ml(e,r,null),pl(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),await Ir(e,i)}catch(i){await Ls(i)}}async function bf(n,t,e){const r=Q(n);try{const i=await(function(l,u){const p=Q(l);return p.persistence.runTransaction("Reject batch","readwrite-primary",(m=>{let w;return p.mutationQueue.lookupMutationBatch(m,u).next((T=>(tt(T!==null,37113),w=T.keys(),p.mutationQueue.removeMutationBatch(m,T)))).next((()=>p.mutationQueue.performConsistencyCheck(m))).next((()=>p.documentOverlayCache.removeOverlaysForBatchId(m,w,u))).next((()=>p.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(m,w))).next((()=>p.localDocuments.getDocuments(m,w)))}))})(r.localStore,t);ml(r,t,e),pl(r,t),r.sharedClientState.updateMutationState(t,"rejected",e),await Ir(r,i)}catch(i){await Ls(i)}}function pl(n,t){(n.mu.get(t)||[]).forEach((e=>{e.resolve()})),n.mu.delete(t)}function ml(n,t,e){const r=Q(n);let i=r.du[r.currentUser.toKey()];if(i){const o=i.get(t);o&&(e?o.reject(e):o.resolve(),i=i.remove(t)),r.du[r.currentUser.toKey()]=i}}async function Ir(n,t,e){const r=Q(n),i=[],o=[],l=[];r.Tu.isEmpty()||(r.Tu.forEach(((u,p)=>{l.push(r.pu(p,t,e).then((m=>{if((m||e)&&r.isPrimaryClient){const w=m?!m.fromCache:e?.targetChanges.get(p.targetId)?.current;r.sharedClientState.updateQueryState(p.targetId,w?"current":"not-current")}if(m){i.push(m);const w=Qs.Es(p.targetId,m);o.push(w)}})))})),await Promise.all(l),r.Pu.J_(i),await(async function(p,m){const w=Q(p);try{await w.persistence.runTransaction("notifyLocalViewChanges","readwrite",(T=>k.forEach(m,(v=>k.forEach(v.Ts,(D=>w.persistence.referenceDelegate.addReference(T,v.targetId,D))).next((()=>k.forEach(v.Is,(D=>w.persistence.referenceDelegate.removeReference(T,v.targetId,D)))))))))}catch(T){if(!bn(T))throw T;B(Hd,"Failed to update sequence numbers: "+T)}for(const T of m){const v=T.targetId;if(!T.fromCache){const D=w.vs.get(v),A=D.snapshotVersion,V=D.withLastLimboFreeSnapshotVersion(A);w.vs=w.vs.insert(v,V)}}})(r.localStore,o))}async function Tf(n,t){const e=Q(n);if(!e.currentUser.isEqual(t)){B(_f,"User change. New user:",t.toKey());const r=await al(e.localStore,t);e.currentUser=t,(function(o,l){o.mu.forEach((u=>{u.forEach((p=>{p.reject(new U(M.CANCELLED,l))}))})),o.mu.clear()})(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await Ir(e,r.Ns)}}function If(n){const t=Q(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=wf.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=bf.bind(null,t),t}class fr{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=wr(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),await this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)}Fu(t,e){return null}Mu(t,e){return null}vu(t){return zd(this.persistence,new jd,t.initialUser,this.serializer)}Cu(t){return new ol(Ks.Vi,this.serializer)}Du(t){return new Qd}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}fr.provider={build:()=>new fr};class xf extends fr{constructor(t){super(),this.cacheSizeBytes=t}Fu(t,e){tt(this.persistence.referenceDelegate instanceof dr,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new Sd(r,t.asyncQueue,e)}Cu(t){const e=this.cacheSizeBytes!==void 0?bt.withCacheSize(this.cacheSizeBytes):bt.DEFAULT;return new ol((r=>dr.Vi(r,e)),this.serializer)}}class bs{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Ko(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=Tf.bind(null,this.syncEngine),await mf(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return(function(){return new gf})()}createDatastore(t){const e=wr(t.databaseInfo.databaseId),r=tf(t.databaseInfo);return of(t.authCredentials,t.appCheckCredentials,r,e)}createRemoteStore(t){return(function(r,i,o,l,u){return new lf(r,i,o,l,u)})(this.localStore,this.datastore,t.asyncQueue,(e=>Ko(this.syncEngine,e,0)),(function(){return jo.v()?new jo:new Yd})())}createSyncEngine(t,e){return(function(i,o,l,u,p,m,w){const T=new vf(i,o,l,u,p,m);return w&&(T.gu=!0),T})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){await(async function(e){const r=Q(e);B(In,"RemoteStore shutting down."),r.Ea.add(5),await xn(r),r.Aa.shutdown(),r.Va.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}bs.provider={build:()=>new bs};const te="FirestoreClient";class Af{constructor(t,e,r,i,o){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=r,this._databaseInfo=i,this.user=gt.UNAUTHENTICATED,this.clientId=Vs.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,(async l=>{B(te,"Received user=",l.uid),await this.authCredentialListener(l),this.user=l})),this.appCheckCredentials.start(r,(l=>(B(te,"Received new app check token=",l),this.appCheckCredentialListener(l,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new ce;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const r=fl(e,"Failed to shutdown persistence");t.reject(r)}})),t.promise}}async function ns(n,t){n.asyncQueue.verifyOperationInProgress(),B(te,"Initializing OfflineComponentProvider");const e=n.configuration;await t.initialize(e);let r=e.initialUser;n.setCredentialChangeListener((async i=>{r.isEqual(i)||(await al(t.localStore,i),r=i)})),t.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=t}async function Qo(n,t){n.asyncQueue.verifyOperationInProgress();const e=await Sf(n);B(te,"Initializing OnlineComponentProvider"),await t.initialize(e,n.configuration),n.setCredentialChangeListener((r=>qo(t.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,i)=>qo(t.remoteStore,i))),n._onlineComponents=t}async function Sf(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){B(te,"Using user provided OfflineComponentProvider");try{await ns(n,n._uninitializedComponentsProvider._offline)}catch(t){const e=t;if(!(function(i){return i.name==="FirebaseError"?i.code===M.FAILED_PRECONDITION||i.code===M.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(e))throw e;yr("Error using user provided cache. Falling back to memory cache: "+e),await ns(n,new fr)}}else B(te,"Using default OfflineComponentProvider"),await ns(n,new xf(void 0));return n._offlineComponents}async function Cf(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(B(te,"Using user provided OnlineComponentProvider"),await Qo(n,n._uninitializedComponentsProvider._online)):(B(te,"Using default OnlineComponentProvider"),await Qo(n,new bs))),n._onlineComponents}function Pf(n){return Cf(n).then((t=>t.syncEngine))}function Rf(n,t){const e=new ce;return n.asyncQueue.enqueueAndForget((async()=>Ef(await Pf(n),t,e))),e.promise}function gl(n){const t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}const kf="ComponentProvider",Yo=new Map;function Df(n,t,e,r,i){return new Th(n,t,e,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,gl(i.experimentalLongPollingOptions),i.useFetchStreams,i.isUsingEmulator,r)}const yl="firestore.googleapis.com",Xo=!0;class Jo{constructor(t){if(t.host===void 0){if(t.ssl!==void 0)throw new U(M.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=yl,this.ssl=Xo}else this.host=t.host,this.ssl=t.ssl??Xo;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=il;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<xd)throw new U(M.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}hh("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=gl(t.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new U(M.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new U(M.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new U(M.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Xs{constructor(t,e,r,i){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Jo({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new U(M.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new U(M.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Jo(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new th;switch(r.type){case"firstParty":return new sh(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new U(M.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(e){const r=Yo.get(e);r&&(B(kf,"Removing Datastore"),Yo.delete(e),r.terminate())})(this),Promise.resolve()}}function Vf(n,t,e,r={}){n=ds(n,Xs);const i=Ps(t),o=n._getSettings(),l={...o,emulatorOptions:n._getEmulatorOptions()},u=`${t}:${e}`;i&&(Ac(`https://${u}`),Rc("Firestore",!0)),o.host!==yl&&o.host!==u&&yr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const p={...o,host:u,ssl:i,emulatorOptions:r};if(!tr(p,l)&&(n._setSettings(p),r.mockUserToken)){let m,w;if(typeof r.mockUserToken=="string")m=r.mockUserToken,w=gt.MOCK_USER;else{m=Sc(r.mockUserToken,n._app?.options.projectId);const T=r.mockUserToken.sub||r.mockUserToken.user_id;if(!T)throw new U(M.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");w=new gt(T)}n._authCredentials=new eh(new Aa(m,w))}}class Js{constructor(t,e,r){this.converter=e,this._query=r,this.type="query",this.firestore=t}withConverter(t){return new Js(this.firestore,t,this._query)}}class _t{constructor(t,e,r){this.converter=e,this._key=r,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new En(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new _t(this.firestore,t,this._key)}toJSON(){return{type:_t._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,r){if(wn(e,_t._jsonSchema))return new _t(t,r||null,new H(et.fromString(e.referencePath)))}}_t._jsonSchemaVersion="firestore/documentReference/1.0",_t._jsonSchema={type:st("string",_t._jsonSchemaVersion),referencePath:st("string")};class En extends Js{constructor(t,e,r){super(t,e,Bh(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new _t(this.firestore,null,new H(t))}withConverter(t){return new En(this.firestore,t,this._path)}}function Mf(n,t,...e){if(n=er(n),arguments.length===1&&(t=Vs.newId()),uh("doc","path",t),n instanceof Xs){const r=et.fromString(t,...e);return Eo(r),new _t(n,null,new H(r))}{if(!(n instanceof _t||n instanceof En))throw new U(M.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(et.fromString(t,...e));return Eo(r),new _t(n.firestore,n instanceof En?n.converter:null,new H(r))}}const Zo="AsyncQueue";class ta{constructor(t=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new ll(this,"async_queue_retry"),this._c=()=>{const r=es();r&&B(Zo,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=t;const e=es();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;const e=es();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise((()=>{}));const e=new ce;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Yu.push(t),this.lc())))}async lc(){if(this.Yu.length!==0){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(t){if(!bn(t))throw t;B(Zo,"Operation failed with retryable error: "+t)}this.Yu.length>0&&this.M_.p_((()=>this.lc()))}}cc(t){const e=this.ac.then((()=>(this.rc=!0,t().catch((r=>{throw this.nc=r,this.rc=!1,de("INTERNAL UNHANDLED ERROR: ",ea(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=e,e}enqueueAfterDelay(t,e,r){this.uc(),this.oc.indexOf(t)>-1&&(e=0);const i=Ys.createAndSchedule(this,t,e,r,(o=>this.hc(o)));return this.tc.push(i),i}uc(){this.nc&&q(47125,{Pc:ea(this.nc)})}verifyOperationInProgress(){}async Tc(){let t;do t=this.ac,await t;while(t!==this.ac)}Ic(t){for(const e of this.tc)if(e.timerId===t)return!0;return!1}Ec(t){return this.Tc().then((()=>{this.tc.sort(((e,r)=>e.targetTimeMs-r.targetTimeMs));for(const e of this.tc)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Tc()}))}Rc(t){this.oc.push(t)}hc(t){const e=this.tc.indexOf(t);this.tc.splice(e,1)}}function ea(n){let t=n.message||"";return n.stack&&(t=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),t}class _l extends Xs{constructor(t,e,r,i){super(t,e,r,i),this.type="firestore",this._queue=new ta,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new ta(t),this._firestoreClient=void 0,await t}}}function Lf(n,t){const e=typeof n=="object"?n:Uu(),r=typeof n=="string"?n:or,i=Lu(e,"firestore").getImmediate({identifier:r});if(!i._initialized){const o=Ic("firestore");o&&Vf(i,...o)}return i}function Nf(n){if(n._terminated)throw new U(M.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Of(n),n._firestoreClient}function Of(n){const t=n._freezeSettings(),e=Df(n._databaseId,n._app?.options.appId||"",n._persistenceKey,n._app?.options.apiKey,t);n._componentsProvider||t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),n._firestoreClient=new Af(n._authCredentials,n._appCheckCredentials,n._queue,e,n._componentsProvider&&(function(i){const o=i?._online.build();return{_offline:i?._offline.build(o),_online:o}})(n._componentsProvider))}class kt{constructor(t){this._byteString=t}static fromBase64String(t){try{return new kt(Ot.fromBase64String(t))}catch(e){throw new U(M.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new kt(Ot.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:kt._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(wn(t,kt._jsonSchema))return kt.fromBase64String(t.bytes)}}kt._jsonSchemaVersion="firestore/bytes/1.0",kt._jsonSchema={type:st("string",kt._jsonSchemaVersion),bytes:st("string")};class vl{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new U(M.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new dt(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class Zs{constructor(t){this._methodName=t}}class $t{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new U(M.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new U(M.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return W(this._lat,t._lat)||W(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:$t._jsonSchemaVersion}}static fromJSON(t){if(wn(t,$t._jsonSchema))return new $t(t.latitude,t.longitude)}}$t._jsonSchemaVersion="firestore/geoPoint/1.0",$t._jsonSchema={type:st("string",$t._jsonSchemaVersion),latitude:st("number"),longitude:st("number")};class Nt{constructor(t){this._values=(t||[]).map((e=>e))}toArray(){return this._values.map((t=>t))}isEqual(t){return(function(r,i){if(r.length!==i.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==i[o])return!1;return!0})(this._values,t._values)}toJSON(){return{type:Nt._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(wn(t,Nt._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every((e=>typeof e=="number")))return new Nt(t.vectorValues);throw new U(M.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Nt._jsonSchemaVersion="firestore/vectorValue/1.0",Nt._jsonSchema={type:st("string",Nt._jsonSchemaVersion),vectorValues:st("object")};const Ff=/^__.*__$/;class Bf{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return this.fieldMask!==null?new ge(t,this.data,this.fieldMask,e,this.fieldTransforms):new Tn(t,this.data,e,this.fieldTransforms)}}function El(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw q(40011,{dataSource:n})}}class ti{constructor(t,e,r,i,o,l){this.settings=t,this.databaseId=e,this.serializer=r,this.ignoreUndefinedProperties=i,o===void 0&&this.validatePath(),this.fieldTransforms=o||[],this.fieldMask=l||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(t){return new ti({...this.settings,...t},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(t){const e=this.path?.child(t),r=this.contextWith({path:e,arrayElement:!1});return r.validatePathSegment(t),r}childContextForFieldPath(t){const e=this.path?.child(t),r=this.contextWith({path:e,arrayElement:!1});return r.validatePath(),r}childContextForArray(t){return this.contextWith({path:void 0,arrayElement:!0})}createError(t){return pr(t,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(t){return this.fieldMask.find((e=>t.isPrefixOf(e)))!==void 0||this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))!==void 0}validatePath(){if(this.path)for(let t=0;t<this.path.length;t++)this.validatePathSegment(this.path.get(t))}validatePathSegment(t){if(t.length===0)throw this.createError("Document fields must not be empty");if(El(this.dataSource)&&Ff.test(t))throw this.createError('Document fields cannot begin and end with "__"')}}class Uf{constructor(t,e,r){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=r||wr(t)}createContext(t,e,r,i=!1){return new ti({dataSource:t,methodName:e,targetDoc:r,path:dt.emptyPath(),arrayElement:!1,hasConverter:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function $f(n){const t=n._freezeSettings(),e=wr(n._databaseId);return new Uf(n._databaseId,!!t.ignoreUndefinedProperties,e)}function jf(n,t,e,r,i,o={}){const l=n.createContext(o.merge||o.mergeFields?2:0,t,e,i);Il("Data must be an object, but it was:",l,r);const u=bl(r,l);let p,m;if(o.merge)p=new Dt(l.fieldMask),m=l.fieldTransforms;else if(o.mergeFields){const w=[];for(const T of o.mergeFields){const v=ni(t,T,e);if(!l.contains(v))throw new U(M.INVALID_ARGUMENT,`Field '${v}' is specified in your field mask but missing from your input data.`);zf(w,v)||w.push(v)}p=new Dt(w),m=l.fieldTransforms.filter((T=>p.covers(T.field)))}else p=null,m=l.fieldTransforms;return new Bf(new Rt(u),p,m)}class ei extends Zs{_toFieldTransform(t){return new Zh(t.path,new yn)}isEqual(t){return t instanceof ei}}function wl(n,t){if(Tl(n=er(n)))return Il("Unsupported field value:",t,n),bl(n,t);if(n instanceof Zs)return(function(r,i){if(!El(i.dataSource))throw i.createError(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.createError(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(i);o&&i.fieldTransforms.push(o)})(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.arrayElement&&t.dataSource!==4)throw t.createError("Nested arrays are not supported");return(function(r,i){const o=[];let l=0;for(const u of r){let p=wl(u,i.childContextForArray(l));p==null&&(p={nullValue:"NULL_VALUE"}),o.push(p),l++}return{arrayValue:{values:o}}})(n,t)}return(function(r,i){if((r=er(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Yh(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=J.fromDate(r);return{timestampValue:_s(i.serializer,o)}}if(r instanceof J){const o=new J(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:_s(i.serializer,o)}}if(r instanceof $t)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof kt)return{bytesValue:ud(i.serializer,r._byteString)};if(r instanceof _t){const o=i.databaseId,l=r.firestore._databaseId;if(!l.isEqual(o))throw i.createError(`Document reference is for database ${l.projectId}/${l.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:nl(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Nt)return(function(l,u){const p=l instanceof Nt?l.toArray():l;return{mapValue:{fields:{[Ma]:{stringValue:La},[fs]:{arrayValue:{values:p.map((w=>{if(typeof w!="number")throw u.createError("VectorValues must only contain numeric values.");return zs(u.serializer,w)}))}}}}}})(r,i);if(sl(r))return r._toProto(i.serializer);throw i.createError(`Unsupported field value: ${Ms(r)}`)})(n,t)}function bl(n,t){const e={};return Pa(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Fe(n,((r,i)=>{const o=wl(i,t.childContextForField(r));o!=null&&(e[r]=o)})),{mapValue:{fields:e}}}function Tl(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof J||n instanceof $t||n instanceof kt||n instanceof _t||n instanceof Zs||n instanceof Nt||sl(n))}function Il(n,t,e){if(!Tl(e)||!Sa(e)){const r=Ms(e);throw r==="an object"?t.createError(n+" a custom object"):t.createError(n+" "+r)}}function ni(n,t,e){if((t=er(t))instanceof vl)return t._internalPath;if(typeof t=="string")return qf(n,t);throw pr("Field path arguments must be of type string or ",n,!1,void 0,e)}const Hf=new RegExp("[~\\*/\\[\\]]");function qf(n,t,e){if(t.search(Hf)>=0)throw pr(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,e);try{return new vl(...t.split("."))._internalPath}catch{throw pr(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,e)}}function pr(n,t,e,r,i){const o=r&&!r.isEmpty(),l=i!==void 0;let u=`Function ${t}() called with invalid data`;e&&(u+=" (via `toFirestore()`)"),u+=". ";let p="";return(o||l)&&(p+=" (found",o&&(p+=` in field ${r}`),l&&(p+=` in document ${i}`),p+=")"),new U(M.INVALID_ARGUMENT,u+n+p)}function zf(n,t){return n.some((e=>e.isEqual(t)))}function Gf(){return new ei("serverTimestamp")}const na="@firebase/firestore",ra="4.10.0";class xl{constructor(t,e,r,i,o){this._firestore=t,this._userDataWriter=e,this._key=r,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new _t(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new Wf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(t){if(this._document){const e=this._document.data.field(ni("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}}class Wf extends xl{data(){return super.data()}}function Kf(n,t,e){let r;return r=n?n.toFirestore(t):t,r}class Gn{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Pe extends xl{constructor(t,e,r,i,o,l){super(t,e,r,i,l),this._firestore=t,this._firestoreImpl=t,this.metadata=o}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Jn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const r=this._document.data.field(ni("DocumentSnapshot.get",t));if(r!==null)return this._userDataWriter.convertValue(r,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new U(M.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t=this._document,e={};return e.type=Pe._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?e:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e)}}Pe._jsonSchemaVersion="firestore/documentSnapshot/1.0",Pe._jsonSchema={type:st("string",Pe._jsonSchemaVersion),bundleSource:st("string","DocumentSnapshot"),bundleName:st("string"),bundle:st("string")};class Jn extends Pe{data(t={}){return super.data(t)}}class dn{constructor(t,e,r,i){this._firestore=t,this._userDataWriter=e,this._snapshot=i,this.metadata=new Gn(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach((r=>{t.call(e,new Jn(this._firestore,this._userDataWriter,r.key,r,new Gn(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new U(M.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=(function(i,o){if(i._snapshot.oldDocs.isEmpty()){let l=0;return i._snapshot.docChanges.map((u=>{const p=new Jn(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Gn(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:p,oldIndex:-1,newIndex:l++}}))}{let l=i._snapshot.oldDocs;return i._snapshot.docChanges.filter((u=>o||u.type!==3)).map((u=>{const p=new Jn(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Gn(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);let m=-1,w=-1;return u.type!==0&&(m=l.indexOf(u.doc.key),l=l.delete(u.doc.key)),u.type!==1&&(l=l.add(u.doc),w=l.indexOf(u.doc.key)),{type:Qf(u.type),doc:p,oldIndex:m,newIndex:w}}))}})(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new U(M.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t={};t.type=dn._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=Vs.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const e=[],r=[],i=[];return this.docs.forEach((o=>{o._document!==null&&(e.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),i.push(o.ref.path))})),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}}function Qf(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return q(61501,{type:n})}}dn._jsonSchemaVersion="firestore/querySnapshot/1.0",dn._jsonSchema={type:st("string",dn._jsonSchemaVersion),bundleSource:st("string","QuerySnapshot"),bundleName:st("string"),bundle:st("string")};function Yf(n,t,e){n=ds(n,_t);const r=ds(n.firestore,_l),i=Kf(n.converter,t),o=$f(r);return Xf(r,[jf(o,"setDoc",n._key,i,n.converter!==null,e).toMutation(n._key,Ut.none())])}function Xf(n,t){const e=Nf(n);return Rf(e,t)}(function(t,e=!0){Zu(Bu),rr(new fn("firestore",((r,{instanceIdentifier:i,options:o})=>{const l=r.getProvider("app").getImmediate(),u=new _l(new nh(r.getProvider("auth-internal")),new ih(l,r.getProvider("app-check-internal")),Ih(l,i),l);return o={useFetchStreams:e,...o},u._setSettings(o),u}),"PUBLIC").setMultipleInstances(!0)),Ae(na,ra,t),Ae(na,ra,"esm2020")})();const Jf={projectId:"destinycode-982fa",appId:"1:168629222416:web:3283f6a4051f57a85c9e95",storageBucket:"destinycode-982fa.firebasestorage.app",apiKey:"AIzaSyA20BvSogSuHTni09Y54HwmlpG7UKXuxk8",authDomain:"destinycode-982fa.firebaseapp.com",messagingSenderId:"168629222416",measurementId:"G-ZKS4RCNFGX"};let rs=null;function Zf(){if(!rs)try{const n=ya(Jf);rs=Lf(n),vt.log("üî• FeedbackService: Firebase initialized.")}catch(n){console.error("Firebase Init Error:",n)}return rs}const Ts={async send(n){const t=Zf();if(!t){console.warn("Feedback skipped: DB not ready");return}const e=C.get("email")||null,r=n.source||"general";let i=sessionStorage.getItem("dc_feedback_session_id");i||(i="sess_"+Math.random().toString(36).substr(2,9)+"_"+Date.now().toString(36),sessionStorage.setItem("dc_feedback_session_id",i));const o=`feedback_${i}_${r}`,l={...n,email:e,timestamp:Gf(),localTime:new Date().toISOString(),userAgent:navigator.userAgent,path:window.location.pathname};try{await Yf(Mf(t,"web_feedback",o),l),vt.log("üìù [Feedback Updated/Saved]:",o,l)}catch(u){console.error("Feedback Save Error:",u)}}};function tp(n){const t=document.getElementById("app");t.classList.add("funnel-container"),t.innerHTML=fc;const e=document.getElementById("result-title"),r=document.getElementById("free-report-title"),i=document.getElementById("free-report-text"),o=document.getElementById("upgrade-button"),l=C.get("freeReport");if(!l){n.navigateTo("welcome");return}let u="";l.psychological_analysis?u=l.psychological_analysis.replace(/\*\*(.*?)\*\*/g,'<strong style="color: var(--primary-text-color);">$1</strong>').replace(/\\n/g,"<br>"):u="<p>–î–∞–Ω—ñ –≤—ñ–¥—Å—É—Ç–Ω—ñ.</p>",e.innerText="–ê–Ω–∞–ª—ñ–∑ —Ç–≤–æ—î—ó –æ—Å–æ–±–∏—Å—Ç–æ—Å—Ç—ñ",r.innerHTML=l.title||"–†–µ–∑—É–ª—å—Ç–∞—Ç",i.innerHTML=u,o.addEventListener("click",()=>{n.navigateTo("premium")}),p();function p(){if(document.querySelector(".feedback-controls"))return;const T=document.createElement("div");T.className="feedback-controls";const v=document.createElement("div");v.className="feedback-buttons";const D=m("üëç","like"),A=m("üëé","dislike");v.appendChild(A),v.appendChild(D),T.appendChild(v),i&&i.parentNode?i.after(T):console.warn("Feedback System: Could not find insertion point (freeReportTextEl)")}function m(T,v){const D=document.createElement("div");return D.className="btn-feedback-icon",D.innerText=T,D.onclick=async()=>{D.parentElement.querySelectorAll(".btn-feedback-icon").forEach(V=>V.classList.remove("active")),D.classList.add("active"),await Ts.send({type:v,value:v,source:"free_report"}),w("–î—è–∫—É—é! üíú")},D}function w(T){const v=document.createElement("div");v.innerText=T,v.style.position="fixed",v.style.top="20px",v.style.left="50%",v.style.transform="translate(-50%, -20px)",v.style.background="linear-gradient(135deg, #0f1115 0%, #1a1c23 100%)",v.style.color="#fff",v.style.border="1px solid rgba(205, 164, 94, 0.3)",v.style.boxShadow="0 10px 25px -5px rgba(0, 0, 0, 0.8), 0 0 15px -3px rgba(205, 164, 94, 0.1)",v.style.padding="12px 24px",v.style.borderRadius="99px",v.style.fontWeight="bold",v.style.opacity="0",v.style.transition="all 0.3s ease",v.style.zIndex="2000",document.body.appendChild(v),requestAnimationFrame(()=>{v.style.opacity="1",v.style.transform="translate(-50%, 0)"}),setTimeout(()=>{v.style.opacity="0",v.style.transform="translate(-50%, -20px)",setTimeout(()=>document.body.removeChild(v),300)},900)}}const ep=`<section id="premium-data-step" class="funnel-step active space-y-5 text-center">
    
    <div class="space-y-2">
        <h2 class="text-2xl font-bold text-white tracking-tight">
            –û—Ç—Ä–∏–º–∞–π –ø–æ–≤–Ω–∏–π –∞–Ω–∞–ª—ñ–∑
        </h2>
        <p class="text-sm" style="color: var(--secondary-text-color);">
            –í–≤–µ–¥–∏ —Ç–æ—á–Ω—ñ –¥–∞–Ω—ñ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è –¥–ª—è –ø–æ–≤–Ω–æ–≥–æ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –≤—Å—ñ—Ö —Å—Ñ–µ—Ä —Å–≤–æ–≥–æ –∂–∏—Ç—Ç—è:
        </p>
    </div>

    <div id="premium-form-container" class="w-full space-y-5 mt-4">
        <!-- Time Input -->
        <div>
            <label for="birth-time" class="block text-xs uppercase tracking-widest font-semibold text-left ml-1 mb-2" style="color: var(--accent-color);">–ß–∞—Å –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è</label>
            
            <div class="input-field h-14 flex items-center justify-center relative hover:border-[#cda45e] transition-colors">
                <svg class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2" style="color: var(--secondary-text-color);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                
                <span id="time-placeholder" style="color: var(--secondary-text-color); pointer-events: none;">–û–±–µ—Ä–∏ —á–∞—Å</span>
                <input type="time" id="birth-time" name="birth-time" class="absolute top-0 left-0 w-full h-full opacity-0 cursor-pointer z-10">
            </div>
            
            <p id="time-error-message" class="error-text" style="display: none;">
                –ë—É–¥—å –ª–∞—Å–∫–∞, –æ–±–µ—Ä–∏ —á–∞—Å –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è.
            </p>
        </div>

        <!-- City Input -->
        <div>
            <label for="birth-city" class="block text-xs uppercase tracking-widest font-semibold text-left ml-1 mb-2" style="color: var(--accent-color);">–ú—ñ—Å—Ç–æ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è</label>
            
            <input 
                type="text" 
                id="birth-city" 
                name="birth-city" 
                placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –ö–∏—ó–≤" 
                class="input-field text-center hover:border-[#cda45e] transition-colors w-full"
                style="color: #ffffff !important; -webkit-text-fill-color: #ffffff !important; background-color: var(--card-bg-color) !important; opacity: 1;"
            >
            
            <style>
                #birth-city {
                    color: #ffffff !important;
                    -webkit-text-fill-color: #ffffff !important;
                    caret-color: var(--accent-color);
                }
                #birth-city:-webkit-autofill,
                #birth-city:-webkit-autofill:hover, 
                #birth-city:-webkit-autofill:focus, 
                #birth-city:-webkit-autofill:active {
                    -webkit-box-shadow: 0 0 0 30px var(--card-bg-color) inset !important;
                    -webkit-text-fill-color: #ffffff !important;
                    transition: background-color 5000s ease-in-out 0s;
                }
                #birth-city::placeholder {
                    color: var(--secondary-text-color);
                    opacity: 0.7;
                    transition: opacity 0.2s ease;
                    -webkit-text-fill-color: var(--secondary-text-color) !important;
                }
                #birth-city:focus::placeholder { opacity: 0; color: transparent; -webkit-text-fill-color: transparent !important; }
            </style>

            <p id="city-error-message" class="error-text">–¢–µ–∫—Å—Ç –ø–æ–º–∏–ª–∫–∏...</p>
            <p id="city-info-message" class="info-text"></p>
        </div>

        <!-- üî• NEW LOCATION: Value Proposition List (Clean, No Border) -->
        <!-- –¶–µ–π –±–ª–æ–∫ —Ç–µ–ø–µ—Ä —Ç—É—Ç: –ø—ñ–¥ –ø–æ–ª—è–º–∏, –Ω–∞–¥ –∫–Ω–æ–ø–∫–æ—é. –ë–µ–∑ —Ñ–æ–Ω—É —ñ —Ä–∞–º–æ–∫. -->
        <div class="text-left mx-auto max-w-[340px] pt-2 pb-1">
            <p class="text-[10px] text-center mb-3 uppercase tracking-widest opacity-50" style="color: var(--secondary-text-color);">–©–æ –±—É–¥–µ —Ä–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω–æ:</p>
            <ul class="space-y-2 text-sm pl-2">
                <li class="flex items-center gap-3">
                    <span class="text-lg min-w-[24px] text-center">üé≠</span>
                    <span style="color: var(--primary-text-color);"><strong>–Ø–¥—Ä–æ –û—Å–æ–±–∏—Å—Ç–æ—Å—Ç—ñ</strong> (–•–∞—Ä–∞–∫—Ç–µ—Ä)</span>
                </li>
                <li class="flex items-center gap-3">
                    <span class="text-lg min-w-[24px] text-center">‚ù§Ô∏è‚Äçüî•</span>
                    <span style="color: var(--primary-text-color);"><strong>–ö–æ–¥ –ö–æ—Ö–∞–Ω–Ω—è</strong> (–°—É–º—ñ—Å–Ω—ñ—Å—Ç—å)</span>
                </li>
                <li class="flex items-center gap-3">
                    <span class="text-lg min-w-[24px] text-center">üí∏</span>
                    <span style="color: var(--primary-text-color);"><strong>–ì—Ä–æ—à–æ–≤–∏–π –ü–æ—Ç—ñ–∫</strong> (–ö–∞—Ä'—î—Ä–∞)</span>
                </li>
                <li class="flex items-center gap-3">
                    <span class="text-lg min-w-[24px] text-center">üîÆ</span>
                    <span style="color: var(--primary-text-color);"><strong>–ö–∞—Ä–º—ñ—á–Ω—ñ –£—Ä–æ–∫–∏</strong> (–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è)</span>
                </li>
                <li class="flex items-center gap-3">
                    <span class="text-lg min-w-[24px] text-center">‚ö°Ô∏è</span>
                    <span style="color: var(--primary-text-color);"><strong>–ú–∞–π–±—É—Ç–Ω—î</strong> (–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏–π –ø—Ä–æ–≥–Ω–æ–∑)</span>
                </li>
            </ul>
        </div>

        <div class="pt-2 space-y-3">
            <!-- –ö–Ω–æ–ø–∫–∞ –±–µ–∑ —Ü—ñ–Ω–∏, —è–∫ –ø—Ä–æ—Å–∏–ª–∏ -->
            <button type="button" id="continue-to-paywall-button" class="btn btn-primary !text-lg !py-4 shadow-xl">
                <span class="btn-text">–û—Ç—Ä–∏–º–∞—Ç–∏ –¥–µ—Ç–∞–ª—å–Ω–∏–π –∞–Ω–∞–ª—ñ–∑</span>
                <span class="btn-spinner"></span>
            </button>
            
            <button type="button" id="skip-button" class="btn btn-skip opacity-80 text-xs">
                –Ø –Ω–µ –∑–Ω–∞—é —á–∞—Å—É (–†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ –ö–æ—Å–º–æ–≥—Ä–∞–º—É –±–µ–∑ –î–æ–º—ñ–≤)
            </button>
        </div>
    </div>
</section>`,np=At.PROXY,rp=ss.MODEL_NAME;async function sp(n){try{const e=(await Le(np,{action:"geo",data:{query:n},modelName:rp})).candidates?.[0]?.content?.parts?.[0]?.text;if(e){const r=e.replace(/```json\n?([\s\S]*?)\n?```/g,"$1").trim();return JSON.parse(r)}return{error:"parse_error"}}catch(t){return console.error("Geo API Network Error:",t),{error:"network_failure"}}}async function sa(n){const t=await sp(n);return t&&(typeof t.lat=="number"||typeof t.latitude=="number")?(console.log(`Geocoding success for ${n}:`,t),{latitude:t.latitude||t.lat,longitude:t.longitude||t.lon,timezone:t.timezone,corrected_name:t.corrected_name,error:null}):t&&t.error?{error:t.error}:{error:"parse_error"}}function ip(n){const t=document.getElementById("app");t.classList.add("funnel-container"),t.innerHTML=ep;const e=document.getElementById("birth-time"),r=document.getElementById("time-placeholder"),i=e.closest(".input-field"),o=document.getElementById("time-error-message"),l=document.getElementById("birth-city"),u=document.getElementById("city-error-message"),p=document.getElementById("city-info-message"),m=document.getElementById("continue-to-paywall-button"),w=document.getElementById("skip-button");function T(){!e||!r||(e.value?(r.innerText=e.value,r.style.color="var(--primary-text-color)",i&&i.classList.remove("input-error"),o&&(o.style.display="none")):(r.innerText="–û–±–µ—Ä–∏ —á–∞—Å",r.style.color="var(--secondary-text-color)"))}e.addEventListener("input",T),e.addEventListener("change",T),e.addEventListener("blur",T),T(),l.addEventListener("input",()=>{u.style.display="none",p.style.display="none",l.classList.remove("input-error")});function v(A,V){A&&(V?(A.classList.add("loading"),A.disabled=!0):(A.classList.remove("loading"),A.disabled=!1))}function D(A,V){A==="ambiguous"?u.innerText=`–ú—ñ—Å—Ç–æ "${V}" –∑–Ω–∞–π–¥–µ–Ω–æ –≤ –∫—ñ–ª—å–∫–æ—Ö –º—ñ—Å—Ü—è—Ö. –ë—É–¥—å –ª–∞—Å–∫–∞, —É—Ç–æ—á–Ω–∏, –¥–æ–¥–∞–≤—à–∏ –∫—Ä–∞—ó–Ω—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: ${V}, –£–∫—Ä–∞—ó–Ω–∞).`:u.innerText=`–ù–µ –º–æ–∂–µ–º–æ –∑–Ω–∞–π—Ç–∏ –º—ñ—Å—Ç–æ "${V}". –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞–∑–≤—É.`,u.style.display="block",l.classList.add("input-error")}m.addEventListener("click",async()=>{const A=e.value;let V=l.value.trim();const S=V;let P=!1;if(u.style.display="none",o.style.display="none",i.classList.remove("input-error"),l.classList.remove("input-error"),V||(l.classList.add("input-error"),u.innerText="–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥–∏ –º—ñ—Å—Ç–æ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è.",u.style.display="block",P=!0),A||(i.classList.add("input-error"),o.style.display="block",P=!0),!V&&P){navigator.vibrate&&navigator.vibrate(50);return}v(m,!0);const R=await sa(V);let F=null;if(R&&R.latitude?(R.corrected_name&&(l.value=R.corrected_name,V=R.corrected_name,S.toLowerCase()!==R.corrected_name.toLowerCase()&&(F=`–ú–∏ —É—Ç–æ—á–Ω–∏–ª–∏: ${R.corrected_name} üòâ`)),C.set("geo",{latitude:R.latitude||R.lat,longitude:R.longitude||R.lon,timezone:R.timezone}),C.set("city",R.corrected_name)):R&&R.error==="ambiguous"?(D("ambiguous",V),P=!0):(D("not_found",V),P=!0),F?(p.innerText=F,p.style.display="block"):p.style.display="none",P){v(m,!1),navigator.vibrate&&navigator.vibrate(50);return}C.set("time",A);const O={date:C.get("date"),time:A,city:C.get("city"),geo:C.get("geo")};C.set("userData",O),setTimeout(()=>{n.navigateTo("paywall")},F?1200:0)}),w.addEventListener("click",async()=>{let A=l.value.trim();const V=A;if(u.style.display="none",o.style.display="none",l.classList.remove("input-error"),i.classList.remove("input-error"),!A){l.classList.add("input-error"),u.innerText="–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥–∏ –º—ñ—Å—Ç–æ, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –Ω–µ –∑–Ω–∞—î—à —á–∞—Å—É.",u.style.display="block",navigator.vibrate&&navigator.vibrate(50);return}v(m,!0),w.disabled=!0;const S=await sa(A);let P=null,R=!1;if(S&&S.latitude?(S.corrected_name&&(l.value=S.corrected_name,A=S.corrected_name,V.toLowerCase()!==S.corrected_name.toLowerCase()&&(P=`–ú–∏ —É—Ç–æ—á–Ω–∏–ª–∏: ${S.corrected_name} üòâ`)),C.set("geo",{latitude:S.latitude||S.lat,longitude:S.longitude||S.lon,timezone:S.timezone}),C.set("city",S.corrected_name),C.set("time","")):S&&S.error==="ambiguous"?(D("ambiguous",A),R=!0):(D("not_found",A),R=!0),P&&(p.innerText=P,p.style.display="block"),R){v(m,!1),w.disabled=!1,navigator.vibrate&&navigator.vibrate(50);return}console.log("User skipped time, but city is valid.");const F={date:C.get("date"),time:"",city:C.get("city"),geo:C.get("geo")};C.set("userData",F),setTimeout(()=>{n.navigateTo("paywall")},P?1200:0)})}const op=`<!-- üî• UPDATE: –î–æ–¥–∞–Ω–æ padding-bottom: 140px, —â–æ–± –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—Ç–∏ –∫–æ–º–ø–∞–∫—Ç–Ω—ñ—à–æ–º—É —Ñ—É—Ç–µ—Ä—É -->
<section id="final-paywall-step" class="funnel-step active space-y-6" style="padding-bottom: 140px;">

    <div class="text-center space-y-2">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <h2 class="text-2xl font-bold text-white leading-tight">–î–µ—Ç–∞–ª—å–Ω–∏–π –ø–æ—Ä—Ç—Ä–µ—Ç —Ç–≤–æ—î—ó –æ—Å–æ–±–∏—Å—Ç–æ—Å—Ç—ñ –≥–æ—Ç–æ–≤–∏–π</h2>

        <!-- –¢–∞–π–º–µ—Ä -->
        <div class="flex flex-col items-center justify-center bg-green-900/20 border border-green-500/30 rounded-lg py-1 px-4 w-full max-w-[180px] mx-auto backdrop-blur-sm mt-3">
            <span class="text-[8px] uppercase tracking-[1.5px] text-green-400/80 mb-0 font-bold">–î–æ—Å—Ç—É–ø–Ω–æ –ª–∏—à–µ</span>
            <div class="flex items-baseline gap-1">
                <span id="paywall-timer" class="text-3xl font-bold font-mono text-green-400 tracking-widest drop-shadow-sm leading-none mt-1">07:00</span>
                <span class="text-[10px] text-green-400/70">—Ö–≤</span>
            </div>
        </div>
    </div>

    <!-- –ë–ª–æ–∫ –î–æ–≤—ñ—Ä–∏ (–ö–æ—Å–º—ñ—á–Ω–∏–π –í—ñ–¥–±–∏—Ç–æ–∫) -->
    <div class="space-y-1 relative"> 
        <!-- –°—Ç–∞—Ç–∏—á–Ω–∏–π –±–ª–æ–∫ (–ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä) -->
        <div class="astro-data-box static-placeholder" style="margin: 0; padding: 0.75rem 1rem; background-color: rgba(255, 255, 255, 0.02); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 0.75rem; text-align: center;">
            <div class="text-xs font-normal tracking-wide" style="color: #9ca3af;">
                ‚òÖ –¢–≤–æ—è –∫–∞—Ä—Ç–∞ —É—Å–ø—ñ—à–Ω–æ —Ä–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω–∞ ‚òÖ
            </div>
        </div>

        <!-- === –î–ò–ù–ê–ú–Ü–ß–ù–ò–ô –ë–õ–û–ö "–ö–û–°–ú–Ü–ß–ù–ò–ô –í–Ü–î–ë–ò–¢–û–ö" === -->
        <!-- üî• UPDATE: –ö–ª–∞—Å interactive-astro-box –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –¥–ª—è hover –µ—Ñ–µ–∫—Ç—ñ–≤ -->
        <div id="paywall-astro-data" class="interactive-astro-box" style="display: none;"></div>
    </div>

    <!-- –û–ø–∏—Å -->
    <p class="text-sm sm:text-base text-center leading-relaxed" style="color: #d1d5db;">
        –ú–∏ –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–≤–∞–ª–∏ —Ä—É—Ö –ø–ª–∞–Ω–µ—Ç –≤ –º–æ–º–µ–Ω—Ç —Ç–≤–æ–≥–æ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è.<br>
        <strong class="text-white">–†–æ–∑–±–ª–æ–∫—É–π</strong> —Å–≤–æ—é –ø–æ–≤–Ω—É –Ω–∞—Ç–∞–ª—å–Ω—É –∫–∞—Ä—Ç—É —â–æ–± –¥—ñ–∑–Ω–∞—Ç–∏—Å—è –ø–æ–¥—Ä–æ–±–∏—Ü—ñ –≤—Å—ñ—Ö —Å—Ñ–µ—Ä —Å–≤–æ–≥–æ –∂–∏—Ç—Ç—è (5+ —Å—Ç–æ—Ä—ñ–Ω–æ–∫).
    </p>

    <!-- RICH LIST (–°–ø–∏—Å–æ–∫ –í–∏–≥–æ–¥) -->
    <div class="space-y-3 pt-2">
        <div class="paywall-item" onclick="showPaywallPopup('–Ø–¥—Ä–æ –û—Å–æ–±–∏—Å—Ç–æ—Å—Ç—ñ', '–î—ñ–∑–Ω–∞–π—Å—è, —â–æ –≥–æ–≤–æ—Ä—è—Ç—å –ø—Ä–æ —Ç–µ–±–µ –∑—ñ—Ä–∫–∏. –¢–≤—ñ–π —ñ—Å—Ç–∏–Ω–Ω–∏–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä, —Å–∏–ª—å–Ω—ñ —Å—Ç–æ—Ä–æ–Ω–∏ —Ç–∞ –ø—Ä–∏—Ö–æ–≤–∞–Ω—ñ —Ç–∞–ª–∞–Ω—Ç–∏.')">
            <span class="paywall-icon">üé≠</span>
            <div>
                <span class="block font-bold text-white text-[15px]">–Ø–¥—Ä–æ –û—Å–æ–±–∏—Å—Ç–æ—Å—Ç—ñ</span>
                <span class="text-xs text-gray-400">–Ø–∫ —Ç–µ–±–µ –±–∞—á–∞—Ç—å –ª—é–¥–∏ —ñ —è–∫–∞ —Ç–∏ –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ.</span>
            </div>
        </div>
        <div class="paywall-item" onclick="showPaywallPopup('–ö–æ–¥ –¢–≤–æ–≥–æ –ö–æ—Ö–∞–Ω–Ω—è', '–ß–æ–º—É –Ω–µ —â–∞—Å—Ç–∏—Ç—å —É –∫–æ—Ö–∞–Ω–Ω—ñ? –Ø–∫–∏–π –ø–∞—Ä—Ç–Ω–µ—Ä —Ç–æ–±—ñ —Å–ø—Ä–∞–≤–¥—ñ –ø–æ—Ç—Ä—ñ–±–µ–Ω? –†–æ–∑–∫—Ä–∏–π —Å–µ–∫—Ä–µ—Ç–∏ —Å–≤–æ—î—ó –í–µ–Ω–µ—Ä–∏.')">
            <span class="paywall-icon">‚ù§Ô∏è‚Äçüî•</span>
            <div>
                <span class="block font-bold text-white text-[15px]">–ö–æ–¥ –¢–≤–æ–≥–æ –ö–æ—Ö–∞–Ω–Ω—è</span>
                <span class="text-xs text-gray-400">–¢–∏–ø–∞–∂ —ñ–¥–µ–∞–ª—å–Ω–æ–≥–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ —Ç–∞ –ø—Ä–∏—á–∏–Ω–∏ –Ω–µ–≤–¥–∞—á.</span>
            </div>
        </div>
        <div class="paywall-item" onclick="showPaywallPopup('–ì—Ä–æ—à–æ–≤–∏–π –ü–æ—Ç—ñ–∫', '–î–µ —Ç–≤–æ—ó –≤–µ–ª–∏–∫—ñ –≥—Ä–æ—à—ñ? –Ø–∫–∞ –ø—Ä–æ—Ñ–µ—Å—ñ—è –ø—Ä–∏–Ω–µ—Å–µ —Ç–æ–±—ñ –±–∞–≥–∞—Ç—Å—Ç–≤–æ —Ç–∞ —É—Å–ø—ñ—Ö? –ê—Å—Ç—Ä–æ–ª–æ–≥—ñ—á–Ω–∏–π –∫–ª—é—á –¥–æ —Ñ—ñ–Ω–∞–Ω—Å—ñ–≤.')">
            <span class="paywall-icon">üí∏</span>
            <div>
                <span class="block font-bold text-white text-[15px]">–ì—Ä–æ—à–æ–≤–∏–π –ü–æ—Ç—ñ–∫</span>
                <span class="text-xs text-gray-400">–¢–≤–æ—ó –ø—Ä–∏—Ö–æ–≤–∞–Ω—ñ —Ç–∞–ª–∞–Ω—Ç–∏ —â–æ –ø—Ä–∏–Ω–æ—Å—è—Ç—å –≥—Ä–æ—à—ñ.</span>
            </div>
        </div>
        <div class="paywall-item" onclick="showPaywallPopup('–ö–∞—Ä–º—ñ—á–Ω—ñ –£—Ä–æ–∫–∏', '–î–ª—è —á–æ–≥–æ —Ç–≤–æ—è –¥—É—à–∞ –ø—Ä–∏–π—à–ª–∞ –≤ —Ü–µ–π —Å–≤—ñ—Ç? –Ø–∫—ñ —É—Ä–æ–∫–∏ —Ç–æ–±—ñ —Ç—Ä–µ–±–∞ –ø—Ä–æ–π—Ç–∏, —â–æ–± —Å—Ç–∞—Ç–∏ —â–∞—Å–ª–∏–≤–æ—é?')">
            <span class="paywall-icon">üîÆ</span>
            <div>
                <span class="block font-bold text-white text-[15px]">–ö–∞—Ä–º—ñ—á–Ω—ñ –£—Ä–æ–∫–∏ —Ç–∞ –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è</span>
                <span class="text-xs text-gray-400">–î–ª—è —á–æ–≥–æ —Ç–≤–æ—è –¥—É—à–∞ –ø—Ä–∏–π—à–ª–∞ –≤ —Ü–µ–π —Å–≤—ñ—Ç.</span>
            </div>
        </div>
        <div class="paywall-item" onclick="showPaywallPopup('–ú–∞–π–±—É—Ç–Ω—ñ –ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ', '–©–æ –≥–æ—Ç—É—é—Ç—å —Ç–æ–±—ñ –∑—ñ—Ä–∫–∏? –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏–π –∞—Å—Ç—Ä–æ–ª–æ–≥—ñ—á–Ω–∏–π –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ –Ω–∞–π–±–ª–∏–∂—á–∏–π —á–∞—Å.')">
            <span class="paywall-icon">‚ö°Ô∏è</span>
            <div>
                <span class="block font-bold text-white text-[15px]">–¢–≤–æ—ó –ú–∞–π–±—É—Ç–Ω—ñ –ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ</span>
                <span class="text-xs text-gray-400">–ê—Å—Ç—Ä–æ–ª–æ–≥—ñ—á–Ω–∏–π –∫–ª—ñ–º–∞—Ç: —è–∫ –¥—ñ—è—Ç–∏ —Å–∞–º–µ –∑–∞—Ä–∞–∑ –¥–ª—è —É—Å–ø—ñ—Ö—É.</span>
            </div>
        </div>
    </div>

    <!-- üî• STICKY FOOTER BUTTON (COMPACT VERSION) üî• -->
    <div class="sticky-paywall-footer" style="padding-top: 1rem; padding-bottom: calc(1rem + env(safe-area-inset-bottom));">
        <button id="final-checkout-button" class="btn btn-primary w-full !py-4 btn-pulse-glow shadow-2xl relative overflow-hidden px-1">
            <span class="btn-text flex flex-col items-center justify-center gap-0 w-full tracking-tighter">
                <span class="flex items-center gap-2">
                    <span class="whitespace-nowrap text-[18px] xs:text-[21px] sm:text-[24px] font-bold leading-none">
                        –†–æ–∑–±–ª–æ–∫—É–≤–∞—Ç–∏ –∑–∞—Ä–∞–∑ –∑–∞ 149 –≥—Ä–Ω
                    </span>
                    <span class="whitespace-nowrap text-sm xs:text-base font-normal opacity-60 line-through decoration-white/50 leading-none">
                        799 –≥—Ä–Ω
                    </span>
                </span>
                <span class="text-[10px] uppercase tracking-[1px] opacity-90 mt-1">–û–¥–Ω–æ—Ä–∞–∑–æ–≤–∏–π –ø–ª–∞—Ç—ñ–∂ ‚Ä¢ –î–æ–≤—ñ—á–Ω–∏–π –¥–æ—Å—Ç—É–ø</span>
            </span>
            <span class="btn-spinner"></span>
        </button>

        <!-- Footer Text -->
        <div class="mt-2 flex items-center justify-center opacity-70">
            <span class="text-[10px] text-gray-400 uppercase tracking-wider font-semibold">
                üîí –ë–µ–∑–ø–µ—á–Ω–∞ –æ–ø–ª–∞—Ç–∞ SSL | APPLE PAY / GOOGLE PAY
            </span>
        </div>
    </div>

    <!-- Popup Modal -->
    <div id="paywall-popup" class="modal-overlay">
        <!-- üî• UPDATE: Added relative positioning for close icon -->
        <div class="modal-content relative" style="border-top: 4px solid #cda45e;">
            
            <!-- üî• NEW: –•—Ä–µ—Å—Ç–∏–∫ –∑–∞–∫—Ä–∏—Ç—Ç—è (–≤–µ—Ä—Ö–Ω—ñ–π –ø—Ä–∞–≤–∏–π –∫—É—Ç) -->
            <span id="popup-close-icon" class="absolute top-2 right-4 text-gray-400 hover:text-white cursor-pointer text-3xl font-light transition-colors leading-none" style="z-index: 10;">&times;</span>

            <h3 id="popup-title" class="text-xl font-bold text-white mb-4 leading-tight pr-6" style="color: #cda45e;"></h3>
            
            <div id="popup-text" class="text-left" style="color: var(--secondary-text-color); font-size: 0.95rem; margin-bottom: 2rem; line-height: 1.6;"></div>

            <button id="popup-checkout-btn" class="btn btn-primary w-full !py-4 shadow-xl">
                <span class="btn-text flex flex-col items-center justify-center gap-0 w-full tracking-tighter">
                    <span class="flex items-center gap-2">
                        <span class="whitespace-nowrap text-[16px] font-bold leading-none">
                            –†–æ–∑–±–ª–æ–∫—É–≤–∞—Ç–∏ –∑–∞—Ä–∞–∑ –∑–∞ 149 –≥—Ä–Ω
                        </span>
                    </span>
                </span>
            </button>

            <button id="popup-close-btn" class="btn btn-skip mt-3" style="font-size: 0.8rem; opacity: 0.7;">
                –ó–∞–∫—Ä–∏—Ç–∏
            </button>
        </div>
    </div>

    <style>
        /* –°—Ç–∏–ª—ñ –¥–ª—è —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –±–ª–æ–∫—É */
        .interactive-astro-box {
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .interactive-astro-box:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(205, 164, 94, 0.15);
            border-color: rgba(205, 164, 94, 0.5) !important;
        }

        /* üî• NEW: –ê–Ω—ñ–º–∞—Ü—ñ—è –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫—É –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –±–æ–∫—Å—É */
        /* –¶–µ–π –∫–ª–∞—Å –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è JS-–æ–º –≤ astro-renderer.js, –º–∏ —Å—Ç–∏–ª—ñ–∑—É—î–º–æ –π–æ–≥–æ —Ç—É—Ç */
        .interactive-astro-box .astro-data-title {
            animation: title-pulse 2s infinite ease-in-out;
            text-shadow: 0 0 5px rgba(205, 164, 94, 0.3);
        }

        @keyframes title-pulse {
            0%, 100% { opacity: 0.8; text-shadow: 0 0 0 rgba(205, 164, 94, 0); }
            50% { opacity: 1; text-shadow: 0 0 10px rgba(205, 164, 94, 0.6); transform: scale(1.02); }
        }

        .text-accent {
            color: var(--accent-color);
        }
        
        /* –°—Ç–∏–ª—ñ–∑–∞—Ü—ñ—è –∫–æ–Ω—Ç–µ–Ω—Ç—É –≤ –ø–æ–ø–∞–ø—ñ */
        #popup-text strong {
            color: white;
            font-weight: 600;
        }
        #popup-text ul {
            list-style-type: none;
            padding-left: 0;
            margin-top: 10px;
        }
        #popup-text li {
            position: relative;
            padding-left: 20px;
            margin-bottom: 8px;
        }
        #popup-text li::before {
            content: "‚Ä¢";
            color: var(--accent-color);
            position: absolute;
            left: 0;
            font-weight: bold;
        }
    </style>
</section>`;async function Is(n){if(await xs(),!window.CircularNatalHoroscope)return`
            <div class="astro-data-box" style="border-color: #d29922; background: rgba(210, 153, 34, 0.1);">
                <p class="text-xs text-yellow-400 text-center pulse-text">
                    ‚è≥ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∞—Å—Ç—Ä–æ-–¥–∞–Ω–∏—Ö...<br>
                    (–°–ø—Ä–æ–±—É–π—Ç–µ –∑–∞—á–µ–∫–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ —Å–µ–∫—É–Ω–¥)
                </p>
            </div>
        `;const{Origin:t,Horoscope:e,Renderer:r}=window.CircularNatalHoroscope;let i=n.geo;if(i||(i={latitude:50.45,longitude:30.52,timezone:"Europe/Kyiv"}),!n.date)return"";try{let A=function(R,F){let O=D[R];if(!O&&R==="ascendant"&&(O=v.Ascendant),!O&&R==="midheaven"&&(O=v.Midheaven),O){const $=O.Sign.label,L=O.ChartPosition.Ecliptic.DecimalDegrees%30,E=Math.floor(L),h=(L-E)*60,d=Math.floor(h),y=Math.round((h-d)*60);return`
                    <div class="astro-data-item">
                        <div class="astro-label-row">
                            <span class="astro-planet-name">${F}:</span>
                             <span class="astro-sign-name">${$}</span>
                        </div>
                        <div class="astro-coords-row">${E}¬∞ ${d}' ${y}"</div>
                    </div>
                `}return`<div class="astro-data-item"><strong>${F}:</strong> n/a</div>`};const o=n.date.split("-"),l=parseInt(o[0]),u=parseInt(o[1])-1,p=parseInt(o[2]);let m=12,w=0;if(n.time){const R=n.time.split(":");m=parseInt(R[0]),w=parseInt(R[1])}const T=new t({year:l,month:u,date:p,hour:m,minute:w,latitude:parseFloat(i.latitude),longitude:parseFloat(i.longitude),timezone:i.timezone}),v=new e({origin:T,houseSystem:"placidus",zodiac:"tropical"}),D=v.CelestialBodies,V=[];V.push(A("sun","–°–æ–Ω—Ü–µ")),V.push(A("moon","–ú—ñ—Å—è—Ü—å")),V.push(A("ascendant","ASC")),V.push(A("venus","–í–µ–Ω–µ—Ä–∞")),V.push(A("mars","–ú–∞—Ä—Å")),V.push(A("jupiter","–Æ–ø—ñ—Ç–µ—Ä"));let S="";const P=document.createElement("div");P.style.position="absolute",P.style.left="-9999px",P.style.width="600px",P.style.height="600px",document.body.appendChild(P);try{new r(v).render(P);const F=P.querySelector("svg");F&&(F.style.backgroundColor="transparent",F.querySelectorAll("line, circle, path").forEach(L=>{const E=L.getAttribute("stroke");(!E||E==="#000000"||E==="#000"||E==="black")&&(L.setAttribute("stroke","#cda45e"),L.setAttribute("stroke-width","1.5"))}),F.querySelectorAll("text").forEach(L=>{L.setAttribute("fill","#cda45e"),L.style.fill="#cda45e",L.style.fontFamily="'Montserrat', sans-serif",L.style.fontWeight="500"}),S=`
                    <div class="astro-chart-preview">
                        ${P.innerHTML}
                    </div>
                `)}catch(R){console.warn("Chart Render Error:",R)}return document.body.removeChild(P),`
            <div class="astro-data-box">
                <div class="astro-data-title">–¢–≤—ñ–π –ö–æ—Å–º—ñ—á–Ω–∏–π –í—ñ–¥–±–∏—Ç–æ–∫</div>
                ${S} 
                <div class="astro-data-grid">
                    ${V.join("")}
                </div>
            </div>
        `}catch(o){return console.error("Fingerprint render error:",o),`<div class="astro-data-box"><p class="text-xs text-red-400 text-center">–ü–æ–º–∏–ª–∫–∞ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É: ${o.message}</p></div>`}}async function ri(n,t,e,r={}){vt.log(`üí≥ Starting Payment: ${n.name} (${n.price} UAH)`);try{const i={amount:n.price,productName:n.name,userEmail:t.email,userName:t.name||"Client",userData:e,origin:window.location.origin,returnQueryParams:r.returnQueryParams||""},o=await Le(At.endpoints.PAYMENT_INIT,i);if(o&&o.pageUrl){C.set("pendingInvoiceId",o.invoiceId),vt.log("üöÄ Redirecting to Monobank (Deep Link Mode)...");const l=document.createElement("a");l.href=o.pageUrl,l.target="_top",l.rel="noopener noreferrer",document.body.appendChild(l),l.click(),setTimeout(()=>{document.body.removeChild(l)},100)}else throw console.error("‚ùå Invalid Payment Response:",o),new Error("Invalid response from payment provider (no pageUrl)")}catch(i){console.error("‚ùå Payment Init Failed Details:",i);let o="–ü–æ–º–∏–ª–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –æ–ø–ª–∞—Ç–∏.";throw i.message&&i.message.includes("400")&&(o+=" –ù–µ–≤—ñ—Ä–Ω—ñ –¥–∞–Ω—ñ."),i.message&&i.message.includes("500")&&(o+=" –°–µ—Ä–≤–µ—Ä —Ç–∏–º—á–∞—Å–æ–≤–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π."),alert(`${o}
–°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.`),i}}async function ap(n){try{return await Le(At.endpoints.PAYMENT_CHECK,n)}catch(t){return console.error("Status Check Failed:",t),{status:"error",message:t.message}}}function Ie(){const n=C.get("currentVariant");let t={...rc},e={...sc};return n&&n.pricing&&(n.pricing.display&&(t={...t,...n.pricing.display}),n.pricing.charge&&(e={...e,...n.pricing.charge})),{display:t,charge:e}}function lp(n){const t=document.getElementById("app");t.classList.add("funnel-container"),t.innerHTML=op;const e=Ie(),r=document.getElementById("paywall-timer"),i=document.getElementById("paywall-astro-data"),o=document.querySelector(".static-placeholder"),l=document.getElementById("final-checkout-button"),u=document.getElementById("paywall-popup"),p=document.getElementById("popup-title"),m=document.getElementById("popup-text"),w=document.getElementById("popup-checkout-btn"),T=document.getElementById("popup-close-btn"),v=document.getElementById("popup-close-icon");gr();function D(){const O=l.querySelector(".btn-text span span.font-bold");O&&(O.innerText=`–†–æ–∑–±–ª–æ–∫—É–≤–∞—Ç–∏ –≤—Å–µ –∑–∞ ${e.display.FULL_REPORT} –≥—Ä–Ω`);const $=w.querySelector(".whitespace-nowrap");$&&($.innerText=`–†–æ–∑–±–ª–æ–∫—É–≤–∞—Ç–∏ –≤—Å–µ –∑–∞ ${e.display.FULL_REPORT} –≥—Ä–Ω`)}D(),window.showPaywallPopup=function(O,$){u&&p&&m&&(p.innerText=O,m.innerHTML=$,u.style.display="flex")};const A=()=>{u&&(u.style.display="none")};T&&T.addEventListener("click",()=>{ct.trigger("light"),A()}),v&&v.addEventListener("click",()=>{ct.trigger("light"),A()}),w&&w.addEventListener("click",()=>{ct.trigger("heavy"),A(),F(l)}),u&&u.addEventListener("click",O=>{O.target===u&&A()});const V=C.get("userData")||{date:C.get("date"),time:C.get("time"),city:C.get("city"),geo:C.get("geo")};i&&Is(V).then(O=>{O?(o&&(o.style.display="none"),i.innerHTML=O,i.style.display="block"):i.style.display="none"});const S=()=>{window.showPaywallPopup("üì° –†–æ–∑—à–∏—Ñ—Ä–æ–≤–∫–∞ –ö–æ—Å–º—ñ—á–Ω–æ–≥–æ –ö–æ–¥—É",`
            <p class="mb-3">–¢–∏ –±–∞—á–∏—à <strong>—Ç–æ—á–Ω—ñ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏</strong> –ø–ª–∞–Ω–µ—Ç –≤ –º–æ–º–µ–Ω—Ç —Ç–≤–æ–≥–æ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è (–≥—Ä–∞–¥—É—Å–∏, —Ö–≤–∏–ª–∏–Ω–∏, —Å–µ–∫—É–Ω–¥–∏).</p>
            
            <p class="mb-3 text-sm italic" style="color: #cda45e; border-left: 2px solid #cda45e; padding-left: 10px;">
                "–¶–µ –Ω–µ –ø—Ä–æ—Å—Ç–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞. –¶–µ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π –≥–µ–Ω–µ—Ç–∏—á–Ω–∏–π –∫–æ–¥ —Ç–≤–æ—î—ó –¥—É—à—ñ."
            </p>

            <ul class="text-sm space-y-2 mb-4">
                <li><strong>–ì—Ä–∞–¥—É—Å:</strong> –í–∏–∑–Ω–∞—á–∞—î –∑—Ä—ñ–ª—ñ—Å—Ç—å –ø–ª–∞–Ω–µ—Ç–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –°–æ–Ω—Ü–µ –≤ 29¬∞ ‚Äî —Ü–µ "–∫–∞—Ä–º—ñ—á–Ω–∏–π —Ñ—ñ–Ω–∞–ª", –º—É–¥—Ä—ñ—Å—Ç—å).</li>
                <li><strong>–ó–Ω–∞–∫:</strong> "–û–¥—è–≥", —è–∫–∏–π –Ω–æ—Å–∏—Ç—å –ø–ª–∞–Ω–µ—Ç–∞ (—Ç–≤—ñ–π —Å—Ç–∏–ª—å –ø–æ–≤–µ–¥—ñ–Ω–∫–∏).</li>
                <li><strong>–î—ñ–º:</strong> –°—Ñ–µ—Ä–∞ –∂–∏—Ç—Ç—è, –¥–µ —Ü—è –µ–Ω–µ—Ä–≥—ñ—è –ø—Ä–∞—Ü—é—î –Ω–∞–π—Å–∏–ª—å–Ω—ñ—à–µ (–≥—Ä–æ—à—ñ, –∫–æ—Ö–∞–Ω–Ω—è, –∫–∞—Ä'—î—Ä–∞).</li>
            </ul>

            <p class="mb-1">–í <strong>–ü–æ–≤–Ω–æ–º—É –ó–≤—ñ—Ç—ñ</strong> –º–∏ –ø–µ—Ä–µ–∫–ª–∞–ª–∏ —Ü—ñ —Å–∫–ª–∞–¥–Ω—ñ —Ü–∏—Ñ—Ä–∏ –Ω–∞ –∑—Ä–æ–∑—É–º—ñ–ª—É –º–æ–≤—É:</p>
            <p class="text-white text-sm">‚úÖ –Ø–∫ —Ü—ñ –≥—Ä–∞–¥—É—Å–∏ –≤–ø–ª–∏–≤–∞—é—Ç—å –Ω–∞ —Ç–≤—ñ–π –¥–æ—Ö—ñ–¥?<br>‚úÖ –ß–æ–º—É –í–µ–Ω–µ—Ä–∞ –≤ —Ü—å–æ–º—É –ø–æ–ª–æ–∂–µ–Ω–Ω—ñ –ø—Ä–∏—Ç—è–≥—É—î —Å–∞–º–µ —Ç–∞–∫–∏—Ö —á–æ–ª–æ–≤—ñ–∫—ñ–≤?</p>
        `)};i&&i.addEventListener("click",()=>{ct.trigger("medium"),S()}),window.paywallInterval&&clearInterval(window.paywallInterval);let P=420;function R(){if(!r)return;const O=Math.floor(P/60),$=P%60;r.textContent=`${O<10?"0":""}${O}:${$<10?"0":""}${$}`,--P<0&&(P=0,clearInterval(window.paywallInterval))}R(),window.paywallInterval=setInterval(R,1e3);async function F(O){O.classList.add("loading"),O.disabled=!0;const $=O.querySelector(".btn-text");$&&(O.dataset.originalText=$.innerHTML,$.innerHTML=`<span class="text-lg">–ó'—î–¥–Ω—É—é—Å—å –∑ –±–∞–Ω–∫–æ–º...</span>`);try{const L=C.get("userData")||{date:C.get("date"),time:C.get("time"),city:C.get("city"),geo:C.get("geo")};console.log("üì¶ Preparing backup data for Safari:",L),await ri({name:"–ü–æ–≤–Ω–∏–π –ê—Å—Ç—Ä–æ-–ü–æ—Ä—Ç—Ä–µ—Ç (Premium)",price:e.charge.FULL_REPORT},{email:C.get("email")||""},L)}catch(L){console.error("Payment error:",L),O.classList.remove("loading"),O.disabled=!1,$&&O.dataset.originalText&&($.innerHTML=O.dataset.originalText)}}l&&l.addEventListener("click",()=>{ct.trigger("heavy"),F(l)})}const cp=`<section id="success-step" class="funnel-step active space-y-6">
    <div id="email-capture-box" class="text-center">
        <!-- Icon -->
        <svg class="w-16 h-16 mx-auto mb-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        
        <!-- Headers -->
        <h2 class="text-2xl font-bold text-center text-white">
            <span style="color: var(--accent-color);">–û–ø–ª–∞—Ç–∞ —É—Å–ø—ñ—à–Ω–∞!</span>
        </h2>
        <p style="color: var(--secondary-text-color);" class="mb-6">
            –¢–≤—ñ–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏–π –∑–≤—ñ—Ç –≥–æ—Ç–æ–≤–∏–π –¥–æ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏. –í–∫–∞–∂–∏ email –Ω–∞ —è–∫–∏–π –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏:
        </p>

        <!-- Main Form -->
        <form id="email-form" class="space-y-4 mb-8">
            <label for="user-email" class="sr-only">–í–∞—à Email</label>
            
            <!-- Hardcore styles for dark theme input -->
            <input 
                type="email" 
                id="user-email" 
                name="user-email" 
                placeholder="your.email@gmail.com" 
                class="input-field text-center" 
                style="background-color: var(--card-bg-color) !important; color: #e0e0e0 !important; -webkit-text-fill-color: #e0e0e0 !important;"
                required
            >
            
            <!-- –ö–Ω–æ–ø–∫–∞ –∑–º—ñ–Ω—é—î —Å—Ç–∏–ª—å –Ω–∞ gold-purple, —è–∫—â–æ –∫—É–ø–ª–µ–Ω–æ –∞–ø—Å–µ–ª -->
            <button type="submit" id="main-report-btn" class="btn btn-primary !text-lg !py-4">
                <span class="btn-text">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –º–µ–Ω—ñ –∑–≤—ñ—Ç</span>
                <span class="btn-spinner"></span>
            </button>
        </form>

        <!-- LTV Upsell Box -->
        <div id="ltv-upsell-box" class="ltv-upsell-box text-left relative overflow-hidden">
            <!-- Badge -->
            <div class="absolute top-0 right-0 bg-[#9d4edd] text-white text-[10px] font-bold px-2 py-1 rounded-bl-lg" style="margin-top: 0; margin-right: 0;">SPECIAL OFFER</div>
            
            <!-- Content -->
            <h3 class="font-bold text-lg text-white mb-1" style="color: var(--accent-secondary); margin-right: 60px;">
                –î–æ–¥–∞–π –¥–æ —Å–≤–æ–≥–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
            </h3>
            
            <p class="text-sm mt-2 mb-4 leading-relaxed" style="color: var(--secondary-text-color);">
                –•–æ—á–µ—à –ø–æ–≤–Ω–∏–π <strong>–ê—Å—Ç—Ä–æ–ª–æ–≥—ñ—á–Ω–∏–π –ü—Ä–æ–≥–Ω–æ–∑</strong> –Ω–∞ –Ω–∞–π–±–ª–∏–∂—á–∏–π —Ä—ñ–∫? –î—ñ–∑–Ω–∞—Ç–∏—Å—è –ø—Ä–æ —Å–≤–æ—ó —Ñ—ñ–Ω–∞–Ω—Å–æ–≤—ñ –ø—ñ–∫–∏, –ø–µ—Ä—ñ–æ–¥–∏ —É–¥–∞—á—ñ —Ç–∞ —É—Å–ø—ñ—Ö–∏ —É —Å—Ç–æ—Å—É–Ω–∫–∞—Ö?<br>
                <!-- üî• UPDATE: –û–Ω–æ–≤–ª–µ–Ω–æ —Å—Ç–∞—Ä—É —Ü—ñ–Ω—É –Ω–∞ 570 –≥—Ä–Ω -->
                <span style="color: var(--primary-text-color);">–õ–∏—à–µ –∑–∞—Ä–∞–∑: <strong>97 –≥—Ä–Ω.</strong> –∑–∞–º—ñ—Å—Ç—å <span style="text-decoration: line-through; opacity: 0.7;">570 –≥—Ä–Ω</span> (–∑–Ω–∏–∂–∫–∞ 83%)</span>
            </p>
            
            <button id="ltv-upsell-btn" class="btn btn-violet w-full opacity-90 hover:opacity-100">
                <!-- üî• UPDATE: –û–Ω–æ–≤–ª–µ–Ω–æ —Å—Ç–∞—Ä—É —Ü—ñ–Ω—É –Ω–∞ 570 –≥—Ä–Ω -->
                <span class="btn-text">–¢–∞–∫, –¥–æ–¥–∞—Ç–∏ –ü—Ä–æ–≥–Ω–æ–∑ –≤—Å—å–æ–≥–æ –∑–∞ 97 –≥—Ä–Ω. <span style="text-decoration: line-through; opacity: 0.7; font-weight: normal; margin-left: 4px;">570 –≥—Ä–Ω.</span></span>
                <span class="btn-spinner"></span>
            </button>
        </div>
    </div>

    <!-- üî• NEW MODAL: Upsell Success & Email Capture -->
    <div id="upsell-success-modal" class="modal-overlay">
        <div class="modal-content text-left">
            <h3 class="text-2xl font-bold text-white mb-4" style="color: var(--accent-color);">–û–ø–ª–∞—Ç–∞ —É—Å–ø—ñ—à–Ω–∞ ‚ú®</h3>
            
            <p style="color: var(--primary-text-color);" class="mb-4 text-sm leading-relaxed">
                –¢–≤—ñ–π <strong>"–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏–π –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ –Ω–∞–π–±–ª–∏–∂—á–∏–π —Ä—ñ–∫"</strong> —É—Å–ø—ñ—à–Ω–æ –æ–ø–ª–∞—á–µ–Ω–æ.
            </p>
            <p style="color: var(--secondary-text-color);" class="mb-6 text-sm leading-relaxed">
                –í—ñ–Ω –≤–∂–µ –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è —ñ –±—É–¥–µ –Ω–∞–¥—ñ—Å–ª–∞–Ω–∏–π –æ–∫—Ä–µ–º–∏–º –ª–∏—Å—Ç–æ–º. –í–∫–∞–∂–∏ —Å–≤–æ—é –ø–æ—à—Ç—É –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏:
            </p>
            
            <form id="upsell-success-form" class="space-y-4">
                <label for="upsell-success-email" class="sr-only">–í–∞—à Email</label>
                
                <input 
                    type="email" 
                    id="upsell-success-email" 
                    placeholder="your.email@gmail.com" 
                    class="input-field text-center" 
                    style="background-color: var(--card-bg-color) !important; color: #e0e0e0 !important; -webkit-text-fill-color: #e0e0e0 !important;"
                    required
                >
                
                <button type="submit" class="btn btn-primary w-full">
                    <span class="btn-text">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –µ–º–µ–π–ª</span>
                    <span class="btn-spinner"></span>
                </button>
            </form>
        </div>
    </div>

    <style>
        /* Global Autofill Override Styles */
        input:-webkit-autofill,
        input:-webkit-autofill:hover, 
        input:-webkit-autofill:focus, 
        input:-webkit-autofill:active {
            -webkit-box-shadow: 0 0 0 30px var(--card-bg-color) inset !important;
            -webkit-text-fill-color: #e0e0e0 !important;
            transition: background-color 5000s ease-in-out 0s;
            caret-color: var(--accent-color);
        }

        #user-email, #upsell-success-email {
            color: #e0e0e0 !important;
            caret-color: var(--accent-color);
        }
        
        #user-email::placeholder, #upsell-success-email::placeholder {
            color: var(--secondary-text-color);
            opacity: 0.7;
            -webkit-text-fill-color: var(--secondary-text-color) !important;
        }

        /* –ó–æ–ª–æ—Ç–æ-–§—ñ–æ–ª–µ—Ç–æ–≤–∏–π –≥—Ä–∞–¥—ñ—î–Ω—Ç –¥–ª—è Premium –∫–Ω–æ–ø–∫–∏ */
        .btn-gold-purple {
            background: linear-gradient(135deg, #cda45e 0%, #9d4edd 100%) !important;
            color: white !important;
            border: none !important;
            box-shadow: 0 4px 20px rgba(157, 78, 221, 0.4) !important;
        }
        .btn-gold-purple:hover {
            opacity: 0.95;
            box-shadow: 0 6px 25px rgba(157, 78, 221, 0.6) !important;
        }
    </style>
</section>`;function up(){if(document.getElementById("global-info-modal"))return;document.body.insertAdjacentHTML("beforeend",`
    <div id="global-info-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="global-modal-title" class="text-2xl font-bold text-white mb-4">–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</h3>
            <p id="global-modal-message" class="text-[#a0a0a0] mb-6 text-sm leading-relaxed">
                ...
            </p>
            <button id="global-modal-close" class="btn btn-secondary w-full py-3">
                <span class="btn-text">–ó—Ä–æ–∑—É–º—ñ–ª–æ</span>
            </button>
        </div>
    </div>
    `);const t=document.getElementById("global-info-modal"),e=document.getElementById("global-modal-close"),r=()=>{t.style.display="none"};e.addEventListener("click",r),t.addEventListener("click",i=>{i.target===t&&r()})}function mr(n,t){up();const e=document.getElementById("global-info-modal"),r=document.getElementById("global-modal-title"),i=document.getElementById("global-modal-message");e&&r&&i?(r.innerText=n,i.innerHTML=t,e.style.display="flex"):alert(`${n}

${t}`)}async function hp(n){const t=document.getElementById("app");t.classList.add("funnel-container"),t.innerHTML=cp;const e=new URLSearchParams(window.location.search),r=e.get("orderRef"),i=e.get("upsell_source");if(r){console.log("üí≥ Validating payment & restoring session:",r);const S=document.createElement("div");S.className="absolute inset-0 bg-black/60 z-50 flex items-center justify-center fixed top-0 left-0 w-full h-full",S.style.zIndex="9999",S.innerHTML='<div class="spinner"></div>',document.body.appendChild(S);try{const P=await ap({invoiceId:C.get("pendingInvoiceId"),orderRef:r});if(P.status==="approved"||P.status==="success"){if(console.log("‚úÖ Payment Validated!"),C.set("isPaid",!0),C.set("currentInvoiceId",P.invoiceId),!C.get("purchaseTracked")){if(window.DC_Analytics){const{charge:R}=Ie();window.DC_Analytics.trackPurchase(R.FULL_REPORT,P.invoiceId||r,"Natal Chart Full Report")}C.set("purchaseTracked",!0)}if(P.userData&&(C.set("userData",P.userData),P.userData.date&&C.set("date",P.userData.date),P.userData.time&&C.set("time",P.userData.time),P.userData.city&&C.set("city",P.userData.city),P.userData.geo&&C.set("geo",P.userData.geo)),P.userEmail&&C.set("email",P.userEmail),S.remove(),!i){const R=C.get("userData")||{date:C.get("date"),time:C.get("time"),city:C.get("city")};aa(R).catch(F=>console.warn("Bg gen error",F))}}else{alert(`–û–ø–ª–∞—Ç–∞ –Ω–µ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–∞. –°—Ç–∞—Ç—É—Å: ${P.status}`),S.remove(),n.navigate("/paywall");return}}catch(P){console.error(P),S.remove(),alert("–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å—É.")}}const o=document.getElementById("email-form"),l=document.getElementById("user-email"),u=document.getElementById("main-report-btn"),p=document.getElementById("ltv-upsell-box"),m=document.getElementById("ltv-upsell-btn"),w=document.getElementById("upsell-success-modal"),T=document.getElementById("upsell-success-form"),v=document.getElementById("upsell-success-email");l&&l.addEventListener("input",S=>{const P=S.target.value.trim();P&&C.set("email",P)});function D(){const S=Ie();if(p){const P=p.querySelector("p span strong");P&&(P.innerText=`${S.display.FORECAST_UPSELL} –≥—Ä–Ω.`);const R=m.querySelector(".btn-text");R&&(R.innerHTML=`–¢–∞–∫, –¥–æ–¥–∞—Ç–∏ –ü—Ä–æ–≥–Ω–æ–∑ –≤—Å—å–æ–≥–æ –∑–∞ ${S.display.FORECAST_UPSELL} –≥—Ä–Ω. <span style="text-decoration: line-through; opacity: 0.7; margin-left: 4px;">${S.display.FORECAST_OLD} –≥—Ä–Ω.</span>`)}}D();function A(){if(p&&(p.style.display="none"),u){u.classList.remove("btn-primary"),u.classList.add("btn-gold-purple");const S=u.querySelector(".btn-text");S&&(S.innerText="–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –º–µ–Ω—ñ –ó–≤—ñ—Ç + –ü—Ä–æ–≥–Ω–æ–∑")}C.get("email")&&l&&(l.value=C.get("email"))}if(C.get("isPendingUpsell")||!!i){if(C.set("hasPaidUpsell",!0),C.set("isPendingUpsell",!1),!C.get("upsellPurchaseTracked")){if(window.DC_Analytics){const{charge:R}=Ie();window.DC_Analytics.trackPurchase(R.FORECAST_UPSELL,`upsell_${Date.now()}`,"Forecast 2026 Upsell")}C.set("upsellPurchaseTracked",!0)}const S=window.location.pathname;window.history.replaceState({},document.title,S);const P=C.get("email");P?(A(),mr("‚ú® –î—è–∫—É—é –∑–∞ –ø–æ–∫—É–ø–∫—É!",`–¢–≤—ñ–π <strong>–ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 2026 —Ä—ñ–∫</strong> –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è –ø—Ä—è–º–æ –∑–∞—Ä–∞–∑ —ñ –±—É–¥–µ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–∏–π –Ω–∞ <strong>${P}</strong><br><br> –ù–∞—Ç–∏—Å–∫–∞–π <strong>–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –º–µ–Ω—ñ –ó–≤—ñ—Ç + –ü—Ä–æ–≥–Ω–æ–∑</strong> –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ`)):w&&(w.style.display="flex")}C.get("hasPaidUpsell")&&A(),C.get("email")&&(l.value=C.get("email")),m&&m.addEventListener("click",async()=>{const S=m,P=S.querySelector(".btn-text").innerHTML;S.classList.add("loading"),S.disabled=!0,S.querySelector(".btn-text").innerText="–ü–µ—Ä–µ—Ö—ñ–¥ –¥–æ –æ–ø–ª–∞—Ç–∏...";try{const R=l.value?l.value.trim():"";C.set("isPendingUpsell",!0),R&&C.set("email",R);const F=C.get("userData"),{charge:O}=Ie();await ri({name:"–ê—Å—Ç—Ä–æ-–ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 2026",price:O.FORECAST_UPSELL},{email:R},F,{returnQueryParams:"upsell_source=stage6"})}catch(R){console.error("Upsell Error:",R),S.classList.remove("loading"),S.disabled=!1,S.querySelector(".btn-text").innerHTML=P,C.set("isPendingUpsell",!1)}}),T&&T.addEventListener("submit",S=>{S.preventDefault();const P=v.value;P&&(C.set("email",P),l.value=P,w.style.display="none",A(),mr("‚ú® –î—è–∫—É—é –∑–∞ –ø–æ–∫—É–ø–∫—É!",`–¢–≤—ñ–π <strong>–ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 2026 —Ä—ñ–∫</strong> –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è —ñ –±—É–¥–µ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–∏–π –Ω–∞ <strong>${P}</strong> –ø—Ä–æ—Ç—è–≥–æ–º 1-2 —Ö–≤–∏–ª–∏–Ω.<br><br>üìß –ü–µ—Ä–µ–≤—ñ—Ä –ø–∞–ø–∫—É <strong>'–í—Ö—ñ–¥–Ω—ñ'</strong> —Ç–∞ <strong>'–°–ø–∞–º'</strong>.`))}),o.addEventListener("submit",S=>{S.preventDefault();const P=l.value;P&&(C.set("email",P),n.navigateTo("generation"))})}const dp=`<!-- üî• UPDATE: –¶–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è –∞–Ω—ñ–º–∞—Ü—ñ—ó –∑–≤—ñ—Ç—É –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é CSS –∫–ª–∞—Å—É -->
<section id="generation-step" class="funnel-step active step-centered text-center" style="margin-top: auto; margin-bottom: auto;">
    <h2 class="text-2xl font-bold text-center text-white mb-6">
        <span style="color: var(--accent-color);">–ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–≤—ñ—Ç—É!</span>
    </h2>
    
    <!-- Spinner (Margin from Monolith) -->
    <div class="spinner" style="margin-top: 2rem; margin-bottom: 1rem; margin-left: auto; margin-right: auto;"></div>
    
    <!-- Typing Container -->
    <div id="report-typing-container" class="typing-container" style="min-height: 3rem; display: flex; align-items: center; justify-content: center;">
        <span id="report-loading-text" style="color: var(--secondary-text-color); font-size: 1.1rem;"></span>
        <span id="report-cursor" class="typing-cursor" style="display: none;"></span>
    </div>
</section>`;async function fp(n){const t=document.getElementById("app");t.classList.add("funnel-container"),t.innerHTML=dp;const e=document.getElementById("report-loading-text"),r=document.getElementById("report-cursor"),i={date:C.get("date"),time:C.get("time"),city:C.get("city"),geo:C.get("geo")},o=C.get("email");C.get("hasPaidUpsell")&&cc(i).catch(A=>console.warn("Forecast bg error:",A));const l=[{text:"‚ú® –ê–Ω–∞–ª—ñ–∑—É—é –Ø–¥—Ä–æ —Ç–≤–æ—î—ó –û—Å–æ–±–∏—Å—Ç–æ—Å—Ç—ñ...",pause:1500},{text:"‚ù§Ô∏è‚Äçüî• –†–æ–∑—à–∏—Ñ—Ä–æ–≤—É—é —Ç–≤–æ—ó —Å—Ü–µ–Ω–∞—Ä—ñ—ó –ö–æ—Ö–∞–Ω–Ω—è...",pause:1500},{text:"üëë –®—É–∫–∞—é, –¥–µ –ø—Ä–∏—Ö–æ–≤–∞–Ω—ñ —Ç–≤–æ—ó –ì—Ä–æ—à—ñ...",pause:1500},{text:"üîÆ –í–∏–≤—á–∞—é —Ç–≤–æ—ó –ö–∞—Ä–º—ñ—á–Ω—ñ –£—Ä–æ–∫–∏...",pause:1500},{text:"üåô –ó'—î–¥–Ω—É—é—Å—å –∑ –µ–Ω–µ—Ä–≥—ñ—î—é —Ç–≤–æ–≥–æ –ú—ñ—Å—è—Ü—è...",pause:1500},{text:"ü™ê –ü–µ—Ä–µ–≤—ñ—Ä—è—é —Ç—Ä–∞–Ω–∑–∏—Ç–∏ –°–∞—Ç—É—Ä–Ω–∞...",pause:1500},{text:"üí´ –†–∞—Ö—É—é –∞—Å–ø–µ–∫—Ç–∏ –í–µ–Ω–µ—Ä–∏ –¥–æ —Ç–≤–æ–≥–æ –ê—Å—Ü–µ–Ω–¥–µ–Ω—Ç—É...",pause:1500},{text:"üìú –§–æ—Ä–º—É—é —Å—Ç–∞—Ä–æ–¥–∞–≤–Ω—ñ–π —Å—É–≤—ñ–π —Ç–≤–æ—î—ó –¥–æ–ª—ñ...",pause:1500},{text:"üßò‚Äç‚ôÄÔ∏è –ú–∞–π–∂–µ –≥–æ—Ç–æ–≤–æ, –í—Å–µ—Å–≤—ñ—Ç –ø—ñ–¥–±–∏—Ä–∞—î —Å–ª–æ–≤–∞...",pause:1500},{text:"ü¶ã –¢–≤–æ—è —É–Ω—ñ–∫–∞–ª—å–Ω—ñ—Å—Ç—å –ø–æ—Ç—Ä–µ–±—É—î –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª—ñ–∑—É...",pause:1500},{text:"‚ú® –î–æ–¥–∞—é —Ç—Ä–æ—Ö–∏ –∑—ñ—Ä–∫–æ–≤–æ–≥–æ –ø–∏–ª—É –≤ —Ç–≤—ñ–π –∑–≤—ñ—Ç...",pause:1500},{text:"‚ö°Ô∏è –§—ñ–Ω–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–æ—Å–º—ñ—á–Ω–æ–≥–æ –ø–∞—Å–ø–æ—Ä—Ç–∞...",pause:2e3},{text:"üåû –ó —Ç–≤–æ—ó–º –∑–≤—ñ—Ç–æ–º –≤—Å–µ –≥–∞—Ä–∞–∑–¥, –ø—Ä–æ—Å—Ç–æ —Å—å–æ–≥–æ–¥–Ω—ñ —Å–ø–∞–ª–∞—Ö–∏ –Ω–∞ —Å–æ–Ω—Ü—ñ —ñ —Ç—Ä–µ–±–∞ —Ç—Ä–æ—Ö–∏ –±—ñ–ª—å—à–µ —á–∞—Å—É –Ω—ñ–∂ –∑–∞–∑–≤–∏—á–∞–π. –ó–≤—ñ—Ç –≤–∂–µ –ª–µ—Ç–∏—Ç—å —Ç–æ–±—ñ –Ω–∞ –ø–æ—à—Ç—É, —ñ –∑–∞—Ä–∞–∑ –≤—ñ–¥–∫—Ä–∏—î—Ç—å—Å—è —Ç—É—Ç.",pause:0,isDelayMessage:!0}];let u=!1,p=null;const m=12e4;(async()=>{for(let V=0;V<l.length;V++){if(u){console.log("üöÄ Report is ready! Skipping animation.");return}const S=l[V];await ca(e,r,S.text,50,0,!1),S.isDelayMessage&&(r&&(r.style.display="inline-block"),e&&(e.style.fontSize="0.95rem",e.style.lineHeight="1.6"));const P=100;let R=0;for(;R<S.pause;){if(u)return;await new Promise(F=>setTimeout(F,P)),R+=P}}for(;!u;)await new Promise(V=>setTimeout(V,500))})();const T=async()=>{try{const A=await la(i,o);return A&&!A.error?(C.set("fullReport",A),{success:!0,data:A}):(console.error("Report Generation Failed:",A),{success:!1,message:A?.message||"Unknown error"})}catch(A){return console.error("API Network Error:",A),{success:!1,message:A.message}}},v=new Promise(A=>{setTimeout(()=>{A({success:!1,timeout:!0})},m)}),D=await Promise.race([T(),v]);if(D.timeout&&!D.success){console.log("‚è±Ô∏è Timeout reached (2 min), but continuing to wait for report...");try{const A=await T();A.success?(p=A,u=!0):(console.log("‚è≥ Still waiting for report..."),await new Promise(V=>setTimeout(V,1e4)),p={success:!0,fromEmail:!0},u=!0)}catch(A){console.error("Retry failed:",A),p={success:!0,fromEmail:!0},u=!0}}else p=D,u=!0;setTimeout(()=>{n.navigateTo("premium-result")},300)}const pp=`<section id="premium-result-step" class="funnel-step active space-y-6">
    
    <!-- 1. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–≤—ñ—Ç—É (–¢–æ—á–Ω–∞ –∫–æ–ø—ñ—è —Å—Ç–∏–ª—ñ–≤ #full-report-content –∑ –º–æ–Ω–æ–ª—ñ—Ç—É) -->
    <div id="full-report-content" class="text-left p-5 rounded-xl space-y-4" style="background-color: var(--card-bg-color); border: 1px solid var(--border-color); display: block;">
        <!-- –°—é–¥–∏ JS –≤—Å—Ç–∞–≤–∏—Ç—å –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π HTML –∑–≤—ñ—Ç—É -->
        <div class="text-center py-10">
            <div class="spinner mx-auto"></div>
            <p class="mt-4 text-gray-400">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö...</p>
        </div>
    </div>

    <!-- 2. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥—ñ–π (–ö–Ω–æ–ø–∫–∏) -->
    <div id="report-actions-container" style="display: flex; flex-direction: column; gap: 0.75rem; margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color);">
        <!-- –ö–Ω–æ–ø–∫–∏ –±—É–¥—É—Ç—å –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—ñ —á–µ—Ä–µ–∑ JS -->
    </div>

    <!-- 3. –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ Late Upsell (–¥–ª—è –∫–Ω–æ–ø–∫–∏ "–û—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–æ–≥–Ω–æ–∑") -->
    <!-- –ö–æ–ø—ñ—è #late-upsell-modal –∑ –º–æ–Ω–æ–ª—ñ—Ç—É -->
    <div id="late-upsell-modal" class="modal-overlay">
        <div class="modal-content" style="width: 480px; max-width: 95%;">
            <div style="text-align: right; margin-bottom: 10px;">
                <button type="button" id="close-late-upsell" style="background:none; border:none; color: #6b7280; font-size: 1.5rem;">&times;</button>
            </div>
            <div class="text-left relative overflow-hidden">
                <h3 class="font-bold text-lg text-white mb-2" style="color: var(--accent-secondary);">
                    –î–æ–¥–∞–π –¥–æ —Å–≤–æ–≥–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
                </h3>
                <p class="text-sm mt-2 mb-6 leading-relaxed" style="color: var(--secondary-text-color);">
                    –•–æ—á–µ—à –ø–æ–≤–Ω–∏–π <strong>–ê—Å—Ç—Ä–æ–ª–æ–≥—ñ—á–Ω–∏–π –ü—Ä–æ–≥–Ω–æ–∑</strong> –Ω–∞ –Ω–∞–π–±–ª–∏–∂—á–∏–π —Ä—ñ–∫? –î—ñ–∑–Ω–∞—Ç–∏—Å—è –ø—Ä–æ —Å–≤–æ—ó —Ñ—ñ–Ω–∞–Ω—Å–æ–≤—ñ –ø—ñ–∫–∏, –ø–µ—Ä—ñ–æ–¥–∏ —É–¥–∞—á—ñ —Ç–∞ —É—Å–ø—ñ—Ö–∏ —É —Å—Ç–æ—Å—É–Ω–∫–∞—Ö?<br><br>
                    <!-- üî• UPDATE: –û–Ω–æ–≤–ª–µ–Ω–æ —Å—Ç–∞—Ä—É —Ü—ñ–Ω—É –Ω–∞ 570 –≥—Ä–Ω -->
                    <span style="color: var(--primary-text-color);">–õ–∏—à–µ –∑–∞—Ä–∞–∑: <strong>97 –≥—Ä–Ω.</strong> –∑–∞–º—ñ—Å—Ç—å <span style="text-decoration: line-through; opacity: 0.7;">570 –≥—Ä–Ω</span> (–∑–Ω–∏–∂–∫–∞ 83%)</span>
                </p>
                
                <!-- üî• –ö–õ–Æ–ß–û–í–ê –ó–ú–Ü–ù–ê: id="ltv-upsell-btn" –¥–ª—è –∫–æ—Ä–µ–∫—Ç–Ω–æ–≥–æ —Ç—Ä–µ–∫—ñ–Ω–≥—É -->
                <button id="ltv-upsell-btn" class="btn btn-violet w-full">
                    <span class="btn-text">–¢–∞–∫, –¥–æ–¥–∞—Ç–∏ –ü—Ä–æ–≥–Ω–æ–∑ –≤—Å—å–æ–≥–æ –∑–∞ 97 –≥—Ä–Ω.</span>
                    <span class="btn-spinner"></span>
                </button>
            </div>
        </div>
    </div>
</section>`;function mp(n){const t=document.getElementById("app");t.classList.add("funnel-container"),t.innerHTML=pp;const e=Ie(),r=document.getElementById("full-report-content"),i=document.getElementById("report-actions-container");r&&(r.style.backgroundColor="transparent",r.style.border="none",r.style.padding="0",r.className="w-full");const o=document.getElementById("late-upsell-modal"),l=document.getElementById("close-late-upsell"),u=document.getElementById("ltv-upsell-btn"),p=document.getElementById("upsell-purchased-modal"),m=document.getElementById("close-purchased-modal-btn"),w=C.get("userData")||{date:C.get("date"),time:C.get("time"),city:C.get("city"),geo:C.get("geo"),planets:C.get("planets")||[]},T=C.get("email"),v="dc_full_report_backup_v2";if(new URLSearchParams(window.location.search).get("upsell_source")==="stage8"){C.set("hasPaidUpsell",!0);try{const d=localStorage.getItem(v);if(d){const y=JSON.parse(d);y&&y.sections&&(vt.log("‚ö°Ô∏è Instant Report Restore from LocalStorage success!"),C.set("fullReport",y))}}catch(d){console.error("Backup restore error:",d)}const h=window.location.pathname;window.history.replaceState({},document.title,h),setTimeout(()=>{i&&i.scrollIntoView({behavior:"smooth",block:"center"})},500)}l&&l.addEventListener("click",()=>o.style.display="none"),m&&m.addEventListener("click",()=>{p&&(p.style.display="none"),R()}),window.addEventListener("click",h=>{h.target===o&&(o.style.display="none"),h.target===p&&p&&(p.style.display="none")});function V(h){return h?h.map(d=>{let y=d.analysis_text||"";y=y.replace(/\*\*(.*?)\*\*/g,'<strong style="color: #fff;">$1</strong>');const _=y.split(`
`).map(b=>`<p>${b}</p>`).join("");return`
                <div class="report-section mb-8 p-6 rounded-2xl relative overflow-hidden" 
                     style="background-color: var(--card-bg-color); border: 1px solid var(--border-color); box-shadow: 0 4px 15px rgba(0,0,0,0.3);">
                    
                    <h2 class="mb-4 flex items-center gap-3" style="color: var(--accent-color); font-size: 1.5rem; font-weight: 700;">
                        <span>${d.icon}</span> ${d.title}
                    </h2>
                    
                    <div class="report-content-text text-left leading-relaxed text-gray-300 space-y-3">
                        ${_}
                    </div>
                    
                    <div class="report-advice mt-6 pt-4 border-t border-gray-700/50">
                        <strong class="block text-[#cda45e] mb-2 uppercase text-xs tracking-wider">‚ö°Ô∏è –ü–æ—Ä–∞–¥–∞ –∑—ñ—Ä–æ–∫:</strong>
                        <p class="italic text-sm text-gray-400">${d.practical_advice}</p>
                    </div>
                </div>`}).join(""):""}function S(){const h=r.querySelector(".astro-data-box");h&&(h.style.cursor="pointer",h.title="–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å, —â–æ–± –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤–∫—É",h.onmouseenter=()=>{h.style.borderColor="rgba(205, 164, 94, 0.6)"},h.onmouseleave=()=>{h.style.borderColor="rgba(205, 164, 94, 0.3)"},h.addEventListener("click",()=>{mr("üì° –†–æ–∑—à–∏—Ñ—Ä–æ–≤–∫–∞ –ö–æ—Å–º—ñ—á–Ω–æ–≥–æ –ö–æ–¥—É",`
                    <p class="mb-3">–¢–∏ –±–∞—á–∏—à <strong>—Ç–æ—á–Ω—ñ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏</strong> –ø–ª–∞–Ω–µ—Ç –≤ –º–æ–º–µ–Ω—Ç —Ç–≤–æ–≥–æ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è (–≥—Ä–∞–¥—É—Å–∏, —Ö–≤–∏–ª–∏–Ω–∏, —Å–µ–∫—É–Ω–¥–∏).</p>
                    
                    <p class="mb-3 text-sm italic" style="color: #cda45e; border-left: 2px solid #cda45e; padding-left: 10px;">
                        "–¶–µ –Ω–µ –ø—Ä–æ—Å—Ç–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞. –¶–µ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π –≥–µ–Ω–µ—Ç–∏—á–Ω–∏–π –∫–æ–¥ —Ç–≤–æ—î—ó –¥—É—à—ñ."
                    </p>

                    <ul class="text-sm space-y-2 mb-4">
                        <li><strong>–ì—Ä–∞–¥—É—Å:</strong> –í–∏–∑–Ω–∞—á–∞—î –∑—Ä—ñ–ª—ñ—Å—Ç—å –ø–ª–∞–Ω–µ—Ç–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –°–æ–Ω—Ü–µ –≤ 29¬∞ ‚Äî —Ü–µ "–∫–∞—Ä–º—ñ—á–Ω–∏–π —Ñ—ñ–Ω–∞–ª", –º—É–¥—Ä—ñ—Å—Ç—å).</li>
                        <li><strong>–ó–Ω–∞–∫:</strong> "–û–¥—è–≥", —è–∫–∏–π –Ω–æ—Å–∏—Ç—å –ø–ª–∞–Ω–µ—Ç–∞ (—Ç–≤—ñ–π —Å—Ç–∏–ª—å –ø–æ–≤–µ–¥—ñ–Ω–∫–∏).</li>
                        <li><strong>–î—ñ–º:</strong> –°—Ñ–µ—Ä–∞ –∂–∏—Ç—Ç—è, –¥–µ —Ü—è –µ–Ω–µ—Ä–≥—ñ—è –ø—Ä–∞—Ü—é—î –Ω–∞–π—Å–∏–ª—å–Ω—ñ—à–µ (–≥—Ä–æ—à—ñ, –∫–æ—Ö–∞–Ω–Ω—è, –∫–∞—Ä'—î—Ä–∞).</li>
                    </ul>

                    <p class="mb-1">–í <strong>—Ü—å–æ–º—É –∑–≤—ñ—Ç—ñ</strong> –º–∏ –ø–µ—Ä–µ–∫–ª–∞–ª–∏ —Ü—ñ —Å–∫–ª–∞–¥–Ω—ñ —Ü–∏—Ñ—Ä–∏ –Ω–∞ –∑—Ä–æ–∑—É–º—ñ–ª—É –º–æ–≤—É:</p>
                    <p class="text-white text-sm">‚úÖ –Ø–∫ —Ü—ñ –≥—Ä–∞–¥—É—Å–∏ –≤–ø–ª–∏–≤–∞—é—Ç—å –Ω–∞ —Ç–≤—ñ–π –¥–æ—Ö—ñ–¥?<br>‚úÖ –ß–æ–º—É –í–µ–Ω–µ—Ä–∞ –≤ —Ü—å–æ–º—É –ø–æ–ª–æ–∂–µ–Ω–Ω—ñ –ø—Ä–∏—Ç—è–≥—É—î —Å–∞–º–µ —Ç–∞–∫–∏—Ö —á–æ–ª–æ–≤—ñ–∫—ñ–≤?</p>
                `)}))}async function P(){let h=C.get("fullReport");if(!h||!h.sections){const d=localStorage.getItem(v);if(d)try{h=JSON.parse(d),C.set("fullReport",h)}catch(y){console.warn("Backup parse fail",y)}}if(h&&h.sections){localStorage.setItem(v,JSON.stringify(h));const d=V(h.sections),y=await Is(w);r.innerHTML=d+y,S(),R();return}console.warn("‚ö†Ô∏è Report data missing. Fetching from API..."),r.innerHTML=`
            <div class="text-center py-12 space-y-4">
                <div class="spinner mx-auto" style="width: 3rem; height: 3rem;"></div>
                <p class="text-gray-400 animate-pulse text-sm">–í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –≤–∞—à–æ–≥–æ –∑–≤—ñ—Ç—É...</p>
            </div>
        `;try{const d=await la(w,T);if(d&&!d.error&&d.sections){C.set("fullReport",d),localStorage.setItem(v,JSON.stringify(d));const y=V(d.sections),_=await Is(w);r.innerHTML=y+_,S(),R()}else throw new Error("Invalid recovery data")}catch{r.innerHTML='<div class="text-center p-6"><p class="text-red-400">–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑–≤—ñ—Ç. –ë—É–¥—å –ª–∞—Å–∫–∞, –æ–Ω–æ–≤—ñ—Ç—å —Å—Ç–æ—Ä—ñ–Ω–∫—É.</p></div>'}}function R(){i.innerHTML="";const h=document.createElement("button");if(h.className="btn btn-secondary",h.innerHTML='<span class="btn-text">–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ PDF (–ó–≤—ñ—Ç)</span><span class="btn-spinner"></span>',h.onclick=()=>F(h),h.onclick=()=>F(h),i.appendChild(h),O(),C.get("hasPaidUpsell")){const d=document.createElement("div");d.className="mt-4 mb-2 p-4 rounded-lg border text-center animate-fadeIn",d.style.backgroundColor="rgba(20, 83, 45, 0.2)",d.style.borderColor="rgba(34, 197, 94, 0.3)",d.innerHTML=`
                <div class="flex items-center justify-center gap-2">
                    <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    <span class="text-sm font-bold text-green-400 tracking-wide">
                        –¢–≤—ñ–π –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 2026 —Ä—ñ–∫ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –ø–æ—à—Ç—É
                    </span>
                </div>
            `,i.appendChild(d);const y=document.createElement("button");y.className="btn btn-skip",y.style.marginTop="15px",y.innerText="–ü–æ—á–∞—Ç–∏ –∑–∞–Ω–æ–≤–æ (–ù–æ–≤–∞ –∫–∞—Ä—Ç–∞)",y.onclick=()=>{confirm("–û—á–∏—Å—Ç–∏—Ç–∏ –¥–∞–Ω—ñ —Ç–∞ –ø–æ—á–∞—Ç–∏ –Ω–æ–≤–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫?")&&(C.clear(),localStorage.removeItem(v),window.location.href="/")},i.appendChild(y)}else{const d=document.createElement("button");d.className="btn btn-violet",d.style.marginTop="10px",d.innerHTML=`
                <span class="btn-text flex flex-col items-center justify-center leading-tight">
                    <span class="text-[16px] font-bold">–û—Ç—Ä–∏–º–∞—Ç–∏ –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ —Ä—ñ–∫ –∑–∞ ${e.display.FORECAST_UPSELL} –≥—Ä–Ω.</span>
                    <span class="text-[10px] opacity-80 font-normal mt-1 lowercase">–±—É–¥–µ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –ø–æ—à—Ç—É</span>
                </span>
            `,d.onclick=()=>{u&&(u.querySelector(".btn-text").innerText=`–¢–∞–∫, –æ—Ç—Ä–∏–º–∞—Ç–∏ –ü—Ä–æ–≥–Ω–æ–∑ –∑–∞ ${e.display.FORECAST_UPSELL} –≥—Ä–Ω.`),o.style.display="flex"},i.appendChild(d)}}async function F(h){const d=C.get("fullReport");if(!d)return;const y=window.open("","_blank");if(y)y.document.write(`
                <html>
                    <head>
                        <title>Destiny Code PDF</title>
                        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                        <style>
                            body { background-color: #0f1115; color: #cda45e; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; font-family: sans-serif; margin: 0; text-align: center; padding: 20px; box-sizing: border-box; }
                            .loader { border: 3px solid rgba(205, 164, 94, 0.3); border-top: 3px solid #cda45e; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin-bottom: 20px; }
                            @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
                            p { margin: 0; line-height: 1.5; }
                            .main-text { font-size: 14px; letter-spacing: 1px; text-transform: uppercase; font-weight: bold; margin-bottom: 20px; color: #fff; }
                            .sub-text { font-size: 11px; opacity: 0.6; max-width: 280px; margin: 0 auto; color: #cda45e; }
                        </style>
                    </head>
                    <body>
                        <div id="loader-box">
                            <div class="loader"></div>
                            <p class="main-text">–ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ PDF...</p>
                            <p class="sub-text">–ü–æ–≤–Ω–∏–π —Ç–µ–∫—Å—Ç–æ–≤–∏–π –æ–ø–∏—Å —Ç–∞ —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤–∫–∞<br>–∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –Ω–∞ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ (–≤–∫–ª–∞–¥—Ü—ñ).</p>
                        </div>
                    </body>
                </html>
            `);else{alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –¥–æ–∑–≤–æ–ª—å—Ç–µ —Å–ø–ª–∏–≤–∞—é—á—ñ –≤—ñ–∫–Ω–∞ –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É.");return}h.classList.add("loading"),h.disabled=!0;try{const _=V(d.sections),b={...w};if(!b.planets||b.planets.length===0){const Bt=C.get("planets");Bt&&Bt.length>0&&(b.planets=Bt)}const g={reportHtml:_,reportType:"main",userData:b},nt=await fetch(At.PDF,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)});if(!nt.ok)throw new Error("Server error");const St=await nt.json();if(St.success&&St.pdfBase64){const Bt=atob(St.pdfBase64),Sn=new Array(Bt.length);for(let It=0;It<Bt.length;It++)Sn[It]=Bt.charCodeAt(It);const ye=new Uint8Array(Sn),_e=new Blob([ye],{type:"application/pdf"}),Be=window.URL.createObjectURL(_e);if(y)y.location.href=Be;else{const It=document.createElement("a");It.href=Be,It.download="DestinyCode_Report.pdf",document.body.appendChild(It),It.click(),setTimeout(()=>document.body.removeChild(It),100)}setTimeout(()=>window.URL.revokeObjectURL(Be),6e4)}else y&&y.close(),alert("–ù–µ –≤–¥–∞–ª–æ—Å—è —Å—Ñ–æ—Ä–º—É–≤–∞—Ç–∏ PDF. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.")}catch(_){y&&y.close(),console.error("PDF Download Error:",_),alert("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∑'—î–¥–Ω–∞–Ω–Ω—è.")}finally{h.classList.remove("loading"),h.disabled=!1}}u&&u.addEventListener("click",async()=>{const h=u;h.classList.add("loading"),h.disabled=!0;const d=C.get("fullReport");d&&localStorage.setItem(v,JSON.stringify(d));try{await ri({name:"–ê—Å—Ç—Ä–æ-–ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 2026 (Promo)",price:e.charge.FORECAST_UPSELL},{email:T},w,{returnQueryParams:"upsell_source=stage8"})}catch(y){console.error("Late Upsell Error:",y),h.classList.remove("loading"),h.disabled=!1}}),P();function O(){if(i.querySelector(".feedback-controls"))return;const h=document.createElement("div");h.className="feedback-controls";const d=document.createElement("div");d.className="feedback-buttons";const y=$("üëç","like"),_=$("üëé","dislike");if(d.appendChild(_),d.appendChild(y),h.appendChild(d),C.get("hasPaidUpsell")){const b=document.createElement("button");b.className="btn-feedback-text",b.innerText="–ù–∞–ø–∏—Å–∞—Ç–∏ –≤—ñ–¥–≥—É–∫ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞–º",b.onclick=L,h.appendChild(b)}i.appendChild(h)}function $(h,d){const y=document.createElement("div");return y.className="btn-feedback-icon",y.innerText=h,y.onclick=async()=>{y.parentElement.querySelectorAll(".btn-feedback-icon").forEach(b=>b.classList.remove("active")),y.classList.add("active"),await Ts.send({type:d,value:d,source:"premium_report"}),E("–î—è–∫—É—é üíú"),d==="dislike"&&setTimeout(L,500)},y}function L(){const h=document.createElement("div");h.className="feedback-modal-overlay";const d=document.createElement("div");d.className="feedback-modal";const y=document.createElement("h3");y.innerText="–í–∞—à –≤—ñ–¥–≥—É–∫ –¥–æ–ø–æ–º–æ–∂–µ –Ω–∞–º —Å—Ç–∞—Ç–∏ –∫—Ä–∞—â–∏–º–∏",y.style.color="#cda45e",y.style.marginBottom="8px";const _=document.createElement("textarea");_.className="feedback-textarea",_.placeholder="–©–æ –Ω–∞–º –≤–∞—Ä—Ç–æ –ø–æ–∫—Ä–∞—â–∏—Ç–∏?";const b=document.createElement("button");b.className="btn btn-violet",b.innerText="–ù–∞–¥—ñ—Å–ª–∞—Ç–∏",h.onclick=g=>{g.target===h&&document.body.contains(h)&&document.body.removeChild(h)},b.onclick=async()=>{if(_.value.trim()){b.innerText="–í—ñ–¥–ø—Ä–∞–≤–∫–∞...",b.disabled=!0;try{const g=C.get("hasPaidUpsell")?"premium_upsell":"premium_feedback";await Ts.send({type:"text",value:_.value,source:g})}catch(g){console.error("Feedback send error",g)}finally{document.body.contains(h)&&document.body.removeChild(h),mr("–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ","–ú–∏ –¥—É–∂–µ —Ü—ñ–Ω—É—î–º–æ –≤–∞—à —á–∞—Å —Ç–∞ —É–≤–∞–≥—É. –î—è–∫—É—î–º–æ! üôè")}}},d.appendChild(y),d.appendChild(_),d.appendChild(b),h.appendChild(d),document.body.appendChild(h)}function E(h){const d=document.createElement("div");d.innerText=h,d.style.position="fixed",d.style.top="20px",d.style.left="50%",d.style.transform="translate(-50%, -20px)",d.style.background="linear-gradient(135deg, #0f1115 0%, #1a1c23 100%)",d.style.color="#fff",d.style.border="1px solid rgba(205, 164, 94, 0.3)",d.style.boxShadow="0 10px 25px -5px rgba(0, 0, 0, 0.8), 0 0 15px -3px rgba(205, 164, 94, 0.1)",d.style.padding="12px 24px",d.style.borderRadius="99px",d.style.fontWeight="bold",d.style.opacity="0",d.style.transition="all 0.3s ease",d.style.zIndex="2000",document.body.appendChild(d),requestAnimationFrame(()=>{d.style.opacity="1",d.style.transform="translate(-50%, 0)"}),setTimeout(()=>{d.style.opacity="0",d.style.transform="translate(-50%, -20px)",setTimeout(()=>document.body.removeChild(d),300)},900)}}function gp(n){if(window.dataLayer){const t="pv_"+Date.now()+"_"+Math.random().toString(36).substr(2,5);window.dataLayer.push({event:"virtual_pageview",page_path:n,page_title:document.title,event_id:t,email:C.get("email")||""})}}function yp(){document.addEventListener("click",n=>{const t=n.target.closest("button, a, .paywall-item, .interactive-astro-box");if(t&&window.dataLayer){const e=t.id||t.getAttribute("name")||"no-id",r="clk_"+Date.now()+"_"+Math.random().toString(36).substr(2,5);let i="interaction_click";if(e==="upgrade-button"&&(i="click_upgrade_3scrn"),t.classList.contains("paywall-item")){const o=t.querySelector(".font-bold")?.innerText||"Unknown";i=`click_paywall_benefit_${{"–Ø–¥—Ä–æ –û—Å–æ–±–∏—Å—Ç–æ—Å—Ç—ñ":"personality","–ö–æ–¥ –¢–≤–æ–≥–æ –ö–æ—Ö–∞–Ω–Ω—è":"love","–ì—Ä–æ—à–æ–≤–∏–π –ü–æ—Ç—ñ–∫":"money","–ö–∞—Ä–º—ñ—á–Ω—ñ –£—Ä–æ–∫–∏ —Ç–∞ –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è":"karma","–¢–≤–æ—ó –ú–∞–π–±—É—Ç–Ω—ñ –ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ":"future"}[o]||"other"}`}else(t.classList.contains("interactive-astro-box")||e==="paywall-astro-data")&&(i="click_paywall_benefit_astro_imprint");if(window.dataLayer.push({event:i,event_id:r,element_id:e,email:C.get("email")||"",page_path:window.location.pathname}),(e==="final-checkout-button"||e==="popup-checkout-btn")&&window.DC_Analytics.trackBeginCheckout(149,"Natal Chart Full Report"),e==="ltv-upsell-btn"){const l=window.location.pathname.includes("report")||window.location.pathname.includes("premium-result")?"Report":"Success";window.DC_Analytics.trackBeginCheckout(97,`Forecast Upsell (${l})`),C.set("last_checkout_value",97),C.set("upsell_origin",l)}}},!0),document.addEventListener("click",n=>{const t=n.target.closest('button, a, .btn, .clickable, input[type="radio"], input[type="checkbox"]');t&&(t.disabled||t.classList.contains("disabled")?ct.trigger("error"):t.classList.contains("btn-primary")||t.classList.contains("btn-action")?ct.trigger("medium"):ct.trigger("light"))},!0)}window.DC_Analytics={generateEventId:(n="evt")=>`${n}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,trackBeginCheckout:(n,t)=>{const e=window.DC_Analytics.generateEventId("bc");let r="begin_checkout_main";t.includes("(Success)")&&(r="begin_checkout_upsell_success"),t.includes("(Report)")&&(r="begin_checkout_upsell_report"),window.dataLayer.push({event:r,event_id:e,item_name:t,email:C.get("email")||"",ecommerce:{currency:"UAH",value:n,items:[{item_name:t,price:n,quantity:1}]}}),vt.log(`üöÄ [Analytics] ${r.toUpperCase()}: ${t}`)},trackPurchase:(n,t,e)=>{let r="purchase_main";e.includes("(Success)")&&(r="purchase_upsell_success"),e.includes("(Report)")&&(r="purchase_upsell_report"),window.dataLayer.push({event:"purchase",event_custom_name:r,event_id:t,email:C.get("email")||"",ecommerce:{transaction_id:t,value:n,currency:"UAH",items:[{item_name:e,price:n,quantity:1}]}}),vt.log(`üí∞üí∞üí∞ [Analytics] ${r.toUpperCase()}: ${e}`)}};async function _p(){window.starryBgInstance||(window.starryBgInstance=new xe);const n=()=>{ct.init(),document.body.removeEventListener("click",n),document.body.removeEventListener("touchstart",n)};document.body.addEventListener("click",n),document.body.addEventListener("touchstart",n),yp(),Ct.init({onRoute:async t=>{switch(gp(t),new URLSearchParams(window.location.search),t){case"/":so(Ct);break;case"/loading":window.dataLayer&&window.dataLayer.push({event:"lead_confirmed",event_id:"ld_"+Date.now(),email:C.get("email")||""}),dc(Ct);break;case"/result":tp(Ct);break;case"/premium":ip(Ct);break;case"/paywall":if(!C.get("userData"))return Ct.navigate("/");window.dataLayer&&window.dataLayer.push({event:"premium_data_confirmed",event_id:"pdc_"+Date.now(),email:C.get("email")||""}),lp();break;case"/success":hp(Ct);break;case"/generation":if(!C.get("isPaid"))return Ct.navigate("/paywall");fp(Ct);break;case"/report":case"/premium-result":if(!C.get("isPaid"))return Ct.navigate("/paywall");gr(),mp();break;default:so(Ct)}}})}document.addEventListener("DOMContentLoaded",_p);
